# 一、前言

实际开发中，包管理工具可以让开发者共享代码，非常方便的使用各种插件、库和框架，无需再到处去搜寻需要用到的这些程序。

目前主流的包管理工具主要有：`NPM` 和 `Yarn`，接下来主要针对这个两个包管理工具进行讲解。

# 二、[NPM](https://docs.npmjs.com/getting-started)

## 01. 概述

[NPM >>](https://docs.npmjs.com/)（Node Package Manager，即：node包管理器）是nodeJS的包管理工具，随同 nodeJS 一起安装。其能解决 nodeJS 代码部署上的很多问题，常见的使用场景有以下几种：

- 下载依赖包使用；
- 上传依赖包供别人使用；

## 02. 安装

我们已经提到，nodeJS 自带 npm，因此我们只需要安装 nodeJS 即可。

点击 [前往下载 nodeJS](http://nodejs.cn/download/)

nodeJS下载完成后像正常软件那样进行安装即可，但路径最好选择一个比较容易查找的（盘符的根目录是最好的选择），因为我们以后可能经常都会使用到nodeJS里面的npm。

先看看 node 被安装到哪了，然后确认下版本。

```shell
$ which node
/usr/local/bin/node
$ node -v
v14.16.1
```

> 提示：window 下使用 `where` 指令替代 `which` 。

> 注意：windows下如果提示'node 不是内部指令'，则需要将node的路径添加到环境变量中即可。

nodeJS安装完成之后检查npm是否可用，可以在命令行工具里面输入：

```shell
$ which npm
/usr/local/bin/npm
$ npm -v
6.14.11
```

如果结果是一串数字的版本号，那证明安装成功，npm 已经可用。

## 03. 修改默认安装路径

> Tips：根据需要更改

### 3.1. windows

通过如下指令查看NPM 默认的安装位置：

```shell
$ npm config get prefix
C:\Users\Li-HONGYAO\AppData\Roaming\npm
```

修改默认安装路径的方式如下：

**①. 首先创建用于放置依赖包的文件**

```shell
# 全局安装程序包的目录
E:\npm-global
# 全局缓存的目录
E:\npm-global\cache
```

**②. 打开命令行窗口，分别输入以下命令：**

```shell
$ npm config set prefix "E:\npm-global"
$ npm config set cache  "E:\npm-global\cache"
```

### 3.2 macOS

**①. 查看当前npm全局安装位置**

```shell
$ npm config get prefix
/usr/local
```

**②. 在用户目录下建立一个新的目录，并设置为npm全局的prefix**

```shell
$ mkdir ~/.npm-global
$ npm config set prefix '~/.npm-global'
```

**③. 修改 `~/.bash_profile` 文件（如果没有就创建一个)**

```shell
export NPM_GLOBAL=/Users/lihongyao/.npm-global/bin
export PATH=$PATH:$NPM_GLOBAL
```

**④. 更新shell**

```shell
$ source ~/.bash_profile
```

**⑤. 检查一下**

```shell
$ npm config get prefix
/Users/lihongyao/.npm-global
```

此后，使用 `npm install -g` 安装的模块会被安装到 `~/.npm-global` 中，同 `usr/local` 一样，`~/.npm-global`也会包含 `bin` 和 `lib` 目录，其中 `lib` 目录中包含 `node_modules`。

**⑥. 在新位置重新安装npm**

```shell
$ npm install npm@latest -g
```

安装成功后你可以删除 `usr/local/lib/node_modules` 和 `usr/local/bin/npm` 了。如果不重新安装 `npm`，就必须保留 `user/local` 下面的包，当然更新后还是会安装到新位置。

**⑦. 检查一下已安装的全局包**

```shell
$ npm list --depth=0 -g
```

## 04. 配置文件

创建配置文件：

```shell
$ npm init
```

根据提示进行配置，每步完成按回车键确认。

通常第一个出现的配置项是name，表示当前项目的名称，名称的设置有以下五个要求：

1. 英文字符**必须是**全部小写的

2. 名称间**不能出现**空格（如：test webpack）
3. 名称**不得**过长
4. **不能**为中文
5. 可以使用连接线（-）和下划线（_）

否则都会错误并要求重新输入。

这里再说说其它填写项的作用：

```javascript
package name: (npm-test)    -> 名称(可跳过)
version: (1.0.0)            -> 版本(可跳过)
description:                -> 描述(可跳过)
entry point: (index.js)     -> 入口(可跳过)
test command:               -> 命令行(可跳过)
git repository:             -> git 仓库(可跳过)
keywords:                   -> 关键字(可跳过)
author:                     -> 作者(可跳过)
license: (ISC)              -> 许可证(可跳过)
```

当所有配置项都输入完成后按照要求输入命令 `yes` 即可完成配置，并在当前目录下生成一个 `pakage.json` 文件了。既然生成的是一个 `json` 文件，也就是说我们可以随时去手动修改我们生成的这个文件了，以后也有很多配置属性是在其它程序包的命令使用的时候帮我们自动生成的。

实际上，如果你不喜欢这样繁琐的问答生成方式可以使用更快速的生成方式：

```shell
$ npm init -y
```

**> 为什么使用 package.json 文件？**

因为node插件包相对来说非常庞大，将配置信息写入package.json并将其加入版本管理，其他开发者对应下载即可（命令提示符执行 `npm install`，则会根据package.json下载所有需要的包，`npm install --production` 只下载dependencies节点的包），而无需再重新配置依赖，非常方便快捷。比如项目中你使用了好几十个依赖包，当你在做另外一个项目的时候也会使用这些依赖，如果你将这些依赖包通过package.json文件来管理，你要做的，就只是将package.json文件置入你要使用的项目文件中，通过安装指令即可将所有的插件都安装在你项目里面。

## 05. 使用

### 5.1. 安装程序包 *

npm 安装 Node.js 模块语法格式如下：

```shell
$ npm install [-g|--global] [-S|--save][-D|--save-dev] <name>[@version] 
```

**# 语法解读：**

1）、**\<name>@version**：插件名称@版本号，比如：`npm i -S jquery@1.9.2`

2）、**-g**：--global 全局安装

3）、**-S**：--save 安装生产环境需要的依赖包，会把依赖包名称添加到 package.json 文件 dependencies 下

4）、**-D**：--save-dev 安装开发环境需要的依赖包，会把依赖包名称添加到 package.json 文件 devDependencies 下

> Tips：
>
> - 直接使用 `npm install` 时，会下载 `dependencies` 和 `devDependencies` 中的模块。
> - 当使用 `npm install –production` 或者注明 `NODE_ENV`  变量值为 `production`  时，只会下载 `dependencies` 中的模块。

### 5.2. 查看程序包

可以用如下命令列出所有我们安装的 包。

```shell
$ npm list [-g] [--depth=0]
```

`--depth=0` ：简化输出

### 5.3. 卸载程序包

要卸载通过npm安装的程序包，可以使用以下命令：

```shell
$ npm uninstall [-g][-S][-D] <包名>
```

> 注意：
>
> 1. 如果安装时使用了 `-g` （全局），卸载程时也应该加上`-g`。
> 2. 如果安装时使用了 `-D`（在开发环境中依赖程序包），卸载时也应该加上`-D`。
> 3. 如果安装时使用了 `-S` （在生产线上环境依赖程序包），卸载时也应该加上 `-S`。

### 5.4. 更新程序包

需要知道哪些程序包需要更新，可以使用命令

```shell
$ npm outdated [-g] --depth=0
```

接着对需要更新的程序包执行以下命令即可：

```shell
$ npm update [-g] <包名>
```

但实际上最好的更新就是重装：

```shell
$ npm i [-g] <包名>
```

### 5.5. 搜索程序包

```shell
$ npm search <name>
```

### 5.6. 管理缓存

当 npm 安装一个包的时候它会维护一个副本，下次你想再次安装那个包的时候，就不用再去访问网络重新下载了。那些副本会在 `home` 目录 `.npm` 文件夹中缓存起来。

```shell
$ ls ~/.npm
_cacache			_logs
_locks				anonymous-cli-metrics.json
```

随着时间推移，这个目录里会有很多老的包，十分的混乱，所以时常清理下是十分有必要的。

```shell
$ npm cache clean --force
```

## 06. 使用淘宝镜像 *

由于npm是国外的服务器，在国内使用很多时候会不稳定，出现下载 “假死” 或速度过慢的现象（如果出现这样的情况我们可以 `ctr + C` 结束进程）。为了解决这个问题阿里集团的一个团队为npm创建了一个国内的服务器镜像——淘宝镜像（cnpm），它以10分钟为单位保持与国外npm服务器的同步频率。也就是说我们直接可以通过淘宝镜像去下载或更新我们的程序包，而不必去忍受缓慢的程序包下载速度了。

官方源：https://registry.npmjs.org/

> **安装方案1：**

直接给 `npm` 配置taobao镜像的registry就好了，也不是非得装`cnpm`

```shell
$ npm config set registry https://registry.npm.taobao.org
$ npm config set registry https://registry.npmjs.org
```

> **安装方法2：**

要安装淘宝镜像，需要在终端输入以下命令：

```shell
$ npm i -g cnpm --registry=https://registry.npm.taobao.org
```

这样就可以使用 `cnpm` 命令来安装模块了：

```shell
$ cnpm i [-g][-s][-d] <包名> 
```

## 07. NPM 常用指令

| 指令                 | 描述              |
| -------------------- | ----------------- |
| `npm -v`             | 查看npm版本       |
| `which|where npm`    | 查看npm安装路径   |
| `npm help`           | 查看npm帮助       |
| `npm list --depth=0` | 查看npm已安装的包 |
| `npm root -g`        | 查看全局安装目录  |
| `npm config ls`      | 查看配置项        |
| `npm install `       | 安装包 *          |
| `npm uninstall`      | 卸载包            |
| `npm init -y`        | 创建配置文件 *    |
| `npm outdated`       | 查看有哪些旧包    |

## 08. npm 使用流程

- 在项目目中通过 `npm init -y` 创建 `package.json` 文件；
- 打开终端下载对应插件即可；

## 09. 发布包

### 9.1. 注册

[注册NPM账号>>](https://www.npmjs.com/signup) 有两种形式

- 直接注册：<https://www.npmjs.com/signup>

- 本地注册：终端输入指令 `npm adduser` ，依次输入用户名，密码，邮箱就注册成功了。注册成功会自动登录。

### 9.2. 登陆

```shell
$ npm login
```

> 注意：如果你将镜像文件设置成淘宝镜像，将会登陆失败，在终端输入如下即可：

```shell
$ npm config set registry https://registry.npmjs.org/
```

### 9.3. 发布

```shell
$ npm publish
```

此时你就可以 [npm官网](https://www.npmjs.com/) 搜索你刚刚发布的包了。

### 9.4. 卸载

```shell
$ npm unpublish <包名>@版本号
```

### 9.5. 更新

如果对包文件做了修改，要更新包时需要修改版本号才能发布成功。

## 10. 简化任务

当我们在开发过程中，比如编译 es6，会输入一长串的指令，比如：

```shell
$ ./node_modules/.bin/babel src --out-dir lib
```

通过package.json配置文件我们可以简化操作，如下配置：

```json
"scripts": {
	"build": "./node_modules/.bin/babel src --out-dir lib"
}
```

这样，我们在终端输入如下指令即可：

```shell
$ npm run build
```

有时我们可能需同时出发多条指令并实现监听，可通过安装 [concurrently](https://www.npmjs.com/package/concurrently) 依赖实现，具体使用如下：

```shell
$ npm i -S concurrently
```

在配置文件这样配置即可：

```js
concurrently "command1 arg" "command2 arg"
```

## 11. 异常处理

- 如果输入npm之后没有任何反应，解决办法是删除 <b><ins>用户目录下的.npmrc文件</ins></b>。

## 12. 升级Node & Npm

**macOS**

```shell
# 升级node至最新稳定版本
$ npm install n -g
$ sudo n stable
```

> 注意：`n` 目前不支持 windows 系统。

**windows**

1）查看本地 node 安装路径 *

```shell
$ where node
C:\Program Files\nodejs\node.exe
```

2）在官网下载 [nodejs >>](https://nodejs.org/zh-cn/) 覆盖安装

## 13. NPX

NPX 下载全局命令行，在执行下载之后会自动移除，这样就不会占用没有必要的磁盘空间啦。

Node 自带 npm 模块，所以可以直接使用 npx 命令。万一不能用，就要手动安装一下。

```shell
$ npm install -g npx
```

# 三、[Yarn](https://yarn.bootcss.com/)

## 1. 概述

一直以来，我们在安装和管理依赖的时候基本上都会使用npm，npm是一个非常优秀全面且广受欢迎的包管理工具，它奠定了前端模块化开发的基石，为前端的发展做出了不可磨灭的贡献。yarn 就是一个类似于 npm 的包管理工具，它由 facebook 推出并开源。鉴于 facebook 在前端界的影响力，yarn 一面世就很受瞩目，受到了前端界的广泛欢迎。

与npm相比，yarn有着众多的优势，主要的优势在于：速度，安全，可靠。

- 速度：Yarn 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快。
- 安全：在执行代码之前，Yarn 会通过算法校验每个安装包的完整性。
- 可靠：使用详细、简洁的锁文件格式和明确的安装算法，Yarn 能够保证在不同系统上无差异的工作。

## 2. 安装

[下載地址 >>](https://yarn.bootcss.com/docs/install/#windows-stable)

> 提示：macOS 可直接使用 brew 安装。

安装成功后使用 `yarn -v` 查看版本：

```shell
$ yarn -v
1.7.0
```

安装完成之后，需设置环境变量（将 `yarn` 的 `bin` 目录添加至 `path` 字段中即可）。

如果你已经安装了 npm，可直接通过 npm安装 yarn：

```shell
$ npm install yarn -g
```

## 3. 使用淘宝镜像

```shell
$ yarn -g config set registry https://registry.npm.taobao.org 
yarn config v1.7.0
success Set "registry" to "https://registry.npm.taobao.org".
✨  Done in 0.03s.
```

可通过如下指令查看是否设置成功：

```shell
$ yarn config get registry
https://registry.npm.taobao.org
```

## 4. 使用

**① 创建配置文件**

```shell
$ yarn init -y
```

**② 安装依赖**

```shell
$ yarn add [--save][--save-dev] [package]
$ yarn add [--save][--save-dev] [package]@[version]
$ yarn add [--save][--save-dev] [package]@[tag]
```

**③ 更新依赖**

```shell
$ yarn upgrade [package]
$ yarn upgrade [package]@[version]
$ yarn upgrade [package]@[tag]
```

**④ 删除依赖**

```shell
$ yarn remove [package]
```

**⑤ 安装所有依赖包**

```shell
$ yarn install
```

**⑥ 查看已经安装的包**

```shell
$ yarn list --depth=0
```

更多指令，参考：https://yarnpkg.com/en/docs/cli/

# 四、异常处理

## 1. windows 下提示不是内部命令

在 windows 系统下，如果提示“ **npm不是内部或外部的命令…** ”，那就要进入系统设置一下环境变量了。具体操作步骤如下：

1）、桌面上右键“此电脑” -> 属性 -> 高级系统设置 -> 环境变量 -> 选择PATH ->  点击编辑

2）、获取对应的安装路径，将该路径添加至刚刚的PATH中即可。

**注意：** 用户变量与系统变量都应该做相同的操作。

## 2. JSON 解析错误

**\> 场景**

当npm install出现"Unexpected end of JSON input while parsing near"时。

**\> 解决方案**

执行如下指令清除缓存即可。

```shell
$ npm cache clean --force
```

# 五、包管理工具设置

当你在使用 `vue create` 新建项目的时候，会发现一个 `.vuerc` 的文件，该文件将会存在用户的 `home` 目录下。如果你想要修改被保存的 `preset` 选项，可以编辑这个文件。

```shell
$ open ~/.vuerc
```

```js
{
  "useTaobaoRegistry": true,
  "packageManager":"yarn"
}
```

> 提示：windows 目录 -> `C:\Users\当前电脑登录账户名\.vuerc`




# ä¸€ã€å¥‘å­

ä¹‹å‰åœ¨çš„é¢è¯•è¿‡ç¨‹ä¸­ï¼Œæœ‰è¢«é—®åˆ° **npmã€yarnã€pnpmçš„å®ç°æœºåˆ¶åŠå…¶åŒºåˆ«**ï¼Œä»Šå¤©åˆšå¥½æœ‰æ—¶é—´ï¼Œæ¢³ç†ç›¸å…³çš„çŸ¥è¯†è„‰ç»œï¼Œä¸å›å…±äº«ã€‚

# äºŒã€æ¦‚è¿°

ä½œä¸ºä¸€åå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šæ¥è§¦åˆ° `xxx install`ï¼ŒåŒ…ç®¡ç†å·¥å…·åœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹åŒ…ç®¡ç†å·¥å…·çš„å‘å±•å†ç¨‹ï¼Œäº†è§£å…¶å‘å±•è„‰ç»œï¼Œæ„Ÿå—å†å²çº¢å°˜ã€‚

![](./IMGS/pkgm_histories.jpg)

> å›¾ç‰‡æ‘˜è‡ªï¼š[JavaScript package manager history >>](https://time.graphics/line/602344)

> ç»˜å›¾å·¥å…·ï¼š[time.graphics >>](https://time.graphics/)

2010å¹´ä¹‹å‰ï¼Œå½“æˆ‘ä»¬éœ€è¦å¼•ç”¨ä¸€ä¸ªä¸‰æ–¹åº“æ—¶ï¼Œæ¯”å¦‚ [jQuery](https://jquery.com/)ï¼Œæˆ‘ä»¬åšçš„æœ€å¤šçš„äº‹æƒ…å°±æ˜¯å…ˆåœ¨ç™¾åº¦æœç´¢jQueryè¿›å…¥å…¶å®˜ç½‘ï¼Œç„¶åä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„å‹ç¼©åŒ…åˆ°æœ¬åœ°å¹¶è§£å‹åˆ°é¡¹ç›®ä¸­ä¸€ä¸ªå« **/libs** çš„ç›®å½•ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼•å…¥ä½¿ç”¨å®ƒäº†ï¼Œå½“ç„¶ï¼Œæƒ³è¦æ›´æ–¹ä¾¿çš„è¯ä¹Ÿå¯ä»¥ç›´æ¥å°† CDN é“¾æ¥ç²˜è´´åˆ° HTML ä¸­ã€‚

å¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¼šé—®ï¼Œè¿™æ ·ææˆ‘ä»¬å¦‚ä½•å»è¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ï¼Ÿç‰ˆæœ¬å·ç®¡ç†ï¼Ÿä¾èµ–å‡çº§å‘¢ï¼Ÿä¸å­˜åœ¨çš„ï¼åœ¨å½“æ—¶ï¼Œå‰ç«¯å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œè¿™ç§æ¨¡å¼å‹‰å¼ºæ¥è¯´ä¹Ÿä¸æ˜¯ä¸èƒ½ç”¨ã€‚

2009 å¹´ï¼ŒNode.js è¯ç”Ÿï¼Œnpmï¼ˆ**N**ode.js **P**ackage **M**anagerï¼‰çš„é›å½¢ä¹Ÿæ­£åœ¨é…é…¿ã€‚

2010å¹´1æœˆï¼Œnpm ç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬å‘å¸ƒ

2015å¹´5æœˆï¼Œnpmå‘å¸ƒv3.x ç‰ˆæœ¬

2016å¹´1æœˆï¼Œpnpm æäº¤è¯ç”Ÿå¹¶å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬

2016å¹´ï¼Œyarnç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ï¼ˆ*0.x*ï¼‰å‘å¸ƒ

# ä¸‰ã€æ­£æ–‡

## 1. npm

2020å¹´1æœˆï¼Œnpmç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒï¼Œå¾ˆå¤šäººè®¤ä¸º npm æ˜¯ **N**ode **P**ackage **M**anagerï¼ˆ*NodeåŒ…ç®¡ç†å·¥å…·*ï¼‰çš„ç¼©å†™ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œè€Œä¸” npm ä¹Ÿæ ¹æœ¬ä¸æ˜¯ä»»ä½•çŸ­è¯­çš„ç¼©å†™ã€‚

> Npm å®˜æ–¹è¾Ÿè°£ï¼ˆåŸæ–‡ï¼‰ï¼š
>
> #### Is "npm" an acronym for "Node Package Manager"?
>
> Contrary to popular belief, **`npm`** **is not** in fact an acronym for "Node Package Manager"; It is a recursive bacronymic abbreviation for **"npm is not an acronym"** (if the project was named "ninaa", then it would be an acronym). The precursor to **`npm`** was actually a bash utility named **"pm"**, which was the shortform name of **"pkgmakeinst"** - a bash function that installed various things on various platforms. If **`npm`** were to ever have been considered an acronym, it would be as "node pm" or, potentially "new pm".
>
> æ‘˜è‡ªnpmè‡ªè¿°ï¼ŒåŸæ–‡åœ°å€ï¼šhttps://www.npmjs.com/package/npm

å®ƒçš„å‰èº«å…¶å®æ˜¯åä¸º pmï¼ˆpkgmakeinstï¼‰ çš„ bash å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨å„ç§å¹³å°ä¸Šå®‰è£…å„ç§ä¸œè¥¿ã€‚

ç¡¬è¦è¯´ç¼©å†™çš„è¯ï¼Œä¹Ÿåº”è¯¥æ˜¯ node pm æˆ–è€… new pmã€‚ä»…ä»…åªæ˜¯å› ä¸ºç°åœ¨npmå’ŒnodeJSæ†ç»‘åœ¨ä¸€èµ·ï¼Œå› æ­¤ç»å¤§å¤šæ•°çš„å°ä¼™ä¼´ä¼šæ½œæ„è¯†çš„è®¤ä¸ºnpmå°±æ˜¯  **N**ode **P**ackage **M**anager çš„ç¼©å†™ã€‚

> -  npm ä»æœ€æ—©æœŸåˆ°v7.3.0ä¹‹é—´çš„åšå®¢æ–‡å­—å‚è€ƒ [npm Blog Archive](https://blog.npmjs.org/)ï¼Œä¹‹åçš„ç‰ˆæœ¬å¯ä»¥åˆ° github å¯¹åº”çš„ç‰ˆæœ¬ [Changelog](https://docs.npmjs.com/cli/v8/using-npm/changelog) ä¸ŠæŸ¥æ‰¾ã€‚
> - [How npm Works](https://npm.github.io/how-npm-works-docs/index.html) è®²è§£äº†npm v1/v2/v3çš„å·¥ä½œæ–¹å¼ã€‚

### å‘å±•å†ç¨‹

2009å¹´Node.jsè¯ç”Ÿï¼Œnpmçš„é›å½¢ä¹Ÿåœ¨é…é…¿ã€‚

1. 2011å¹´5æœˆï¼šå‘å¸ƒ [v1.0](https://nodejs.org/es/blog/npm/npm-1-0-released)
2. 2014å¹´9æœˆï¼šå‘å¸ƒ [v2.0](https://blog.npmjs.org/post/98131109725/npm-2-0-0.html)
3. 2015å¹´6æœˆï¼šå‘å¸ƒ [v3.0](https://github.com/npm/npm/releases/tag/v3.0.0)

### å®‰è£…ä¾èµ–æ ‘è§£æ

æ—©æœŸçš„npmè®¾è®¡éå¸¸ç®€å•ï¼Œé‡‡ç”¨ **åµŒå¥—çš„ node_modules ç»“æ„**ï¼Œåœ¨å®‰è£…ä¾èµ–æ—¶éœ€è¦å°†ä¾èµ–æ”¾åˆ°é¡¹ç›®çš„ node_modules ç›®å½•ä¸‹ï¼Œå¦‚æœæŸä¸ªé¡¹ç›®ç›´æ¥ä¾èµ–æ¨¡å— Aï¼Œè¿˜é—´æ¥ä¾èµ–æ¨¡å— Bï¼Œåˆ™æ¨¡å— B ä¼šè¢«ä¸‹è½½åˆ°æ¨¡å— A çš„ node_modules ç›®å½•ä¸‹ï¼Œå¾ªç¯å¾€å¤ï¼Œæœ€ç»ˆå½¢æˆä¸€é¢—å·¨å¤§çš„ä¾èµ–æ ‘ã€‚

è¿™æ ·çš„ node_modules ç›®å½•è™½ç„¶ç»“æ„ç®€å•æ˜äº†ã€ç¬¦åˆé¢„æœŸï¼Œä½†å¯¹å¤§å‹é¡¹ç›®å¹¶ä¸å‹å¥½ï¼Œæ¯”å¦‚å…¶ä¸­å¯èƒ½æœ‰å¾ˆå¤šé‡å¤çš„ä¾èµ–åŒ…ï¼ŒåŠ¿å¿…ä¼šé€ æˆç©ºé—´æµªè´¹ï¼Œnode_modules åŠ¨è¾„ä¸Šç™¾å…†ï¼Œ æœ€ç»ˆä¼šå ªæ¯”é»‘æ´ï¼Œå¾ˆå¿«å°±èƒ½æŠŠç£ç›˜å æ»¡ã€‚è€Œä¸”ä¾èµ–åµŒå¥—çš„æ·±åº¦ä¹Ÿä¼šååˆ†å¯æ€•ï¼Œå½¢æˆ **ä¾èµ–åœ°ç‹±**ã€‚

<img src="./IMGS/pkgs_black_hole.jpeg" style="zoom:50%;" />

> æç¤ºï¼šå›¾ç‰‡æ‘˜è‡ª [https://github.com/tj/node-prune](https://github.com/tj/node-prune)

å¦‚ä½•ç†è§£ **ä¾èµ–åœ°ç‹±** å‘¢ï¼Ÿ

- é¡¹ç›®ä¾èµ–æ ‘çš„å±‚çº§éå¸¸æ·±ï¼Œä¸åˆ©äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜
- ä¾èµ–æ ‘çš„ä¸åŒåˆ†æ”¯é‡Œå¯èƒ½å­˜åœ¨åŒç‰ˆæœ¬çš„ä¾èµ–ã€‚æ¯”å¦‚é¡¹ç›®ç›´æ¥ä¾èµ–æ¨¡å— A å’Œæ¨¡å— Bï¼ŒåŒæ—¶åˆéƒ½é—´æ¥ä¾èµ–ç›¸åŒç‰ˆæœ¬çš„æ¨¡å— Cï¼Œé‚£ä¹ˆæ¨¡å— C ä¼šé‡å¤å‡ºç°åœ¨æ¨¡å— A å’Œæ¨¡å— B çš„ node_modules ç›®å½•ä¸‹ã€‚

è¿™ç§é‡å¤å®‰è£…é—®é¢˜æµªè´¹äº†è¾ƒå¤šçš„ç©ºé—´èµ„æºï¼Œä¹Ÿä½¿å¾—å®‰è£…è¿‡ç¨‹è¿‡æ…¢ï¼Œç”šè‡³ä¼šå› ä¸ºç›®å½•å±‚çº§å¤ªæ·±å¯¼è‡´æ–‡ä»¶è·¯å¾„å¤ªé•¿ï¼Œæœ€ç»ˆå¯¼è‡´åœ¨ Windows ç³»ç»Ÿä¸‹åˆ é™¤ node_modules ç›®å½•å¤±è´¥ã€‚å› æ­¤åœ¨ npm v3 ä¹‹å node_modules æ”¹æˆäº† **æ‰å¹³ç»“æ„**ï¼ˆç®€å•ç†è§£å°±æ˜¯ï¼šå°† **å­ä¾èµ–æå‡**æ¥å®ç°æ‰å¹³åŒ–ç»“æ„ï¼Œå°½é‡å°†å­ä¾èµ–é¡¹å®‰è£…åœ¨å®ƒä»¬çš„ä¸»ä¾èµ–æ¨¡å—æ‰€åœ¨çš„ç›®å½•ä¸­ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦æ„å»ºå®Œæ•´çš„ä¾èµ–å…³ç³»æ ‘ï¼Œå› æ­¤ä¼šèŠ±è´¹ä¸€å®šæ—¶é—´ï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´ npm å®‰è£…é€Ÿåº¦è¾ƒæ…¢çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚

æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­ï¼ˆé¡¹ç›®ç›´æ¥ä¾èµ–æ¨¡å— A v1.0ï¼Œæ¨¡å— A v1.0 è¿˜ä»¥æ¥æ¨¡å— B v1.0ï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ä¸åŒç‰ˆæœ¬npmçš„å®‰è£…ç»“æ„å›¾ï¼š

![](./IMGS/npm_deps1.jpg)

å½“é¡¹ç›®ä¸­æ–°æ·»åŠ äº†æ¨¡å— C v1.0 ä¾èµ–ï¼Œè€Œå®ƒåˆä¾èµ–å¦ä¸€ä¸ªç‰ˆæœ¬çš„æ¨¡å— B v2.0 æ—¶ï¼Œè‹¥ç‰ˆæœ¬è¦æ±‚ä¸ä¸€è‡´å¯¼è‡´å†²çªï¼Œå³æ¨¡å— B v2.0 æ²¡åŠæ³•æ”¾åœ¨é¡¹ç›®å¹³é“ºç›®å½•ä¸‹çš„ node_modules ä¸­ï¼Œæ­¤æ—¶ï¼Œnpm v3 ä¼šå°†æ¨¡å— C v1.0 ä¾èµ–çš„æ¨¡å— B v2.0 å®‰è£…åœ¨æ¨¡å— C v1.0 çš„ node_modules ç›®å½•ä¸‹ã€‚æ­¤æ—¶ï¼Œä¸åŒç‰ˆæœ¬çš„ npm çš„å®‰è£…ç»“æ„å¯¹æ¯”å¦‚ä¸‹æ‰€ç¤ºã€‚

![](./IMGS/npm_deps2.jpg)

æ€è€ƒï¼šä¸ºä»€ä¹ˆè¿˜æœ‰åµŒå¥—å‘¢ï¼Ÿ

å› ä¸ºä¸€ä¸ªåŒ…æ˜¯å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬çš„ï¼Œæå‡åªèƒ½æå‡ä¸€ä¸ªï¼Œæ‰€ä»¥åé¢å†é‡åˆ°ç›¸åŒåŒ…çš„ä¸åŒç‰ˆæœ¬æ—¶ï¼Œè¿˜æ˜¯ä¼šç”¨åµŒå¥—çš„æ–¹å¼ï¼Œå› æ­¤ï¼Œæµªè´¹ç£ç›˜ç©ºé—´çš„é—®é¢˜æ²¡æœ‰å¾—åˆ°å½»åº•çš„è§£å†³ï¼ŒåŒæ—¶è¿˜å¢åŠ äº†ä¾èµ–åŒ…çš„ **ä¸ç¡®å®šæ€§**ï¼Œæ¯”å¦‚æ¨¡å— B v1.0 å’Œ æ¨¡å— B v2.0 åˆ°åº•æå‡å“ªä¸€ä¸ªæ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™å–å†³äºå®‰è£…é¡ºåºï¼Œè¿™ç§ä¸ç¡®å®šæ€§ä¸ºé¡¹ç›®çš„ä¾èµ–é—®é¢˜è§£å†³å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨npm v3 ä¸­ï¼ŒåŠ å…¥é¡¹ç›®è¿˜éœ€è¦ä¾èµ–ä¸€ä¸ªæ¨¡å— D v1.0ï¼Œè€Œæ¨¡å— D v1.0 ä¹Ÿä¾èµ–æ¨¡å— B v2.0ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å®‰è£…ç»“æ„å›¾ï¼š

![](./IMGS/npm_deps3.jpg)

è¿™é‡Œæˆ‘æƒ³è¯·ä½ æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆæ˜¯æ¨¡å— B v1.0 å‡ºç°åœ¨é¡¹ç›®é¡¶å±‚ node_modules ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯æ¨¡å— B v2.0 å‡ºç°åœ¨é¡¶å±‚ node_modules ç›®å½•ä¸­å‘¢?

å…¶å®è¿™ **å–å†³äºæ¨¡å—** A v1.0 å’Œæ¨¡å— C v1.0 **çš„å®‰è£…é¡ºåº**ã€‚å› ä¸ºæ¨¡å— A v1.0 å…ˆå®‰è£…ï¼Œæ‰€ä»¥æ¨¡å— A v1.0 çš„ä¾èµ–æ¨¡å— B v1.0 ä¼šç‡å…ˆè¢«å®‰è£…åœ¨é¡¶å±‚ node_modules ç›®å½•ä¸‹ï¼Œæ¥ç€æ¨¡å— C v1.0 å’Œæ¨¡å— D v1.0ä¾ ä¾æ¬¡è¢«å®‰è£…ï¼Œæ¨¡å— C v1.0 å’Œæ¨¡å— D v1.0 çš„ä¾èµ–æ¨¡å— B v2.0 å°±ä¸å¾—ä¸è¢«å®‰è£…åœ¨æ¨¡å— C v1.0 å’Œæ¨¡å— D v1.0 çš„ node_modules ç›®å½•ä¸‹äº†ã€‚**å› æ­¤ï¼Œæ¨¡å—çš„å®‰è£…é¡ºåºå¯èƒ½å½±å“ node_modules ä¸‹çš„æ–‡ä»¶ç»“æ„**ã€‚

å‡è®¾è¿™æ—¶é¡¹ç›®ä¸­åˆæ·»åŠ äº†ä¸€ä¸ªæ¨¡å— E v1.0 ï¼Œå®ƒä¾èµ–æ¨¡å— B v1.0 ï¼Œå®‰è£…æ¨¡å— E v1.0 ä¹‹åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æ„ã€‚

![](./IMGS/npm_deps4.jpg)

æ­¤æ—¶ï¼Œåœ¨å¯¹åº”çš„ package.json æ–‡ä»¶ä¸­ï¼Œä»¥æ¥æ¨¡å—çš„é¡ºåºå¦‚ä¸‹ï¼š

```json
{
	A: "1.0",
  C: "1.0",
  D: "1.0",
  E: "1.0"
}
```

å¦‚æœæˆ‘ä»¬æƒ³å°† æ¨¡å— A v1.0 çš„ç‰ˆæœ¬æ›´æ–°ä¸º v2.0ï¼Œå¹¶è®©æ¨¡å— A v2.0 ä¾èµ–æ¨¡å— B v2.0ï¼Œnpm v3 ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ•´ä¸ªè¿‡ç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

1. åˆ é™¤æ¨¡å— A v1.0
2. å®‰è£…æ¨¡å— A v2.0
3. ç•™ä¸‹æ¨¡å— B v1.0ï¼Œå› ä¸ºæ¨¡å— E v1.0 è¿˜åœ¨ä¾èµ–å®ƒ
4. å°†æ¨¡å— B v2.0 å®‰è£…åœ¨æ¨¡å— A v2.0 ä¸‹ï¼Œå› ä¸ºé¡¶å±‚å·²ç»æœ‰æ¨¡å— B v1.0 äº†ã€‚

æ›´æ–°åï¼Œå®‰è£…ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![](./IMGS/npm_deps5.jpg)

æ­¤æ—¶ï¼Œæ¨¡å— B v2.0 åˆ†åˆ«å‡ºç°åœ¨äº† æ¨¡å— A v2.0ã€æ¨¡å—C v1.0ã€æ¨¡å— D v1.0 ä¸‹ â€”â€” å®ƒé‡å¤å­˜åœ¨äº†ã€‚

é€šè¿‡è¿™ä¸€ç³»åˆ—æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œnpm åŒ…çš„ å®‰è£…é¡ºåºå¯¹äºä¾èµ–æ ‘çš„å½±å“å¾ˆå¤§ã€‚æ¨¡å—å®‰è£…é¡ºåºå¯èƒ½å½±å“ node_modules ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡ã€‚

å¯¹äºä¸Šè¿°æƒ…å†µï¼Œä¸€ä¸ªæ›´ç†æƒ³çš„å®‰è£…ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š

![](./IMGS/npm_deps6.jpg)

å›åˆ°åˆšåˆšçš„æ­¥éª¤ï¼Œå‡è®¾æ¨¡å— E v2.0 å‘å¸ƒäº†ï¼Œå¹¶å…¶å®ƒä¹Ÿä¾èµ–æ¨¡å— B v2.0ï¼Œnpm v3 è¿›è¡Œæ›´æ–°æ—¶ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ

1. åˆ é™¤æ¨¡å— E v1.0

2. å®‰è£…æ¨¡å— E v2.0

3. åˆ é™¤æ¨¡å— B v1.0

4. å®‰è£…æ¨¡å— B v2.0 åˆ°é¡¶å±‚ node_modules ç›®å½•ä¸‹ï¼Œå› ä¸ºç°åœ¨é¡¶å±‚æ²¡æœ‰ä»»ä½•ç‰ˆæœ¬çš„ æ¨¡å— B äº†


æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å®‰è£…ç»“æ„ï¼š

![](./IMGS/npm_deps7.jpg)



æ˜æ˜¾å¯ä»¥çœ‹åˆ°ï¼Œç»“æ„ä¸­å‡ºç°äº†è¾ƒå¤šé‡å¤çš„æ¨¡å— B v2.0ã€‚æˆ‘ä»¬å¯ä»¥åˆ é™¤ node_modules ç›®å½•ï¼Œé‡æ–°å®‰è£…ï¼Œåˆ©ç”¨ npm çš„ä¾èµ–è§£æèƒ½åŠ›ï¼Œå¾—åˆ°ä¸€ä¸ªæ›´æ¸…çˆ½çš„ç»“æ„ã€‚

å®é™…ä¸Šï¼Œæ›´ä¼˜é›…çš„æ–¹å¼æ˜¯ä½¿ç”¨ npm dedupe å‘½ä»¤ï¼Œæ›´æ–°åçš„å®‰è£…ç»“æ„å›¾å¦‚ä¸‹ï¼š

![](./IMGS/npm_deps8.jpg)

### å¹½çµä¾èµ–

æ‰å¹³åŒ–çš„ç»“æ„ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†åµŒå¥—è¿‡æ·±ã€ä½“ç§¯è¿‡å¤§çš„é—®é¢˜ï¼Œä½†åˆå¼•å‘äº†æ–°çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ **å¹½çµä¾èµ–**ã€‚

ä¹Ÿå°±æ˜¯ä½ æ˜æ˜æ²¡æœ‰å£°æ˜åœ¨ dependencies é‡Œçš„ä¾èµ–ï¼Œä½†åœ¨ä»£ç é‡Œå´å¯ä»¥ require è¿›æ¥ï¼Œè¿™ä¸ªä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºéƒ½é“ºå¹³äº†å˜›ï¼Œé‚£ä¾èµ–çš„ä¾èµ–ä¹Ÿæ˜¯å¯ä»¥æ‰¾åˆ°çš„ï¼Œä½†æ˜¯è¿™æ ·æ˜¯æœ‰éšæ‚£çš„ï¼Œå› ä¸ºæ²¡æœ‰æ˜¾å¼ä¾èµ–ï¼Œä¸‡ä¸€æœ‰ä¸€å¤©åˆ«çš„åŒ…ä¸ä¾èµ–è¿™ä¸ªåŒ…äº†ï¼Œé‚£ä½ çš„ä»£ç ä¹Ÿå°±ä¸èƒ½è·‘äº†ï¼Œå› ä¸ºä½ ä¾èµ–è¿™ä¸ªåŒ…ï¼Œä½†æ˜¯ç°åœ¨ä¸ä¼šè¢«å®‰è£…äº†ï¼Œè¿™å°±æ˜¯å¹½çµä¾èµ–çš„é—®é¢˜ã€‚

### å°è¯•

ä¸ºäº†éªŒè¯ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å»å°è¯•ä½¿ç”¨ npm v2/v3 ç‰ˆæœ¬ï¼Œå½“ç„¶ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ [nvm](https://github.com/nvm-sh/nvm)ï¼ˆ**N**ode **V**ersion **M**anager å³ Nodeç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼‰æŠŠå°†nodeåˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬

1. npm2.xï¼šåˆ‡æ¢nodeç‰ˆæœ¬è‡³ v4.9.1 å³å¯
2. npm3.xï¼šåˆ‡æ¢nodeç‰ˆæœ¬è‡³ v6.11.1 å³å¯

> æç¤ºï¼š
>
> - ä¸Šé¢å…³äºnodeç‰ˆæœ¬ï¼Œåªæ˜¯å¤§æ¦‚ç‰ˆæœ¬ï¼Œå¹¶ä¸æ˜¯è¯´ npm 2.x æ˜¯åœ¨ node v4.9.1 æ—¶å‘å¸ƒï¼Œåªæ˜¯è¯´åœ¨è¿™ä¸ªnodeç‰ˆæœ¬ä¸‹ä½ å¯ä»¥ä½¿ç”¨npm 2.xã€‚
> - æ‚¨ä¹Ÿå¯ä»¥ç”¨ [`n`](https://github.com/tj/n) ç®¡ç†æ‚¨çš„ nodeç‰ˆæœ¬ã€‚

> æç¤ºï¼š

```shell
$ nvm install v4.9.1
$ nvm use v4.9.1
Now using node v4.9.1 (npm v2.15.11)
$ node -v && npm -v
v4.9.1
2.15.11
```

ç°åœ¨æˆ‘ä»¬æ„å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå®‰è£…ä¾èµ–çœ‹æ•ˆæœï¼š

```shell
$ cd Desktop && mkdir pkgtest && cd pkgtest && nvm use v4.9.1
$ npm init -y 
$ npm i mod-a@1.0.0 mod-c@1.0.0 mod-d@1.0.0
$ code .
```

> CLIï¼š*cd Desktop && mkdir pkgtest && cd pkgtest && nvm use v4.9.1 && npm init -y && npm i mod-a@1.0.0 mod-c@1.0.0 mod-d@1.0.0 && code .*

æˆ‘ä»¬é€šè¿‡ `tree` æŒ‡ä»¤æŸ¥çœ‹ä¸€ä¸‹ `node_modules` çš„ç›®å½•ç»“æ„ã€‚

### å®‰è£…æœºåˆ¶

![](./IMGS/npm_install_mechanism.jpg)

## 2. yarn

yarn æ˜¯ä¸€ä¸ªç”± Facebookã€Googleã€Exponent å’Œ Tilde è”åˆæ„å»ºçš„å¿ƒå¾— JavaScrip åŒ…ç®¡ç†å™¨ã€‚2016 å¹´ 6 æœˆ ï¼Œyarn æ­£å¼åœ¨ github ä¸Šæäº¤ä»£ç ï¼Œåˆå§‹ç‰ˆæœ¬ä¸º [0.2.0](https://github.com/yarnpkg/yarn/tree/0.2.0) ï¼Œå½“æ—¶åå­—å« **`kpm(fbkpm)`**ã€‚åŒå¹´10æœˆï¼ŒFacebookåœ¨å®˜ç½‘ä¸Šå‘å¸ƒäº†è¿™ç¯‡æ–‡ç« ï¼š[Yarn: A new package manager for JavaScript](https://engineering.fb.com/2016/10/11/web/yarn-a-new-package-manager-for-javascript/) 

yarn å­˜åœ¨çš„æ„ä¹‰ä¸»è¦æ˜¯ä¸ºäº†è§£å†³npmåœ¨ **ä¸€è‡´æ€§**ã€**å®‰å…¨æ€§**ã€**ç¦»çº¿å®‰è£…** å’Œ **æ€§èƒ½** æ–¹é¢çš„é—®é¢˜ï¼Œé‚£yarnæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿ

1. ä¸€è‡´æ€§ï¼šå¢åŠ lockfilesï¼ˆ*yarn.lock*ï¼‰ï¼Œè®°å½•æ‰€æœ‰è¢«å®‰è£…ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œå®‰è£…æ—¶å°†ä¼˜å…ˆå‚è€ƒ lock æ–‡ä»¶æä¾›çš„ç‰ˆæœ¬ã€‚
2. ç¦»çº¿å®‰è£…ï¼šæ¯æ¬¡ä»ç½‘ç»œä¸‹è½½ä¸€ä¸ªä¾èµ–åŒ…æ—¶ï¼Œyarnéƒ½ä¼šå°†å…¶æ”¾åœ¨æœ¬åœ°çš„å…¨å±€ç¼“å­˜ä¸­ï¼Œä¸‹æ¬¡ä¸‹è½½ä¼šä¼˜å…ˆåœ¨å…¨å±€ç¼“å­˜ç›®å½•ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰ï¼Œå°†å…¶ Copy åˆ°å½“å‰ç›®å½•ä¸‹.
3. æ€§èƒ½é—®é¢˜ï¼šå¹¶è¡Œå®‰è£…ï¼Œæ— è®ºæ˜¯ npm è¿˜æ˜¯ yarnï¼Œåœ¨å®‰è£…æ—¶éƒ½ä¼šæ‰§è¡Œä¸€ç³»åˆ—ä»»åŠ¡ã€‚npm æ˜¯æŒ‰ç…§é˜Ÿåˆ—æ‰§è¡Œæ¯ä¸€ä¸ª packageï¼Œå½“å‰çš„package å®‰è£…å®Œæˆåï¼Œå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªpackageï¼Œè€Œ yarn æ˜¯åŒæ­¥æ‰§è¡Œæ‰€æœ‰çš„ä»»åŠ¡ã€‚
4. **æ‰å¹³åŒ–çš„ç›®å½•ç»“æ„**ï¼šèŠ‚çœç£ç›˜ç©ºé—´

yarn ä¸€å‘å¸ƒï¼Œå°±å—åˆ°äº†å¹¿æ³›çš„å…³æ³¨ï¼Œå½“å¤©ï¼Œnpm å®˜æ–¹åšå®¢å‘è¡¨äº†ä¸€ç¯‡ [Hello, Yarn!](https://blog.npmjs.org/post/151660845210/hello-yarn) çš„æ–‡ç« ã€‚æ­å–œäº† yarn çš„å¼€æºï¼Œå¹¶å¯¹ yarn å›¢é˜ŸåŠ facebook ä¸ºç¤¾åŒºåŠæ•´ä¸ª npm ç”Ÿæ€åšå‡ºçš„è´¡çŒ®ç»™äºˆäº†å¾ˆé«˜çš„è¯„ä»·ï¼Œåç»­çš„ npm v5 ä¹Ÿå¸çº³äº† yarn ä¼˜ç§€çš„ lock å’Œç¼“å­˜æœºåˆ¶ã€‚

è‡³æ­¤ï¼ŒåŒ…ç®¡ç†æœºåˆ¶çš„å¤§æ¥¼çœ‹ä¼¼å·²ç»å»ºæˆï¼Œä½†ä¾æ—§æœ‰ä¸¤æœµä¹Œäº‘é£˜è¡åœ¨ä¸Šç©ºï¼š

1. å¤šé¡¹ç›®ä¹‹é—´çš„å¤ç”¨é—®é¢˜
2. éšå¼ä¾èµ–

é‚£ç¤¾åŒºæœ‰æ²¡æœ‰è§£å†³è¿™ä¿©é—®é¢˜çš„æ€è·¯å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œè¿™ä¸æ˜¯ pnpm å°±å‡ºæ¥äº†å˜›ã€‚é‚£ pnpm æ˜¯æ€ä¹ˆè§£å†³è¿™ä¿©é—®é¢˜çš„å‘¢ï¼Ÿç»§ç»­çœ‹ä¸‹æ–‡ã€‚

## 3. pnpm

pnpmï¼ˆ**P**erformant **npm**ï¼Œ **é«˜æ€§èƒ½** çš„npmï¼‰ â€”â€” å¿«é€Ÿçš„ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å·¥å…·ï¼ˆæ‘˜è‡ª [å®˜ç½‘](https://pnpm.io/zh/)ï¼‰ã€‚

å®ƒç»“åˆ **è½¯ç¡¬é“¾æ¥** ä¸æ–°çš„ä¾èµ–ç»„ç»‡æ–¹å¼ï¼Œå¤§å¤§æå‡äº†åŒ…ç®¡ç†çš„æ•ˆç‡ï¼Œä¹ŸåŒæ—¶è§£å†³äº† â€œ**å¹½çµä¾èµ–**â€ çš„é—®é¢˜ã€‚

### è½¯ç¡¬é“¾æ¥

è½¯é“¾æ¥å’Œç¡¬é“¾æ¥éƒ½æ˜¯ç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•ä¹‹é—´çš„å…³è”å…³ç³»çš„æ¦‚å¿µï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ï¼š

1. **è½¯é“¾æ¥ï¼ˆSymbolic Linkï¼‰**ï¼š

   - è½¯é“¾æ¥æ˜¯ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„å¼•ç”¨ï¼Œç±»ä¼¼äºä¸€ä¸ª**å¿«æ·æ–¹å¼**ã€‚
   - å®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æˆ–ç›®å½•é¡¹ï¼Œè¯¥é¡¹åŒ…å«æŒ‡å‘åŸå§‹æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ä¿¡æ¯ã€‚
   - è½¯é“¾æ¥å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿã€è·¨ç£ç›˜åˆ†åŒºï¼Œç”šè‡³å¯ä»¥é“¾æ¥åˆ°ä¸å­˜åœ¨çš„ç›®æ ‡ã€‚
   - å¦‚æœåŸå§‹æ–‡ä»¶æˆ–ç›®å½•è¢«åˆ é™¤æˆ–ç§»åŠ¨ï¼Œè½¯é“¾æ¥å°†æˆä¸ºæ­»é“¾æ¥ï¼ˆbroken linkï¼‰ï¼Œä¸å†æœ‰æ•ˆã€‚
   - è½¯é“¾æ¥å¯ä»¥é“¾æ¥åˆ°æ–‡ä»¶æˆ–ç›®å½•ã€‚

   è½¯è¿æ¥è¯­æ³•ï¼š

   ```
   ln -s [ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•] [é“¾æ¥åç§°]
   ```

   ```shell
   $ echo 'Hello, world!' > a.txt
   $ ln -s a.txt b.txt
   $ ls -li <link_names>
   ```

2. **ç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰**ï¼š

   - ç¡¬é“¾æ¥æ˜¯å¤šä¸ªæ–‡ä»¶ç›®å½•é¡¹æŒ‡å‘ç›¸åŒçš„ç‰©ç†æ•°æ®å—çš„æƒ…å†µã€‚
   - å®ƒä»¬å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªæ–‡ä»¶çš„å¤šä¸ªåˆ«åï¼Œ**ä¸å ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´**ã€‚
   - ç¡¬é“¾æ¥åªèƒ½åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿçš„ inode ç»“æ„ã€‚
   - å¦‚æœåˆ é™¤åŸå§‹æ–‡ä»¶ï¼Œç¡¬é“¾æ¥ä»ç„¶æœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬æŒ‡å‘çš„æ˜¯ç›¸åŒçš„æ•°æ®å—ã€‚
   - ç¡¬é“¾æ¥åªèƒ½é“¾æ¥åˆ°æ–‡ä»¶ï¼Œä¸èƒ½é“¾æ¥åˆ°ç›®å½•ã€‚

   ç¡¬é“¾æ¥è¯­æ³•ï¼š

   ```
   ln [ç›®æ ‡æ–‡ä»¶] [é“¾æ¥åç§°]
   ```

   ```shell
   $ echo 'Hello, world!' > a.rtf
   $ ln a.rtf b.rtf
   $ ls -li <link_names>
   ```

### ä¼˜åŠ¿

å‚è€ƒé˜…è¯»ï¼š[Why should we use pnpm?](https://www.kochan.io/nodejs/why-should-we-use-pnpm.html)

è¯·çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š

![](./IMGS/pkgm_pnpm.jpeg)

> å›¾ç‰‡æ¥æºï¼š[What is pnpm? Is it really so fast and space-efficient?](https://dev.to/stackblitz/what-is-pnpm-and-is-it-really-so-fast-and-space-efficient-29la)

1. ä¾èµ–ä¼šè¢«å­˜å‚¨åœ¨ **å†…å®¹å¯å¯»å€** çš„å­˜å‚¨ä¸­ï¼ˆ*.pnpm-store*ï¼‰ï¼Œç›¸åŒç‰ˆæœ¬çš„åŒ…åªä¼šå­˜å‚¨ä¸€ä»½ï¼Œå¦‚æœä½ ç”¨åˆ°äº†æŸä¾èµ–é¡¹çš„ä¸åŒç‰ˆæœ¬ï¼Œåªä¼šå°†ä¸åŒç‰ˆæœ¬é—´æœ‰å·®å¼‚çš„æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªåŒ…æœ‰100ä¸ªæ–‡ä»¶ï¼Œè€Œå®ƒçš„æ–°ç‰ˆæœ¬åªæ”¹å˜äº†å…¶ä¸­1ä¸ªæ–‡ä»¶ã€‚é‚£ä¹ˆ `pnpm update` æ—¶åªä¼šå‘å­˜å‚¨ä¸­å¿ƒé¢å¤–æ·»åŠ 1ä¸ªæ–°æ–‡ä»¶ï¼Œè€Œä¸ä¼šå› ä¸ºä»…ä»…ä¸€ä¸ªæ–‡ä»¶çš„æ”¹å˜å¤åˆ¶æ•´ä¸ªæ–°ç‰ˆæœ¬åŒ…çš„å†…å®¹ã€‚

   ğŸ“Œ pnpm-storeç›®å½•ï¼š *node_modules/.modules.yaml â†’ storeDir*

2. `nodule_modules/.pnpm` ç›®å½•ä¸‹ä»¥æ‰å¹³ç»“æ„ç®¡ç†æ¯ä¸ªç‰ˆæœ¬åŒ…çš„æºç å†…å®¹ï¼Œä»¥ç¡¬é“¾æ¥çš„æ–¹å¼æŒ‡å‘ pnpm-store ä¸­çš„æ–‡ä»¶åœ°å€ã€‚

3. `node_modules` ä¸‹å®‰è£…çš„åŒ…ä¸ºæ ‘å½¢ç»“æ„ï¼Œç¬¦åˆnodeå°±è¿‘æŸ¥æ‰¾è§„åˆ™ï¼Œä»¥è½¯è¿æ¥æ–¹å¼å°†å†…å®¹æŒ‡å‘ `node_modules/.pnpm` ä¸­çš„åŒ…ã€‚

æ‰€ä»¥ï¼Œæ¯ä¸ªåŒ…çš„å¯»æ‰¾éƒ½è¦ç»è¿‡ä¸‰å±‚ç»“æ„ï¼š

`node_modules/package-a` â†’ è½¯è¿æ¥ â†’ `node_modules/.pnpm/package-a@1.0.0/node_modules/package-a` â†’ ç¡¬é“¾æ¥ â†’ `~/.pnpm-store/v3/files/00/xxxxxx`

ç»è¿‡è¿™ä¸‰å±‚å¯»å€å¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ˜¯ä¸‰å±‚ï¼Œè€Œä¸æ˜¯ä¸¤å±‚æˆ–è€…å››å±‚å‘¢ï¼Ÿ

> **ä¾èµ–æ–‡ä»¶ä¸‰å±‚å¯»å€çš„ç›®çš„**

**ç¬¬ä¸€å±‚**

ç¬¬ä¸€å±‚å¯»æ‰¾ä¾èµ–æ˜¯ `nodejs` æˆ– `webpack` ç­‰è¿è¡Œç¯å¢ƒæˆ–æ‰“åŒ…å·¥å…·è¿›è¡Œçš„ï¼Œä»–ä»¬åœ¨ `node_modules` æ–‡ä»¶å¤¹ä¸­éµå¾ª **å°±è¿‘åŸåˆ™** å¯»æ‰¾ä¾èµ–ï¼Œæ‰€ä»¥ç¬¬ä¸€å±‚ä¾èµ–æ–‡ä»¶åŠ¿å¿…è¦å†™åœ¨æœ€å¤–å±‚çš„ `node_modules` ä¸‹ï¼Œä¸€æ–¹é¢éµå¾ªä¾èµ–å¯»æ‰¾è·¯å¾„ï¼Œå¦ä¸€æ–¹é¢æ²¡æœ‰å°†ä¾èµ–éƒ½æ‹åˆ°ä¸Šçº§ç›®å½•ï¼Œä¹Ÿæ²¡æœ‰å°†ä¾èµ–æ‰“å¹³ï¼Œç›®çš„å°±æ˜¯è¿˜åŸæœ€è¯­ä¹‰åŒ–çš„ `package.json` å®šä¹‰ï¼šå³å®šä¹‰äº†ä»€ä¹ˆåŒ…å°±èƒ½ä¾èµ–ä»€ä¹ˆåŒ…ï¼ˆè§£å†³å¹½çµä¾èµ–çš„é—®é¢˜ï¼‰ï¼Œæ¯ä¸ªåŒ…çš„å­ä¾èµ–ä¹Ÿä»è¯¥åŒ…å†…å¯»æ‰¾ï¼ˆè§£å†³äº†å¤šç‰ˆæœ¬ç®¡ç†çš„é—®é¢˜ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä½¿ `node_modules` æ‹¥æœ‰ä¸€ä¸ªç¨³å®šçš„ç»“æ„ï¼Œå³è¯¥ç›®å½•ç»„ç»‡ç®—æ³•ä»…ä¸ `package.json` å®šä¹‰æœ‰å…³ï¼Œè€Œä¸åŒ…å®‰è£…é¡ºåºæ— å…³ã€‚

å¦‚æœæ­¢æ­¥äºæ­¤ï¼Œè¿™å°±æ˜¯ `npm@2.x` çš„åŒ…ç®¡ç†æ–¹æ¡ˆï¼Œä½†æ­£å› ä¸º `npm@2.x` åŒ…ç®¡ç†æ–¹æ¡ˆæœ€æ²¡æœ‰æ­§ä¹‰ï¼Œæ‰€ä»¥ç¬¬ä¸€å±‚æ²¿ç”¨äº†è¯¥æ–¹æ¡ˆçš„è®¾è®¡ã€‚

**ç¬¬äºŒå±‚**

ä»ç¬¬äºŒå±‚å¼€å§‹ï¼Œå°±è¦è§£å†³ `npm@2.x` è®¾è®¡å¸¦æ¥çš„é—®é¢˜äº†ï¼Œä¸»è¦æ˜¯åŒ…å¤ç”¨çš„é—®é¢˜ã€‚æ‰€ä»¥ç¬¬äºŒå±‚çš„ `node_modules/package-a` > `node_modules/.pnpm/package-a@1.0.0/node_modules/package-a` å¯»å€åˆ©ç”¨**è½¯é“¾æ¥**è§£å†³äº†ä»£ç é‡å¤å¼•ç”¨çš„é—®é¢˜ã€‚ç›¸æ¯” `npm@3` å°†åŒ…æ‰“å¹³çš„è®¾è®¡ï¼Œè½¯é“¾æ¥å¯ä»¥ä¿æŒåŒ…ç»“æ„çš„ç¨³å®šï¼ŒåŒæ—¶ç”¨æ–‡ä»¶æŒ‡é’ˆè§£å†³é‡å¤å ç”¨ç¡¬ç›˜ç©ºé—´çš„é—®é¢˜ã€‚

è‹¥æ­¢æ­¥äºæ­¤ï¼Œä¹Ÿå·²ç»è§£å†³äº†ä¸€ä¸ªé¡¹ç›®å†…çš„åŒ…ç®¡ç†é—®é¢˜ï¼Œä½†é¡¹ç›®ä¸æ­¢ä¸€ä¸ªï¼Œå¤šä¸ªé¡¹ç›®å¯¹äºåŒä¸€ä¸ªåŒ…çš„å¤šä»½æ‹·è´è¿˜æ˜¯å¤ªæµªè´¹ï¼Œå› æ­¤è¦è¿›è¡Œç¬¬ä¸‰æ­¥æ˜ å°„ã€‚

**ç¬¬ä¸‰å±‚**

ç¬¬ä¸‰å±‚æ˜ å°„ `node_modules/.pnpm/package-a@1.0.0/node_modules/package-a` >  `~/.pnpm-store/v3/files/00/xxxxxx`ï¼ˆç¡¬é“¾æ¥ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å·²ç»è„±ç¦»å½“å‰é¡¹ç›®è·¯å¾„ï¼ŒæŒ‡å‘ä¸€ä¸ªå…¨å±€ç»Ÿä¸€ç®¡ç†è·¯å¾„äº†ï¼Œè¿™æ­£æ˜¯è·¨é¡¹ç›®å¤ç”¨çš„å¿…ç„¶é€‰æ‹©ï¼Œç„¶è€Œ `pnpm` æ›´è¿›ä¸€æ­¥ï¼Œæ²¡æœ‰å°†åŒ…çš„æºç ç›´æ¥å­˜å‚¨åœ¨ pnpm-storeï¼Œè€Œæ˜¯å°†å…¶æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªæ–‡ä»¶å—ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚

> **pnpm-storeçš„ç»„ç»‡æ–¹å¼**

pnpm åœ¨ç¬¬ä¸‰å±‚å¯»å€æ—¶é‡‡ç”¨äº†ç¡¬é“¾æ¥æ–¹å¼ï¼Œåœ¨å®‰è£…ä¾èµ–æ—¶ï¼Œpnpmå¹¶æ²¡æœ‰å°†åŒ…çš„æºç ç›´æ¥å­˜å‚¨åœ¨ pnpm-storeï¼Œå³è¿™ä¸ªç¡¬é“¾æ¥ç›®æ ‡æ–‡ä»¶å¹¶ä¸æ˜¯æ™®é€šçš„ npm åŒ…æºç ï¼Œè€Œæ˜¯ä¸€ä¸ªå“ˆå¸Œæ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ç»„ç»‡æ–¹å¼å«åš content-addressableï¼ˆ**åŸºäºå†…å®¹çš„å¯»å€**ï¼‰ã€‚

ç®€å•æ¥è¯´ï¼ŒåŸºäºå†…å®¹çš„å¯»å€æ¯”åŸºäºæ–‡ä»¶åå¯»å€çš„å¥½å¤„æ˜¯ï¼Œå³ä¾¿åŒ…ç‰ˆæœ¬å‡çº§äº†ï¼Œä¹Ÿä»…éœ€å­˜å‚¨æ”¹åŠ¨ Diffï¼Œè€Œä¸éœ€è¦å­˜å‚¨æ–°ç‰ˆæœ¬çš„å®Œæ•´æ–‡ä»¶å†…å®¹ï¼Œåœ¨ç‰ˆæœ¬ç®¡ç†ä¸Šè¿›ä¸€æ­¥èŠ‚çº¦äº†å­˜å‚¨ç©ºé—´ã€‚

pnpm-store çš„ç»„ç»‡æ–¹å¼å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```
~/.pnpm-store
- v3
  - files
    - 00
      - 0a3f1b430ea60805078...
      - 0aa8630182276efd8b6...
      ..
    - 01
```

ä¹Ÿå°±æ˜¯é‡‡ç”¨æ–‡ä»¶å†…å®¹å¯»å€ï¼Œè€Œéæ–‡ä»¶ä½ç½®å¯»å€çš„å­˜å‚¨æ–¹å¼ã€‚ä¹‹æ‰€ä»¥èƒ½é‡‡ç”¨è¿™ç§å­˜å‚¨æ–¹å¼ï¼Œæ˜¯å› ä¸º NPM åŒ…ä¸€ç»å‘å¸ƒå†…å®¹å°±ä¸ä¼šå†æ”¹å˜ï¼Œå› æ­¤é€‚åˆå†…å®¹å¯»å€è¿™ç§å†…å®¹å›ºå®šçš„åœºæ™¯ï¼ŒåŒæ—¶å†…å®¹å¯»å€ä¹Ÿå¿½ç•¥äº†åŒ…çš„ç»“æ„å…³ç³»ï¼Œå½“ä¸€ä¸ªæ–°åŒ…ä¸‹è½½ä¸‹æ¥è§£å‹åï¼Œé‡åˆ°ç›¸åŒæ–‡ä»¶ Hash å€¼æ—¶å°±å¯ä»¥æŠ›å¼ƒï¼Œä»…å­˜å‚¨ Hash å€¼ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±è‡ªç„¶å®ç°äº†å¼€å¤´è¯´çš„ï¼Œ`pnpm` å¯¹äºåŒä¸€ä¸ªåŒ…ä¸åŒçš„ç‰ˆæœ¬ä¹Ÿä»…å­˜å‚¨å…¶å¢é‡æ”¹åŠ¨çš„èƒ½åŠ›ã€‚

> **ç»“è®º**

1. å®‰è£…å¿«é€Ÿï¼Œæ˜¯npmçš„ä¸¤å€
   - pnpmï¼šä¾èµ–è§£æ â†’ æ ¹æ®ä¾èµ–è®¡ç®— node_modules ç›®å½•ç»“æ„ â†’ é“¾æ¥ä¾èµ–é¡¹ï¼ˆå¦‚æœå·²ç»å®‰è£…ï¼Œç›´æ¥é“¾æ¥ï¼‰
   - ä¼ ç»Ÿå®‰è£…è¿‡ç¨‹ï¼šä¾èµ–è§£æ â†’ è·å–ä¾èµ–åŒ… â†’ å°†æ‰€æœ‰ä¾èµ–é¡¹å†™å…¥ node_modules
2. èŠ‚çœç£ç›˜ç©ºé—´ï¼šåŸºäºè½¯ç¡¬é“¾æ¥å®ç°
3. è§£å†³å¹½çµä¾èµ–é—®é¢˜ï¼šéæ‰å¹³çš„ç›®å½•ç»“æ„
4. æ”¯æŒ monorepos

## 4. æ€»ç»“

1. npm2/3 æ˜¯é€šè¿‡åµŒå¥—çš„æ–¹å¼ç®¡ç† node_modules çš„ï¼Œä¼šæœ‰åŒæ ·çš„ä¾èµ–å¤åˆ¶å¤šæ¬¡çš„é—®é¢˜ã€‚
2. npm3+ å’Œ yarn æ˜¯é€šè¿‡æ‰å¹³åŒ–çš„æ–¹å¼æ¥ç®¡ç† node_modules çš„ï¼Œè§£å†³äº†åµŒå¥—æ–¹å¼çš„éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯å¼•å…¥äº†å¹½çµä¾èµ–çš„é—®é¢˜ï¼Œå¹¶ä¸”åŒåçš„åŒ…åªä¼šæå‡ä¸€ä¸ªç‰ˆæœ¬çš„ï¼Œå…¶ä½™çš„ç‰ˆæœ¬ä¾ç„¶ä¼šå¤åˆ¶å¤šæ¬¡ã€‚
3. pnpm åˆ™æ˜¯ç”¨äº†å¦ä¸€ç§æ–¹å¼ï¼Œä¸å†æ˜¯å¤åˆ¶äº†ï¼Œè€Œæ˜¯ä»å…¨å±€ store ç¡¬è¿æ¥åˆ° node_modules/.pnpmï¼Œç„¶åä¹‹é—´é€šè¿‡è½¯é“¾æ¥æ¥ç»„ç»‡ä¾èµ–å…³ç³»ï¼Œè¿™æ ·ä¸ä½†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä¹Ÿæ²¡æœ‰å¹½çµä¾èµ–é—®é¢˜ï¼Œå®‰è£…é€Ÿåº¦è¿˜å¿«ï¼Œä»æœºåˆ¶ä¸Šæ¥è¯´å®Œèƒœ npm å’Œ yarnã€‚

> é™„ä»¶ï¼š[npm-compareï¼šnpm/yarn/pnpm >>](https://npm-compare.com/pnpm,npm,yarn/#timeRange=THREE_YEARS)

# å››ã€ğŸ¤” tyarn/cnpm/npx â“

# äº”ã€å‚è€ƒ

ã€Œ1ã€é˜¿æ±¤å“¥çš„é¼.[ç°ä»£åŒ…ç®¡ç†å™¨çš„è¿›åŒ–å²](https://zhuanlan.zhihu.com/p/496454042).çŸ¥ä¹.2022-04-11

ã€Œ2ã€wxsm.[Node.js åŒ…ç®¡ç†å™¨å‘å±•å²](https://wxsm.space/2021/npm-history/).2021-11-08

ã€Œ3ã€zxg_ç¥è¯´è¦æœ‰å…‰.[pnpm æ˜¯å‡­ä»€ä¹ˆå¯¹ npm å’Œ yarn é™ç»´æ‰“å‡»çš„](https://juejin.cn/post/7127295203177676837).ç¨€åœŸæ˜é‡‘.2022-08-02

ã€Œ4ã€reahink.[JavaScript åŒ…ç®¡ç†å™¨ç®€å²ï¼ˆnpm/yarn/pnpmï¼‰](https://zhuanlan.zhihu.com/p/451025256).çŸ¥ä¹.2022-10-18

ã€Œ5ã€Leecason.[æ·±å…¥æµ…å‡º npm & yarn & pnpm åŒ…ç®¡ç†æœºåˆ¶](https://zhuanlan.zhihu.com/p/526257537).çŸ¥ä¹.2022-06-09

ã€Œ6ã€å°ç« .[å‰ç«¯åŒ…ç®¡ç†è¿›åŒ–ç®€å²](https://zhuanlan.zhihu.com/p/589515346).çŸ¥ä¹.2023-05-25

ã€Œ7ã€è™å¦å…ˆç”Ÿ.[ä¼—ç”Ÿçš†è‹¦ï¼Œæˆ‘é€‰ pnpm](https://xie.infoq.cn/article/64995cac95acef13c5eb62bc9).InfoQ.2023-02-10

ã€Œ8ã€é»„å­æ¯….[ç²¾è¯»ã€Špnpmã€‹](https://cloud.tencent.com/developer/article/2170866).è…¾è®¯äº‘/å¼€å‘è€…ç¤¾åŒº.2022-11-21

ã€Œ9ã€ä¾¯ç­–.å‰ç«¯æ¶æ„å¸ˆÂ·åŸºç¡€å»ºè®¾ä¸æ¶æ„è®¾è®¡æ€æƒ³.ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾.ä¸­å›½å·¥ä¿¡å‡ºç‰ˆé›†å›¢


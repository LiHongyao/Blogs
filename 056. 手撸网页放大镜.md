# æ¦‚è¿°

![](./IMGS/magnifier_egs.gif)

æœ€è¿‘æ¥åˆ°ä»»åŠ¡ï¼Œéœ€å®ç°ã€ç½‘é¡µã€‘æ”¾å¤§é•œçš„æ•ˆæœï¼Œç™¾åº¦æœç´¢ ã€js æ”¾å¤§é•œã€‘å…³é”®å­—ï¼Œåƒç¯‡ä¸€å¾‹çš„éƒ½æ˜¯ä¸€äº›ä»¿æ·˜å®/äº¬ä¸œç­‰ç”µå•†ç½‘ç«™ä¸­æŸ¥çœ‹è§„æ ¼å¤§å›¾çš„æ•ˆæœå®ç°ï¼Œæ ¹æœ¬æ— æ³•æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œäºæ˜¯è‡ªå·±èŠ±äº†ç‚¹æ—¶é—´è°ƒç ”å®ç°ï¼Œè¿™é‡Œä¸»è¦åšä¸€ä¸ªè®°å½•ï¼Œå¹¶åˆ†äº«ç»™å¤§å®¶ã€‚

# éœ€æ±‚æè¿°

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç®€å•æ¢³ç†ä¸€ä¸‹éœ€æ±‚ï¼š

1. å±å¹•å³ä¸‹è§’æ”¾ç½®æ“ä½œæŒ‰é’®ï¼Œç”¨äºå¯ç”¨æˆ–ç¦ç”¨æ”¾å¤§é•œã€‚
2. å¯ç”¨æ”¾å¤§é•œæ—¶ï¼š
   - é¡µé¢ç¦æ­¢äº¤äº’ï¼ˆå¦‚æ»šåŠ¨ï¼‰
   - æ”¾å¤§é•œé»˜è®¤å±•ç¤ºåœ¨å±å¹•æ­£ä¸­é—´
   - æ”¾å¤§é•œæ”¯æŒè°ƒæ•´å°ºå¯¸ï¼ˆå››ä¸ªæ–¹å‘ï¼Œå³ä¸Šã€å³ã€ä¸‹ã€å·¦ï¼‰
   - æ”¾å¤§é•œæ”¯æŒæ‹–æ‹½ä»¥å±•ç¤ºä¸åŒçš„å†…å®¹
   - æ”¾å¤§é•œçš„å†…å®¹ç›´æ¥å‘ˆç°åœ¨æ”¾å¤§é•œå…ƒç´ ä¸­

éœ€æ±‚çœ‹ä¼¼ç®€å•ï¼Œä½†å®é™…ä¸Šéœ€è¦æ³¨æ„çš„ç‚¹ç‰¹åˆ«å¤šï¼Œè¿™é‡Œé¦–å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ä¾›å¤§å®¶æ€è€ƒï¼š

1. å¯ç”¨æ”¾å¤§é•œæ—¶ï¼Œå¦‚ä½•æˆªå–å±å¹•å½“å‰å¯è§†åŒºåŸŸçš„å†…å®¹ï¼Œå¹¶å°†å…¶ä½œä¸ºæ”¾å¤§é•œçš„å›¾ç‰‡æºæ•°æ®ï¼Ÿ
2. ç”±äºç½‘é¡µæ˜¯ç›¸å¯¹äºå±å¹•å·¦ä¸Šè§’å¼€å§‹å¸ƒå±€çš„ï¼Œæ”¾å¤§é•œå¯ä»¥å¾ˆå¥½çš„å¤„ç†å‘å³å’Œå‘ä¸‹çš„å°ºå¯¸è°ƒæ•´ï¼Œé‚£å¦‚æœæ˜¯å‘å·¦æˆ–è€…å‘ä¸Šå‘¢ï¼Ÿ
3. æ‹–æ‹½æ”¾å¤§é•œæ—¶ï¼Œå¦‚ä½•å¤„ç†è¾¹ç•Œï¼Ÿ
4. ....

# æ€è·¯

1. ä¸ºäº†ä¾¿äºå¤ç”¨ï¼Œå°†æ”¾å¤§é•œé€»è¾‘å°è£…æˆç±»ï¼Œæ ·å¼å•ç‹¬æŠ½ç¦»ï¼Œåç»­ä½¿ç”¨æ—¶ç›´æ¥å¼•å…¥ç›¸åº”çš„è„šæœ¬å’Œæ ·å¼å³å¯ã€‚

2. åœ¨å±å¹•æ”¾ç½®æ‚¬æµ®æŒ‰é’®ï¼Œç”¨äºæ¿€æ´»æ”¾å¤§é•œï¼ˆåšæˆå¼€å…³æ•ˆæœï¼‰ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ‚¬æµ®æŒ‰é’®ï¼ŒæŒ‚è½½æ”¾å¤§é•œï¼Œå†æ¬¡ç‚¹å‡»ï¼Œå¸è½½æ”¾å¤§é•œã€‚

   æŒ‚è½½æ”¾å¤§é•œæ—¶ï¼š

   - ç¦æ­¢æ»šåŠ¨ï¼šå¯è®¾ç½® `body` æ ‡ç­¾çš„ `overflow` å±æ€§ä¸º `hidden`ã€‚
   - ç¦æ­¢äº¤äº’ï¼šæ˜¾ç¤ºé€æ˜é®ç½©å±‚ã€‚
   - æˆªå–å±å¹•ï¼šé€šè¿‡ [html2canvas](https://html2canvas.hertzen.com/) æˆªå–å½“å‰å¯è§†åŒºåŸŸçš„å†…å®¹ä½œä¸ºæ”¾å¤§é•œçš„æºæ•°æ®ã€‚
   - åˆ›å»ºå…ƒç´ ï¼šåŸºäºæµè§ˆå™¨çš„ DOM API åˆ›å»ºæ”¾å¤§é•œç›¸å…³çš„å¿…è¦å…ƒç´ ï¼ˆåæ–‡è®²è§£ï¼‰ã€‚

   å¸è½½æ”¾å¤§é•œæ—¶ï¼š

   - è®¾ç½® `body` æ ‡ç­¾çš„ `overflow` å±æ€§ä¸º `auto`ï¼Œä½¿å…¶æ”¯æŒæ»šåŠ¨ã€‚
   - ç§»é™¤é®ç½©
   - ç§»é™¤äº‹ä»¶ç›‘å¬

3. å¤„ç†æ”¾å¤§é•œçš„æ‹–æ‹½å’Œç¼©æ”¾ï¼Œå¯åŸºäº `mousedown` `mousemove` `mouseup`  äº‹ä»¶ï¼Œè®¡ç®—å°ºå¯¸å’Œåæ ‡å®ç°ã€‚

4. ...

> æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒå…·ä½“å®ç°ã€‚

# å®ç°

> æç¤ºï¼š
>
> 1. æœ¬æ–‡ä¸»è¦è®²è§£ç½‘é¡µæ”¾å¤§é•œçš„å®ç°ï¼Œé¡µé¢å†…å®¹åŠå…¨å±€æ ·å¼ä¸ä¼šåœ¨æœ¬æ–‡ä¸­è®²è§£ï¼Œå„ä½çœ‹å®˜å¯æ ¹æ®å®é™…éœ€æ±‚å¸ƒå±€ä½ çš„é¡µé¢ã€‚
> 2. ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæœ¬æ–‡ä¸»è¦ä½¿ç”¨åŸç”Ÿ `HTML` `CSS` `JavaScript` å®ç°ã€‚

## å‡†å¤‡å·¥ä½œ

é¦–å…ˆè¯·æŒ‰å¦‚ä¸‹ç›®å½•è§£æ„åˆ›å»ºé¡¹ç›®ï¼š

```ini
.
â”œâ”€â”€ libs 
â”‚   â”œâ”€â”€ magnifier.css # æ”¾å¤§é•œç›¸å…³æ ·å¼     
â”‚   â””â”€â”€ magnifier.js  # æ”¾å¤§é•œæ ¸å¿ƒé€»è¾‘      
â”œâ”€â”€ index.css  # å…¨å±€æ ·å¼
â”œâ”€â”€ index.html # å¸ƒå±€
â””â”€â”€ index.js   # è„šæœ¬
```

## å¸ƒå±€å…ƒç´ 

<img src="./IMGS/magnifier_layout.jpg" style="zoom:50%;" />

é¦–å…ˆåˆ†æå®ç°æ”¾å¤§é•œåŠŸèƒ½æ‰€éœ€çš„å¿…è¦å…ƒç´ ï¼š

- è§¦å‘æŒ‰é’®ï¼ˆtriggerButtonï¼‰ï¼šæ‚¬æµ®ï¼ˆå›ºå®šå®šä½ï¼‰åœ¨å±å¹•å³ä¾§ï¼Œæ§åˆ¶æ”¾å¤§é•œçš„æŒ‚è½½å’Œå¸è½½ã€‚
- æ”¾å¤§é•œå®¹å™¨Â·å¤–å±‚ï¼ˆcontainerï¼‰ï¼šé®ç½©ï¼Œæ‚¬æµ®é“ºæ»¡å±å¹•å¯è§†åŒºåŸŸï¼Œç»“åˆé¡µé¢ `overflow` å±æ€§å¯ç¦æ­¢ç”¨æˆ·äº¤äº’ã€‚
- å±å¹•æˆªå›¾ï¼ˆscreenshotsï¼‰ï¼šæºæ•°æ®ï¼Œä½¿ç”¨ canvas å­˜å‚¨ï¼Œä¾¿äºè£å‰ªï¼Œæ‚¬æµ®é“ºæ»¡å±å¹•å¯è§†åŒºåŸŸï¼Œè®¾ç½® `opacity` ä¸º `0`ã€‚
- æ”¾å¤§é•œå®¹å™¨Â·å†…å±‚ / è§¦å‘ç¼©æ”¾åŒºåŸŸï¼ˆmagnifierï¼‰ï¼šæ§åˆ¶æ”¾å¤§é•œå®¹å™¨å¤§å°å’Œä½ç½®ï¼ŒåŒæ—¶ç”¨æˆ·é¼ æ ‡åœ¨æ­¤åŒºåŸŸæŒ‰ä¸‹ï¼Œæ¿€æ´»ç¼©æ”¾çŠ¶æ€ã€‚
- è§¦å‘æ‹–æ‹½åŒºåŸŸï¼ˆdragBoxï¼‰ï¼šå½“ç”¨æˆ·é¼ æ ‡åœ¨æ­¤åŒºåŸŸæŒ‰ä¸‹ï¼Œæ¿€æ´»æ‹–æ‹½çŠ¶æ€ã€‚
- æ”¾å¤§é•œå†…å®¹ï¼ˆscaleImgï¼‰ï¼šæ”¾å¤§é•œå‘ˆç°å†…å®¹
- æˆªå›¾è£å‰ªåŒºåŸŸï¼ˆcropBoxï¼‰ï¼šæ”¾å¤§é•œçš„å†…å®¹ä¸»è¦æ ¹æ®æ­¤åŒºåŸŸçš„å†…å®¹å‘ˆç°

> æç¤ºï¼š
>
> 1. å¯èƒ½å¤§å®¶ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸æŠŠæ”¾å¤§é•œçš„å†…å®¹ä½œä¸º `magnifier` çš„èƒŒæ™¯å›¾å‘ˆç°ï¼Œè€Œæ˜¯å•ç‹¬ä½¿ç”¨ `scaleImg` æ¥æ˜¾ç¤ºå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨èƒŒæ™¯å›¾å‘ˆç°åœ¨æ›´æ–°æ”¾å¤§é•œå†…å®¹æ—¶ä¼šæ¯”è¾ƒå¡ï¼Œå…¶æ¬¡ä½œä¸ºèƒŒæ™¯å›¾ä¼šä½¿å¾—å†…å®¹å˜å¾—æ¨¡ç³Šï¼Œå½“ç„¶å¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ã€‚
> 2. å…³äº `cropBox`ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ç”¨äºæ”¶é›†å±å¹•å†…å®¹ä½œä¸ºæ”¾å¤§é•œå‘ˆç°å†…å®¹ã€‚
> 3. ä¸Šè¿°å¿…è¦å…ƒç´ ä¸­ï¼Œé™¤äº† è§¦å‘æŒ‰é’® ä¹‹å¤–çš„å…¶ä»–å…ƒç´ ï¼Œéƒ½æ˜¯åœ¨æŒ‚è½½æ”¾å¤§é•œæ—¶åŸºäº **DOM API** åŠ¨æ€åˆ›å»ºçš„ã€‚

è¿™äº›å…ƒç´ çš„å±‚çº§å…³ç³»å¦‚ä¸‹ï¼š

```html
div.triggerButton
div.container
	- canvas.screenshots
  - div.magnifier
			- div.dragBox
			- img.scaleImg
  - div.cropBox
```

ç›¸å…³åˆå§‹ä»£ç å¦‚ä¸‹ï¼š

> `magnifier.js`

```js
class Magnifier {
  // -- æ„é€ å‡½æ•°
  constructor() {}
  // -- æŒ‚è½½
  mount = () => {};
  // -- é”€æ¯
  destory = () => {};
}
```

> `magnifier.css`

```css
/* å¤–å±‚å®¹å™¨Â·é®ç½©å±‚ */
.magnifier {
  width: 100%;
  height: 100%;

  position: fixed;
  top: 0;
  left: 0;

  z-index: 10000;
}

/* å±å¹•æˆªå›¾ */
.magnifier__screenshots {
  width: 100%;
  height: 100%;

  position: absolute;
  top: 0;
  left: 0;

  /* ä½œä¸ºæ”¾å¤§é•œæºæ•°æ®ï¼Œæ— éœ€å‘ˆç°ç»™ç”¨æˆ· */
  opacity: 0;
  z-index: -1;
}

/* è£å‰ªåŒºåŸŸ */
.magnifier__cropBox {
  width: 100px;
  height: 100px;
  box-sizing: border-box;
  border: 1px dashed red;
  /** ç”±äºè£å‰ªåŒºåŸŸåœ¨æ‹–æ‹½åŒºåŸŸä¹‹ä¸Šï¼Œä¸ºäº†ä¸å½±å“æ‹–æ‹½äº‹ä»¶ï¼Œéœ€è®¾ç½®æ­¤å±æ€§ç”¨äºäº‹ä»¶ç©¿é€ */
  pointer-events: none;

  position: absolute;
  top: 0;
  left: 0;
}

/* æ”¾å¤§é•œ & ç¼©æ”¾åŒºåŸŸ */
.magnifier__magnifier {
  box-sizing: border-box;
  border: 2px dashed #7b68ee;
  /* æ‹–æ‹½åŒºåŸŸåœ¨æ­¤å…ƒç´ å†…éƒ¨ï¼Œè¿™é‡Œæ˜¯è®©æ‹–æ‹½å…ƒç´ åœ¨å†…éƒ¨å±…ä¸­ */
  display: flex;
  justify-content: center;
  align-items: center;

  cursor: crosshair;

  position: absolute;
  top: 0;
  left: 0;
}

/* æ‹–æ‹½å…ƒç´  */
.magnifier__dragBox {
  box-sizing: border-box;
  border: 1px dashed green;
  cursor: move;
}

/* æ”¾å¤§é•œå‘ˆç°å†…å®¹ */
.magnifier__scaleImg {
  pointer-events: none;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
}
```

> `index.html`

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç½‘é¡µæ”¾å¤§é•œ</title>
    <link rel="stylesheet" href="./libs/magnifier.css" />
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <!-- é¡µé¢å†…å®¹ï¼ˆæ ¹æ®éœ€è¦è‡ªè¡Œè®¾ç½®ï¼‰ -->
    <script src="./libs/magnifier.js"></script>
    <script src="./index.js"></script>
  </body>
</html>
```

> æç¤ºï¼šæ²¡ä½“ç°çš„ä»£ç å¯ä»¥å…ˆä¸ç®¡ï¼Œåç»­ä¼šæ…¢æ…¢å®Œå–„ã€‚



## è§¦å‘æŒ‰é’®

> `index.html`

é¦–å…ˆåœ¨é¡µé¢ä¸­æ·»åŠ æ‚¬æµ®æŒ‰é’®æ ‡ç­¾ï¼š

```html
<!-- æ”¾å¤§é•œ -->
<div class="triggerButton">æ”¾å¤§é•œ</div>
```

> `index.css`

æ¥ç€åœ¨å…¨å±€æ ·å¼æ–‡ä»¶ä¸­è®¾ç½®æŒ‰é’®æ ·å¼ï¼š

```css
.triggerButton {
  cursor: pointer;
  background: #4169E1;
  color: #fff;
  padding: 8px 12px;
  position: fixed;
  right: 24px;
  top: 50%;
  z-index: 1;
}
```

> `index.js`

æœ€ååœ¨è„šæœ¬æ–‡ä»¶ä¸­è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºæ§åˆ¶æ”¾å¤§é•œçš„æŒ‚è½½å’Œå¸è½½ï¼š

```js
// -- è§¦å‘æŒ‰é’®
const triggerButton = document.querySelector(".triggerButton");
// -- åˆ›å»ºæ”¾å¤§é•œå®ä¾‹
const magnifier = new Magnifier();
// -- æ ‡è¯†æ”¾å¤§é•œæ¿€æ´»çŠ¶æ€
let isActive = false;
triggerButton.onclick = function () {
  // åˆ‡æ¢çŠ¶æ€
  isActive = !isActive;
  if (isActive) {
    // æŒ‚è½½æ”¾å¤§é•œ
    magnifier.mount();
  } else {
    // ç§»é™¤æ”¾å¤§é•œ
    magnifier.destroy();
  }
};
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹å°†æ”¾åœ¨ `Magnifier` ç±»çš„å®ç°ä¸Šã€‚

## æŒ‚è½½ / å¸è½½

é¦–å…ˆåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œå®šä¹‰å®ç°æ”¾å¤§é•œæ‰€éœ€çš„å±æ€§ï¼š

```js
constructor() {
  // -- ç±»åå‰ç¼€
  this.prefixCls = "magnifier";
  // -- æ”¾å¤§é•œåˆå§‹å°ºå¯¸
  this.initialSize = { width: 200, height: 200 };
  // -- æ”¾å¤§é•œæœ€å°å°ºå¯¸
  this.minSize = { width: 100, height: 100 };
  // -- æ”¾å¤§é•œæœ€å¤§å°ºå¯¸
  this.maxSize = { width: 500, height: 500 };
  // -- å››å‘¨è§¦å‘æ‹–æ‹½ç¼©æ”¾çš„é—´è·
  this.resizeSpacing = 20;
  // -- ç¼©æ”¾æ¯”ä¾‹
  this.scaleRatio = 2;

  // -- æ ‡è¯†å½“å‰æ˜¯å¦æ¿€æ´»ç¼©æ”¾çŠ¶æ€
  this.isResizing = false;
  // -- æ ‡è¯†æ˜¯å¦ä»æ”¾å¤§é•œå·¦ä¾§/ä¸Šæ”¾æ¿€æ´»ç¼©æ”¾çŠ¶æ€
  this.isResizeTopLeft = false;
  // -- æ ‡è¯†å½“å‰æ˜¯å¦æ¿€æ´»æ‹–æ‹½çŠ¶æ€
  this.isDragging = false;
  // -- è®°å½•æ‹–æ‹½æ—¶çš„åæ ‡
  this.originalPoint = { x: 0, y: 0 };
  // -- è®°å½•æ‹–æ‹½çš„å°ºå¯¸
  this.originalSize = { width: 0, height: 0 };
  // -- æ ‡è¯†åŸå§‹åç§»ä½ç½®
  this.originalOffset = { x: 0, y: 0 };

  // -- å®¹å™¨å…ƒç´ 
  this.container = null;
  // -- å±å¹•æˆªå›¾
  this.screenshots = null;
  // -- æ”¾å¤§é•œ
  this.magnifier = null;
  // -- æ‹–æ‹½åŒºåŸŸ
  this.dragBox = null;
  // -- æ”¾å¤§é•œå‘ˆç°å†…å®¹
  this.scaleImg = null;
  // -- æˆªå›¾è£å‰ªåŒºåŸŸ
  this.cropBox = null;
}
```

æŒ‚è½½å‡½æ•°ï¼š

```js
mount = () => {
  // -- ç§»é™¤å®¹å™¨ï¼ˆé¿å…é‡å¤è°ƒç”¨æŒ‚è½½å‡½æ•°ï¼‰
  this.container && this.destroy();
  // -- ç¦æ­¢é¡µé¢æ»šåŠ¨
  document.body.style.overflow = "hidden";
  // -- åˆ›å»ºå¿…è¦å…ƒç´ 
  this._createElement();
  // -- è®¡ç®—æ”¾å¤§é•œåˆå§‹ä½ç½®ï¼ˆå±å¹•æ­£ä¸­é—´ï¼‰
  this._calcMagnifierPosition();
  // -- è®¡ç®—è£å‰ªåŒºåŸŸåˆå§‹ä½ç½®ï¼ˆå±å¹•æ­£ä¸­é—´ï¼‰
  this._calcCropBoxPosition();
  // -- è·å–å±å¹•æˆªå›¾
  this._getScreenshots();
  // -- ç»‘å®šäº‹ä»¶ï¼ˆè§¦å‘å¼€å§‹æ‹–æ‹½/ç¼©æ”¾ï¼‰
  // ...
};
```

> æç¤ºï¼šç»‘å®šäº‹ä»¶éƒ¨åˆ†çš„ä»£ç åç»­å†å¡«å……ã€‚

è§£æ `_createElement()`ï¼š

```js
_createElement = () => {
  // 1. åˆ›å»ºå¤–å±‚å®¹å™¨ï¼ˆé®ç½©å±‚ï¼‰
  const container = document.createElement("div");
  container.setAttribute("data-html2canvas-ignore", "true");
  container.classList.add(this.prefixCls);
  this.container = container;
  // 2. åˆ›å»ºè£å‰ªå…ƒç´ 
  const cropBox = document.createElement("div");
  cropBox.style.width = this.initialSize.width / this.scaleRatio + "px";
  cropBox.style.height = this.initialSize.height / this.scaleRatio + "px";
  cropBox.classList.add(this.prefixCls + "__cropBox");
  this.cropBox = cropBox;
  // 3. åˆ›å»ºæ”¾å¤§é•œå…ƒç´  & ç¼©æ”¾åŒºåŸŸå…ƒç´ 
  const magnifier = document.createElement("div");
  magnifier.style.width = this.initialSize.width + "px";
  magnifier.style.height = this.initialSize.height + "px";
  magnifier.classList.add(this.prefixCls + "__magnifier");
  this.magnifier = magnifier;
  // 4. åˆ›å»ºæ‹–æ‹½åŒºåŸŸå…ƒç´ 
  const dragBox = document.createElement("div");
  dragBox.classList.add(this.prefixCls + "__dragBox");
  dragBox.style.width = "calc(100% - " + this.resizeSpacing * 2 + "px)";
  dragBox.style.height = "calc(100% - " + this.resizeSpacing * 2 + "px)";
  this.dragBox = dragBox;
  // 5. åˆ›å»ºæ”¾å¤§å›¾ç‰‡
  const scaleImg = document.createElement("img");
  scaleImg.classList.add(this.prefixCls + "__scaleImg");
  this.scaleImg = scaleImg;
  // 6. æŒ‚è½½å…ƒç´ 
  magnifier.appendChild(scaleImg);
  magnifier.appendChild(dragBox);
  container.appendChild(magnifier);
  container.appendChild(cropBox);
  document.body.appendChild(container);
};
```

> æç¤ºï¼š
>
> 1. `container` å®¹å™¨æ–°å¢ `data-html2canvas-ignore` å±æ€§æ˜¯ä¸ºäº†é˜²æ­¢ `html2canvas` æˆªå–å±å¹•æ—¶æŠŠæ”¾å¤§é•œçš„å†…å®¹ç»™æˆªå–è¿›å»äº†ã€‚
> 2. `cropBox` è£å‰ªåŒºåŸŸå…ƒç´ çš„å°ºå¯¸æ ¹æ®è®¾ç½®çš„æ”¾å¤§é•œæ¯”ä¾‹ç¼©å°ã€‚
> 3. `dragBox` æ‹–æ‹½åŒºåŸŸå…ƒç´ çš„å°ºå¯¸æ ¹æ® `magnifier` å’Œ è®¾ç½®çš„ `resizeSpacing` å±æ€§åŠ¨æ€è®¡ç®—ã€‚

è§£æ `_calcMagnifierPosition`ï¼šè®¡ç®—æ”¾å¤§é•œåˆå§‹ä½ç½®ï¼ˆå±å¹•æ­£ä¸­é—´ï¼‰

```js
_calcMagnifierPosition = () => {
  if (!this.magnifier) return;
  const rect = this.magnifier.getBoundingClientRect();
  const x = (window.innerWidth - rect.width) / 2;
  const y = (window.innerHeight - rect.height) / 2;
  this.magnifier.style.left = x + "px";
  this.magnifier.style.top = y + "px";
};
```

è§£æ `_calcCropBoxPosition()`ï¼šè®¡ç®—è£å‰ªåŒºåŸŸåˆå§‹ä½ç½®ï¼ˆå±å¹•æ­£ä¸­é—´ï¼‰

```js
_calcCropBoxPosition = () => {
  if (!this.cropBox) return;
  const rect = this.cropBox.getBoundingClientRect();
  const x = (window.innerWidth - rect.width) / 2;
  const y = (window.innerHeight - rect.height) / 2;
  this.cropBox.style.left = x + "px";
  this.cropBox.style.top = y + "px";
};
```

è§£æ `_getScreenshots()`ï¼šè·å–å±å¹•æˆªå›¾

```js
_getScreenshots = () => {
  // -- åŸºäº html2canvas æˆªå–å±å¹•
  html2canvas(document.body, {
    // æ˜¯å¦å…è®¸è·¨æºå›¾åƒæ±¡æŸ“ç”»å¸ƒ
    allowTaint: true,
    // èƒŒæ™¯é¢œè‰²
    backgroundColor: "#FFF",
    // åŠ è½½å›¾ç‰‡çš„è¶…æ—¶æ—¶é—´
    imageTimeout: 60 * 1000,
    // æ¸²æŸ“æ¯”ä¾‹ï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è®¾å¤‡åƒç´ æ¯”
    scale: this.scaleRatio,
    // æ˜¯å¦å°è¯•ä½¿ç”¨ CORS ä»æœåŠ¡å™¨åŠ è½½å›¾åƒ
    useCORS: true,
    // è£å‰ªç”»å¸ƒ x åæ ‡
    x: document.documentElement.scrollLeft,
    // è£å‰ªç”»å¸ƒ y åæ ‡
    y: document.documentElement.scrollTop,
    // canvas çš„å®½åº¦
    width: window.innerWidth,
    // canvas çš„é«˜åº¦
    height: window.innerHeight,
  }).then((canvas) => {
    canvas.classList.add(this.prefixCls + "__screenshots");
    this.screenshots = canvas;
    this.container?.appendChild(this.screenshots);
  });
};
```

å¸è½½å‡½æ•°

```js
destroy = () => {
  // -- æ¢å¤è§†çª—
  document.body.style.overflow = "auto";
  // -- ç§»é™¤äº‹ä»¶
  // ...
  
  // -- ç§»é™¤å®¹å™¨
  this.container?.remove();

  // -- æ¢å¤åˆå§‹å€¼
  // -- ç¼©æ”¾ç›¸å…³
  this.isResizing = false;
  this.isResizeTopLeft = false;
  this.originalPoint = { x: 0, y: 0 };
  this.originalSize = { width: 0, height: 0 };

  // -- æ‹–æ‹½ç›¸å…³
  this.isDragging = false;
  this.originalOffset = { x: 0, y: 0 };

  // -- ç½®ç©ºå…ƒç´ 
  this.container = null;
  this.magnifier = null;
  this.dragBox = null;
  this.cropBox = null;
  this.scaleImg = null;
  this.screenshots = null;
};
```

> æç¤ºï¼šç§»é™¤äº‹ä»¶éƒ¨åˆ†çš„ä»£ç åç»­å†å¡«å……ã€‚

## æ‹–æ‹½ç§»åŠ¨æ”¾å¤§é•œ

æ‹–æ‹½ç§»åŠ¨æ”¾å¤§é•œä¸»è¦é€šè¿‡ç›‘å¬ `mousedown` `mousemove` `mouseup` `mouseleave` äº‹ä»¶å®ç°ï¼Œå¯æ‹–æ‹½åŒºåŸŸä¸ºå½“å‰æµè§ˆå™¨çš„å¯è§†åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯é®ç½©å±‚åŒºåŸŸã€‚

> æç¤ºï¼šä»£ç ä¸­å†™æœ‰è¯¦ç»†æ³¨é‡Šï¼Œè¿™é‡Œä¸å†å™è¿°å®ç°ç»†èŠ‚ã€‚

ğŸ·ï¸ å¼€å§‹æ‹–æ‹½

1. æ¿€æ´»æ‹–æ‹½çŠ¶æ€  `isDragging`
2. ç›‘å¬ `mousemove` äº‹ä»¶ï¼Œè§¦å‘ã€æ‹–æ‹½ä¸­ã€‘äº‹ä»¶å‡½æ•°
3. ç›‘å¬ `mouseup` `mouseleave` äº‹ä»¶ï¼Œã€æ‹–æ‹½ç»“æŸã€‘äº‹ä»¶å‡½æ•°

```js
_onDragStart = (event) => {
  // -- é˜»æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation();
  // -- å¼‚å¸¸å¤„ç†
  if (!this.container) return;
  // -- æ¿€æ´»æ‹–æ‹½çŠ¶æ€
  this.isDragging = true;
  // -- ç›‘å¬é¼ æ ‡äº‹ä»¶
  this.container.addEventListener("mousemove", this._onDragging);
  this.container.addEventListener("mouseup", this._onDragEnd);
  this.container.addEventListener("mouseleave", this._onDragEnd);
};
```

ğŸ·ï¸ æ‹–æ‹½ä¸­

1. æ›´æ–°æ”¾å¤§é•œçš„ä½ç½®
2. æ›´æ–°è£å‰ªåŒºåŸŸçš„ä½ç½®

```js
_onDragging = (event) => {
  // -- é˜»æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation();
  // -- å¼‚å¸¸å¤„ç†
  if (!this.magnifier || !this.cropBox || !this.screenshots || !this.scaleImg)
    return;
  // -- å¦‚æœæ²¡æœ‰æ¿€æ´»æ‹–æ‹½çŠ¶æ€ï¼Œä¸åšä»»ä½•å¤„ç†
  if (!this.isDragging) return;
  // -- (æ”¾å¤§é•œï¼‰è·å–å½“å‰ç§»åŠ¨ä½ç½®
  const { width: magnifierW, height: magnifierH } =
    this.magnifier.getBoundingClientRect();
  let magnifierOffsetX = event.clientX - magnifierW / 2;
  let magnifierOffsetY = event.clientY - magnifierH / 2;
  // -- (æ”¾å¤§é•œï¼‰è·å–å¯ç§»åŠ¨çš„æœ€å¤§ä½ç½®
  const magnifierMaxOffsetX = window.innerWidth - magnifierW;
  const magnifierMaxOffsetY = window.innerHeight - magnifierH;
  // -- (æ”¾å¤§é•œï¼‰å¤„ç†è¾¹ç•Œï¼ˆæ°´å¹³/å‚ç›´ï¼‰
  if (magnifierOffsetX < 0) {
    magnifierOffsetX = 0;
  } else if (magnifierOffsetX > magnifierMaxOffsetX) {
    magnifierOffsetX = magnifierMaxOffsetX;
  }
  if (magnifierOffsetY < 0) {
    magnifierOffsetY = 0;
  } else if (magnifierOffsetY > magnifierMaxOffsetY) {
    magnifierOffsetY = magnifierMaxOffsetY;
  }
  // -- (æ”¾å¤§é•œï¼‰æ›´æ–°æ”¾å¤§é•œçš„ä½ç½®
  this.magnifier.style.left = magnifierOffsetX + "px";
  this.magnifier.style.top = magnifierOffsetY + "px";

  // -- (è£å‰ªåŒºåŸŸ)è·å–å½“å‰ç§»åŠ¨ä½ç½®
  const { width: cropBoxW, height: cropBoxH } =
    this.cropBox.getBoundingClientRect();
  let cropBoxOffsetX = event.clientX - cropBoxW / 2;
  let cropBoxOffsetY = event.clientY - cropBoxH / 2;
  // -- (è£å‰ªåŒºåŸŸ)è·å–å¯ç§»åŠ¨çš„æœ€å¤§ä½ç½®
  const cropBoxMaxOffsetX = window.innerWidth - cropBoxW;
  const cropBoxMaxOffsetY = window.innerHeight - cropBoxH;
  // -- (è£å‰ªåŒºåŸŸ)å¤„ç†è¾¹ç•Œï¼ˆæ°´å¹³/å‚ç›´ï¼‰
  if (cropBoxOffsetX < 0) {
    cropBoxOffsetX = 0;
  } else if (cropBoxOffsetX > cropBoxMaxOffsetX) {
    cropBoxOffsetX = cropBoxMaxOffsetX;
  }
  if (cropBoxOffsetY < 0) {
    cropBoxOffsetY = 0;
  } else if (cropBoxOffsetY > cropBoxMaxOffsetY) {
    cropBoxOffsetY = cropBoxMaxOffsetY;
  }
  // -- (è£å‰ªåŒºåŸŸ)
  this.cropBox.style.left = cropBoxOffsetX + "px";
  this.cropBox.style.top = cropBoxOffsetY + "px";
};
```

ğŸ·ï¸ æ‹–æ‹½ç»“æŸ

1. æ›´æ–°æ‹–æ‹½çŠ¶æ€
2. ç§»é™¤ `mousemove` `mouseup` `mouseleave` äº‹ä»¶

```js
_onDragEnd = (event) => {
  event.stopPropagation();
  this.isDragging = false;
  this.container.removeEventListener("mousemove", this._onDragging);
  this.container.removeEventListener("mouseup", this._onDragEnd);
  this.container.removeEventListener("mouseleave", this._onDragEnd);
};
```

ğŸ·ï¸ åœ¨æŒ‚è½½æ—¶ï¼Œç›‘å¬ `mousedown` äº‹ä»¶ï¼Œè§¦å‘å¼€å§‹æ‹–æ‹½

```js
mount = () => {
  this.dragBox.addEventListener("mousedown", this._onDragStart);
};
```

ğŸ·ï¸ åœ¨æŒ‚è½½æ—¶ï¼Œç§»é™¤ `mousedown` äº‹ä»¶

```js
destroy = () => {
  this.dragBox.removeEventListener("mousedown", this._onDragStart);
};
```

> æç¤ºï¼šæ­¤æ—¶æ‚¨å¯ä»¥æŸ¥çœ‹é¡µé¢æ•ˆæœï¼Œå°è¯•æ‹–æ‹½æ”¾å¤§é•œï¼Œè§‚å¯Ÿæ”¾å¤§é•œå†…å±‚å®¹å™¨ã€æ‹–æ‹½åŒºåŸŸä»¥åŠè£å‰ªåŒºåŸŸçš„ä½ç½®å˜åŒ–ã€‚

## æ‹–æ‹½ç¼©æ”¾æ”¾å¤§é•œ

æ‹–æ‹½ç¼©æ”¾æ”¾å¤§é•œåŒæ ·ä¹Ÿæ˜¯é€šè¿‡ç›‘å¬ `mousedown` `mousemove` `mouseup` `mouseleave` äº‹ä»¶å®ç°ï¼Œç¼©æ”¾éœ€è®¾ç½®è¾¹ç•Œå€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰ å®šä¹‰çš„æ”¾å¤§é•œæœ€å¤§å°ºå¯¸ï¼ˆ`maxSize`ï¼‰å’Œæœ€å°å°ºå¯¸ï¼ˆ`minSize`ï¼‰ã€‚

ğŸ·ï¸ å¼€å§‹ç¼©æ”¾

1. æ¿€æ´»ç¼©æ”¾çŠ¶æ€  `isResizing`
2. è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶çš„ä½ç½®ï¼Œç”¨äºåœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­è®¡ç®—æ‹–æ‹½çš„è·ç¦»
3. è®°å½•æ”¾å¤§é•œçš„åŸå§‹å°ºå¯¸ï¼Œç”¨äºåœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­è®¡ç®—æ”¾å¤§é•œçš„ç›®æ ‡å°ºå¯¸
4. è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶æ”¾å¤§é•œè·ç¦»å±å¹•å·¦ä¸Šè§’çš„ä½ç½®ï¼Œç”¨äºåœ¨å‘ä¸Š/å‘å·¦æ‹–æ‹½æ—¶æ›´æ–°æ”¾å¤§é•œçš„ä½ç½®
5. åˆ¤æ–­æ˜¯å¦è§¦å‘å‘ä¸Š/å‘å·¦ç¼©æ”¾ï¼ˆå› ä¸ºè§†å›¾ç›¸å¯¹äºå±å¹•å·¦ä¸Šè§’å¸ƒå±€ï¼Œå‘å·¦æˆ–å‘ä¸Šç¼©æ”¾æ—¶ï¼Œé™¤äº†æ›´æ–°å°ºå¯¸å¤–ï¼Œè¿˜éœ€åŠ¨æ€è°ƒæ•´æ”¾å¤§é•œçš„ä½ç½®ï¼‰
6. ç›‘å¬ `mousemove` äº‹ä»¶ï¼Œè§¦å‘ã€ç¼©æ”¾ä¸­ã€‘äº‹ä»¶å‡½æ•°
7. ç›‘å¬ `mouseup` `mouseleave` äº‹ä»¶ï¼Œã€ç¼©æ”¾ç»“æŸã€‘äº‹ä»¶å‡½æ•°

```js
_onResizeStart = (event) => {
  if (!this.magnifier) return;
  // -- é˜»æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation();
  // -- æ¿€æ´»ç¼©æ”¾
  this.isResizing = true;
  // -- è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶çš„ä½ç½®ï¼Œç”¨äºåœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­è®¡ç®—æ‹–æ‹½çš„è·ç¦»
  this.originalPoint = { x: event.clientX, y: event.clientY };
  // -- è®°å½•æ”¾å¤§é•œçš„åŸå§‹å°ºå¯¸ï¼Œç”¨äºåœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­è®¡ç®—æ”¾å¤§é•œçš„ç›®æ ‡å°ºå¯¸
  const rect = this.magnifier.getBoundingClientRect();
  this.originalSize = { width: rect.width, height: rect.height };

  // è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶æ”¾å¤§é•œè·ç¦»å±å¹•å·¦ä¸Šè§’çš„ä½ç½®ï¼Œç”¨äºåœ¨å‘ä¸Š/å‘å·¦æ‹–æ‹½æ—¶æ›´æ–°æ”¾å¤§é•œçš„ä½ç½®
  this.originalOffset = {
    x: event.clientX - rect.left,
    y: event.clientY - rect.top,
  };

  // åˆ¤æ–­æ˜¯å¦è§¦å‘å‘ä¸Š/å‘å·¦ç¼©æ”¾ï¼ˆå› ä¸ºè§†å›¾ç›¸å¯¹äºå±å¹•å·¦ä¸Šè§’å¸ƒå±€ï¼Œå‘å·¦æˆ–å‘ä¸Šç¼©æ”¾æ—¶ï¼Œé™¤äº†æ›´æ–°å°ºå¯¸å¤–ï¼Œè¿˜éœ€åŠ¨æ€è°ƒæ•´æ”¾å¤§é•œçš„ä½ç½®ï¼‰
  if (
    this.originalOffset.x <= this.resizeSpacing ||
    this.originalOffset.y <= this.resizeSpacing
  ) {
    this.isResizeTopLeft = true;
  } else {
    this.isResizeTopLeft = false;
  }

  this.container?.addEventListener("mousemove", this._onResizing);
  this.container?.addEventListener("mouseup", this._onReszieEnd);
  this.container?.addEventListener("mouseleave", this._onReszieEnd);
}
```

ğŸ·ï¸ ç¼©æ”¾ä¸­

1. è·å–é¼ æ ‡ç›¸å¯¹äºåŸç‚¹æ‹–æ‹½çš„è·ç¦»
2. è®¡ç®—ç›®æ ‡å°ºå¯¸
3. è¾¹ç•Œå€¼å¤„ç†ï¼ˆåˆ¤æ–­å½“å‰æ”¾å¤§é•œæ˜¯å¦ç¼©æ”¾åˆ°æœ€å¤§/å°å°ºå¯¸ï¼‰
4. å¦‚æœæ˜¯ä»é¡¶éƒ¨/å·¦ä¾§ç¼©æ”¾ï¼Œåˆ™éœ€åŠ¨æ€æ›´æ–°æ”¾å¤§é•œåœ¨å±å¹•çš„ä½ç½®
5. æ›´æ–°æ”¾å¤§é•œå°ºå¯¸
6. æ›´æ–°è£å‰ªåŒºåŸŸçš„å°ºå¯¸å’Œä½ç½®

```js
_onResizing = (event) => {
  if (!this.magnifier || !this.cropBox || !this.screenshots || !this.scaleImg)
    return;
  // -- é˜»æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation();
  // -- å¦‚æœæ²¡æœ‰æ¿€æ´»ç¼©æ”¾çŠ¶æ€ï¼Œä¸åšä»»ä½•å¤„ç†
  if (!this.isResizing) return;
  // -- è·å–é¼ æ ‡ç›¸å¯¹äºåŸç‚¹æ‹–æ‹½çš„è·ç¦»
  const deltaX = event.clientX - this.originalPoint.x;
  const deltaY = event.clientY - this.originalPoint.y;
  // -- è®¡ç®—ç›®æ ‡å°ºå¯¸
  let targetWidth = 0;
  let targetHeight = 0;
  if (this.isResizeTopLeft) {
    targetWidth = this.originalSize.width - deltaX;
    targetHeight = this.originalSize.height - deltaY;
  } else {
    targetWidth = this.originalSize.width + deltaX;
    targetHeight = this.originalSize.height + deltaY;
  }
  // -- è¾¹ç•Œå€¼å¤„ç†ï¼ˆåˆ¤æ–­å½“å‰æ”¾å¤§é•œæ˜¯å¦ç¼©æ”¾åˆ°æœ€å¤§/å°å°ºå¯¸ï¼‰
  if (
    targetWidth < this.minSize.width ||
    targetHeight < this.minSize.height
  ) {
    this._onReszieEnd();
    return;
  }
  if (
    targetWidth > this.maxSize.width ||
    targetHeight > this.maxSize.height
  ) {
    this._onReszieEnd();
    return;
  }
  // -- å¦‚æœæ˜¯ä»é¡¶éƒ¨/å·¦ä¾§ç¼©æ”¾ï¼Œåˆ™éœ€åŠ¨æ€æ›´æ–°æ”¾å¤§é•œåœ¨å±å¹•çš„ä½ç½®
  if (this.isResizeTopLeft) {
    let x = event.clientX - this.originalOffset.x;
    let y = event.clientY - this.originalOffset.y;
    this.magnifier.style.left = x + "px";
    this.magnifier.style.top = y + "px";
  }
  // -- æ›´æ–°æ”¾å¤§é•œå°ºå¯¸
  this.magnifier.style.width = targetWidth + "px";
  this.magnifier.style.height = targetHeight + "px";

  // -- æ›´æ–°è£å‰ªåŒºåŸŸçš„å°ºå¯¸å’Œä½ç½®
  const cropBoxW = targetWidth / this.scaleRatio;
  const cropBoxH = targetHeight / this.scaleRatio;

  this.cropBox.style.width = cropBoxW + "px";
  this.cropBox.style.height = cropBoxH + "px";

  const { top, left, width, height } = this.magnifier.getBoundingClientRect();

  const cropBoxOffsetX = left + (width - cropBoxW) / 2;
  const cropBoxOffsetY = top + (height - cropBoxH) / 2;
  
  this.cropBox.style.left = cropBoxOffsetX + "px";
  this.cropBox.style.top = cropBoxOffsetY + "px";
}
```

ğŸ·ï¸ ç¼©æ”¾ç»“æŸ

1. æ›´æ–°ç¼©æ”¾çŠ¶æ€
2. ç§»é™¤ `mousemove` `mouseup` `mouseleave` äº‹ä»¶

```js
_onReszieEnd = () => {
  this.isResizing = false;
  this.container.removeEventListener("mousemove", this._onResizing);
  this.container.removeEventListener("mouseup", this._onReszieEnd);
  this.container.removeEventListener("mouseleave", this._onReszieEnd);
};
```

ğŸ·ï¸ åœ¨æŒ‚è½½æ—¶ï¼Œç›‘å¬ `mousedown` äº‹ä»¶ï¼Œè§¦å‘å¼€å§‹ç¼©æ”¾

```js
mount = () => {
  this.magnifier.addEventListener("mousedown", this._onResizeStart);
};
```

ğŸ·ï¸ åœ¨æŒ‚è½½æ—¶ï¼Œç§»é™¤ `mousedown` äº‹ä»¶

```js
destroy = () => {
  this.magnifier.removeEventListener("mousedown", this._onResizeStart);
};
```

> æç¤ºï¼šæ­¤æ—¶ï¼Œæ”¾å¤§é•œåŠŸèƒ½åŸºæœ¬ä¸Šå·²å®Œæˆï¼Œåªå·®æœ€åä¸€æ­¥ï¼ŒåŠå°†å†…å®¹å‘ˆç°åœ¨æ”¾å¤§é•œä¸Šã€‚

## å‘ˆç°æ”¾å¤§é•œå†…å®¹

å½“æˆ‘ä»¬åœ¨æŒ‚è½½æ”¾å¤§é•œæ—¶ï¼Œå·²ç»åŸºäº html2canvas å­˜å‚¨å±å¹•å¿«ç…§ä½œä¸ºæºæ•°æ®ï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨åˆå§‹åŒ–ã€æ‹–æ‹½ä¸­å’Œç¼©æ”¾ä¸­å®æ—¶æ›´æ–°æ”¾å¤§é•œçš„å†…å®¹å³å¯ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼Œæˆ‘ä»¬å°†å…¶æŠ½ç¦»æˆå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```js
_updateScaleImg = () => {
  // -- å¼‚å¸¸å¤„ç†
  if (!this.cropBox || !this.screenshots || !this.scaleImg) return;
  // -- è·å–è£å‰ªåŒºåŸŸçš„ç›’å­ä¿¡æ¯
  const {
    width: cropBoxW,
    height: cropBoxH,
    left: cropBoxOffsetX,
    top: cropBoxOffsetY,
  } = this.cropBox.getBoundingClientRect();
  // -- æ ¹æ®è£å‰ªåŒºåŸŸçš„ç›’å­ä¿¡æ¯ + ç¼©æ”¾æ¯”ä¾‹ è®¡ç®—è£å‰ªæ”¾å¤§é•œå‘ˆç°å†…å®¹çš„å°ºå¯¸å’Œä½ç½®ä¿¡æ¯
  const croppedW = cropBoxW * this.scaleRatio;
  const croppedH = cropBoxH * this.scaleRatio;
  const croppedOffsetX = cropBoxOffsetX * this.scaleRatio;
  const croppedOffsetY = cropBoxOffsetY * this.scaleRatio;

  // -- åˆ›å»º canvasï¼Œç”¨äºå®ç°è£å‰ªåŠŸèƒ½
  const croppedCanvas = document.createElement("canvas");
  croppedCanvas.width = croppedW;
  croppedCanvas.height = croppedH;
  const croppedCtx = croppedCanvas.getContext("2d");
  if (!croppedCtx) return;
  croppedCtx.imageSmoothingEnabled = false;
  // -- åŸºäºå±å¹•å¿«ç…§ï¼ˆæºæ•°æ®ï¼‰è£å‰ª
  croppedCtx.drawImage(
    this.screenshots,
    croppedOffsetX,
    croppedOffsetY,
    croppedW,
    croppedH,
    0,
    0,
    croppedW,
    croppedH
  );
  // -- å°†è£å‰ªåçš„å†…å®¹è½¬æ¢æˆé“¾æ¥
  const url = croppedCanvas.toDataURL("image/jpeg");
  // -- æ›´æ–°æ”¾å¤§é•œå‘ˆç°å†…å®¹
  this.scaleImg.src = url;
}
```

â‘  åœ¨è·å–å±å¹•å¿«ç…§æ—¶è°ƒç”¨

```js
_getScreenshots = () => {
  html2canvas(document.body, { ... }).then((canvas) => {
    ...
    this._updateScaleImg();
  });
};
```

â‘¡ åœ¨æ‹–æ‹½æ”¾å¤§é•œæ—¶è°ƒç”¨

```js
_onDragging = (event) => {
  ...
  this._updateScaleImg();
}
```

â‘¢ åœ¨ç¼©æ”¾æ”¾å¤§é•œæ—¶è°ƒç”¨

```js
_onReszieEnd = () => {
  ...
  this._updateScaleImg();
}
```

# å°¾è¨€

åˆ°è¿™é‡Œï¼Œå…³äº js å®ç°ç½‘é¡µæ”¾å¤§é•œçš„æ•ˆæœå°±ä»‹ç»å®Œå•¦ï¼å®Œæ•´ä»£ç è¯·ç§»æ­¥è‡³ [è¿™é‡Œ >>](https://gitee.com/lihongyao/jsDemos/tree/master/%E7%BD%91%E9%A1%B5%E6%94%BE%E5%A4%A7%E9%95%9C)

ä¸ºäº†æ–¹ä¾¿å„ä½åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œæˆ‘å°è£…äº†ç½‘é¡µæ”¾å¤§é•œçš„js åº“ï¼š[@likg/magnifier >>](https://www.npmjs.com/package/@likg/magnifier)

å½“ç„¶ï¼Œæˆ‘è®¤ä¸ºåœ¨ä»£ç å®ç°ä¸Šè¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šç¼ºé™·å’Œå€¼å¾—ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¬¢è¿å„ä½å°ä¼™ä¼´ç•™è¨€è¯„è®ºä¸€èµ·æ¢è®¨ã€‚

> æ¸©é¦¨æç¤ºï¼šåŸåˆ›ä¸æ˜“ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

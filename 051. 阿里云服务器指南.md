 

# 一、准备

## 账号注册

参考 [新手上云指南 >>](https://help.aliyun.com/product/47310.html) 完成 <u>注册账号</u> 和 <u>个人实名认证</u>。

## 购买ECS服务器

点击 [前往云服务器ECS >>](https://cn.aliyun.com/product/ecs)，点击 `立即购买`。

接下来主要给大家简单介绍购买环节中该如何选择，未提到的表示保持推荐默认即可，仅供参考：

**① 基础配置**

- 付费模式：`包年包月`；

  - 包年包月：7x24小时流量稳定时选择；
  
  - 按量付费：用多少是多少，一般用于流量在某个期间突增的情况，比如上线一个抢红包活动什么的；

- 地域及可用区：`西南1（成都）`，可用区随机分配即可。

- 实例规格：`2vCPU / 4GiB` ；

  - 一般个人用 **2核4G** 应该够了，根据需要来，然后在结果列表中选一个价格合适的即可。
  - 如果你选择的是 <u>突然性能实例</u> 规格族，则无需打开突发性能实例（单独收费）

- 镜像：`CentOS` - `7.9 64位` 

  - CentOS社区已宣布CentOS 8在2021年12月31日停止服务，一般选择 `^7.9`

- 存储：`ESSD云盘` -  `40Gib`

  - 根据需求来，如果你只是测试，或者学习用，直接拉到 `20Gib` 

- 快照服务：根据需要（单独收费）

**② 网络和安全组**

- 网络：保持默认即可；

- 公网IP：勾选分配公网 IPv4 地址

  - 带宽计费模式：`按使用流量`
  
  - 带宽峰值： `5M`（根据需要）

- 安全组：勾选 `80 443 22 ICMP` 即可；
- 其他默认即可；



**③ 系统配置（选填）**

- 登录凭据：`自定义密码`
  - 登录名：默认 root 
  - 设置登录密码（记得保存好）
- 实例相关
  - 实例名称：默认即可
  - 描述：选填
  - 主机名：在终端显示的名称，终端显示效果如：`[root@Li-HONGYAO ~]#  `

**④ 分组设置**：直接跳过

**⑤ 确认订单**

- 仔细检查一下所选配置 / 在这里你也可以修改之前配置；
- 选择购买时长（是否自动续费根据个人情况来定）；
- 勾选服务协议，确认下单即可；
- 如果你选择3个月，获取域名备案码，不然得花100元1个，其实就是捆绑销售；

## 购买域名

- 前往 [万网 >>](https://wanwang.aliyun.com/?spm=5176.19720258.J_8058803260.29.32c42c4abOLIcl) 查询 → 购买域名；

- 前往 [ICP 备案 >>](https://beian.aliyun.com/?spm=a2cmq.17629970.J_8058803260.4.f0d079fec57kO7)，点击右下角 `我要备案` 然后根据提示进行即可；
  - 管局审核时间约为10天

> 提示：备案需购买至少3个月的ECS服务器才让你备（万恶的捆绑销售呀）

# 二、ECS服务器Actions

登录阿里云账号 → 进入云服务器 ECS 控制台 → 左侧菜单栏选择实例与镜像 → 实例

## 链接服务器

在示例列表中 **操作** 列中选择 <u>远程连接</u> → 选择 <u>Workbench 远程连接</u>

通过网页可以对ECS实例进行远程控制，支持复制粘贴文本，支持多操作系统用户登录同一台实例，支持可视化查看系统文件资源。

一般我选择这个，主要是方便，进入之后输入账号密码即可。然后就可以开始玩儿服务器了。

## 安装必要工具

包管理工具：`yum`

### nginx

安装指令：

```shell
$ sudo yum -y install nginx
```

配置文件：*`/etc/nginx`*

静态文件路径：*/usr/share/nginx/html*

## 常用操作

nginx h5：/usr/share/nginx/html

| 指令          | 描述                   |
| ------------- | ---------------------- |
| `whereis xxx` | 查看某个软件的安装位置 |
| `pwd xxx`     | 查看某个文件的位置     |
| `cat xxx`     | 查看某个文件的内容     |

更多命令，[参考这里 >>](https://gitee.com/lihongyao/Blogs/blob/master/004.%20macOS%EF%BC%9A%E5%B8%B8%E7%94%A8%E7%BB%88%E7%AB%AF%E6%8C%87%E4%BB%A4.md)

# 四、部署Node环境

## 1. 安装Node

1）前往 [清华大学开源软件镜像站 >>](https://mirrors.tuna.tsinghua.edu.cn/)，搜索 `nodejs-release`，找到你要安装的版本，并根据系统 / 位数选择对应的压缩包，鼠标右键 `复制链接地址`。

2）切换到服务器，输入如下指令进行下载

```shell
$ curl -O https://mirrors.tuna.tsinghua.edu.cn/nodejs-release/v16.9.1/node-v16.9.1-linux-x64.tar.gz
```

3）解压下载文件

```shell
$ tar xvzf node-v16.9.1-linux-x64.tar.gz  
```

4）安装二进制文件

```shell
$ cp -af node-v16.9.1-linux-x64 /usr/local/node && ln -s /usr/local/node/bin/* /usr/bin
$ cd node-v16.9.1-linux-x64
$ cp -af bin/* /usr/bin/
$ cp -af lib/* /usr/lib/
```

5）验证

```shell
[root@lee node-v16.9.1-linux-x64]# which node
/usr/bin/node
[root@lee node-v16.9.1-linux-x64]# node -v
v16.9.1
```

6）删除不必要的文件

## 2. 安装项目

1）将 `node` 项目压缩之后传到服务器指定目录，比如我这里的项目名称是：`app-service.zip`

2）解压项目

```shell
$ tar xvzf app-service.zip
```

3）进入项目 / 安装依赖

```shell
$ cd app-service
$ npm install
```

4）执行项目

```shell
$ npm run dev
```

> 注意：

当你在执行项目时可能会出现 “/usr/codes/api-service/app-service/node_modules/.bin/egg-bin: Permission denied” 提示，此时需要给它一个权限：

```shell
$ chmod -x /usr/codes/api-service/app-service/node_modules/.bin/egg-bin
```

然后重新执行即可。

## 3. 配置nginx代理

1）编辑nginx配置文件

```shell
$ vi /etc/nginx/nginx.conf
```

2）在 `server` 中添加代理

```
location / {
	proxy_pass http://127.0.0.1:7001;
}
```

3）按 `ESC` 输入 `：wq` 保存退出，最后重启nginx即可通过官网ip访问接口了：

```shell
$ nginx -s reload
```

## 4. 安装pm2管理node项目

[pm2 >>](https://pm2.keymetrics.io/) 是一个带有负载均衡的Node应用的进程管理器, 它能够管理Node应用，还能够对应用的运行状态进行监控。

1）全局安裝 `PM2`

```shell
$ npm install -g pm2
```

2） 启动项目

```shell
$ pm2 start app.js
```


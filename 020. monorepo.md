# ä¸€ã€æ¦‚è¿°

MonoRepo æ˜¯ä¸€ç§å°†**å¤šä¸ªé¡¹ç›®**ä»£ç å­˜å‚¨åœ¨**ä¸€ä¸ªä»“åº“** é‡Œçš„è½¯ä»¶å¼€å‘ç­–ç•¥ï¼ˆ*ç®€å•ç†è§£å°±æ˜¯ï¼šåœ¨ä¸€ä¸ªä»£ç ä»“åº“ä¸­ï¼Œç®¡ç†å¤šä¸ªä¸åŒçš„é¡¹ç›®*ï¼‰ï¼Œä¸ä¹‹ç›¸å¯¹çš„æ˜¯å¦ä¸€ç§æµè¡Œçš„ä»£ç ç®¡ç†æ–¹å¼ MultiRepoï¼Œå³æ¯ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„ä»“åº“æ¥åˆ†æ•£ç®¡ç†ã€‚

![](./IMGS/law7gi1g089y.png)

- Multi-repoï¼šæ¯ä¸ªåº“æœ‰è‡ªå·±ç‹¬ç«‹çš„ä»“åº“ï¼Œé€»è¾‘æ¸…æ™°ï¼Œç›¸å¯¹åº”çš„ï¼ŒååŒç®¡ç†ä¼šæ›´ç¹çã€‚
- Mono-repoï¼šå¯ä»¥å¾ˆæ–¹ä¾¿çš„ååŒç®¡ç†ä¸åŒç‹¬ç«‹çš„åº“çš„ç”Ÿå‘½å‘¨æœŸï¼Œç›¸å¯¹åº”çš„ï¼Œä¼šæœ‰æ›´é«˜çš„æ“ä½œå¤æ‚åº¦ã€‚

> æ¨èé˜…è¯»ï¼š[ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?](https://juejin.cn/post/6944877410827370504)

ä¸€ä¸ªç®€å•çš„monorepoçš„ç›®å½•ç»“æ„ç±»ä¼¼è¿™æ ·ï¼š

```
/projects
.
â”œâ”€â”€ node_modules
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ pkg1
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ pkg2
â”‚   â”‚   â””â”€â”€ package.json
â”œâ”€â”€ package.json
â””â”€â”€ pnpm-workspace.yaml
```

## 1. ä½¿ç”¨monorepoçš„ä¼˜åŠ£

monorepo ä¼˜åŠ¿ï¼š

1. ä¾¿äºç®¡ç†å¤šä¸ªäº’ç›¸ä¾èµ–çš„é¡¹ç›®
2. ä¾¿äºå›¢é˜Ÿå…±äº«çŸ¥è¯†åº“
3. å‡å°‘é¡¹ç›®ç®¡ç†çš„æˆæœ¬

monorepo åŠ£åŠ¿ï¼š

1. ç‰ˆæœ¬ç®¡ç†æ··ä¹±
2. ä»£ç è´¨é‡å‚å·®ä¸é½ï¼Œä¸”äº’ç›¸å½±å“
3. æŠ€æœ¯æ ˆå‡çº§å›°éš¾
4. éš¾ä»¥è¿›è¡Œæƒé™ç®¡ç†

> æ¨èé˜…è¯»ï¼š[æµ…å° Monorepo](https://blog.meathill.com/tech/some-basic-experience-about-monorepo.html)

## 2. ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ monorepoï¼Ÿ

1. å¤šä¸ªé¡¹ç›®äº’ç›¸ä¾èµ–
2. åŠŸèƒ½ã€ç‰ˆæœ¬ä¹‹é—´å­˜åœ¨å¼ºå…³è”
3. é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªå˜å¼‚å…¥å£ï¼Œä¸”æ„å»ºæ¡ä»¶å­˜åœ¨å·®å¼‚

**æ¬¡è¦æ¡ä»¶**ï¼š

1. å¸Œæœ›åœ¨å›¢é˜Ÿä¸­å…±äº«çŸ¥è¯†
2. é™ä½é¡¹ç›®ç®¡ç†çš„æˆæœ¬

## 3. pnpm æœ€ä½³é€‰æ‹©

monorepo æŠ€æœ¯é€‰å‹ï¼š[pnpm >>](https://pnpm.io/workspaces)

æ¨èä½¿ç”¨ pnpm ç®¡ç† Monorepoï¼Œå› ä¸ºï¼š

1. é€Ÿåº¦å¿«
2. ç£ç›˜å ç”¨å°‘
3. é¡¹ç›®ä¾èµ–å½¼æ­¤ç‹¬ç«‹ã€éš”ç¦»
4. æœ‰å„ç§å‘½ä»¤æ–¹ä¾¿æ“ä½œ

# äºŒã€å®æˆ˜

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥æ‰‹æŠŠæ‰‹å¸¦ä½ äº†è§£å¦‚ä½•åŸºäºrollup+mono-repoæ­å»ºä¸€ä¸ªè‡ªå·±çš„å·¥å…·åº“é›†ã€‚

## 1. å®šä¹‰ç›®å½•ç»“æ„

â‘  æ–°å»ºä»“åº“å¹¶åˆå§‹åŒ– *package.json*

```shell
$ mkdir lg-libs && cd lg-libs && pnpm init && code .
```

> æç¤º
>
> 1. `lg-libs` ä¸ºä½ çš„monorepoä»“åº“ï¼Œå¯è‡ªè¡Œå‘½åã€‚
> 2. å¦‚æœä½ æ²¡æœ‰å®‰è£… `pnpm`ï¼Œå¯é€šè¿‡ npm å®‰è£…ï¼ŒæŒ‡ä»¤ä¸ºï¼š`npm i -g pnpm`

â‘¡ æŒ‡å®šé¡¹ç›®è¿è¡Œçš„ node/pnpm ç‰ˆæœ¬

ä¸ºäº†å‡å°‘å› nodeæˆ–è€…pnpmç‰ˆæœ¬å·®å¼‚è€Œäº§ç”Ÿå¼€å‘ç¯å¢ƒé”™è¯¯ï¼Œæˆ‘ä»¬åœ¨ package.json æ–‡ä»¶ä¸­å¢åŠ  `engines` å­—æ®µæ¥é™åˆ¶ç‰ˆæœ¬ï¼š

```json
{
	"engines": {
		"node": ">=16",
		"pnpm": ">=7"
	}
}
```

â‘£ å®‰å…¨æ€§è®¾ç½®

ä¸ºäº†é˜²æ­¢æˆ‘ä»¬çš„æ ¹ç›®å½•è¢«å½“ä½œåŒ…å‘å¸ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨ package.json åŠ å…¥å¦‚ä¸‹è®¾ç½®ï¼š

```json
{
	"private": true
}
```

â‘¤ åˆå§‹åŒ– `pnpm-workspace.yaml`ï¼šå‚è€ƒ [è¿™é‡Œ>>](https://pnpm.io/zh/pnpm-workspace_yaml)

```yaml
packages:
  # all packages in direct subdirs of packages/
  - 'packages/*'
```

> æç¤ºï¼š
>
> 1. æ ¹ç›®å½•æ–°å»º `pnpm-workspace.yaml` æ–‡ä»¶ï¼Œå¡«å……ä¸Šé¢çš„å†…å®¹ã€‚
> 2. æ ¹ç›®å½•æ–°å»º `packages` ç›®å½•ï¼Œ`packages` ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªä¸€çº§ç›®å½•ä¸ºä½ çš„ä¸€ä¸ªjsåº“ã€‚

[å·¥ä½œç©ºé—´](https://pnpm.io/zh/workspaces)

## 2. å®šä¹‰å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒæ£€æŸ¥ä¸ä¿®å¤

ä»£ç è§„èŒƒï¼šlintå·¥å…·ï¼ˆ**eslint**ï¼‰

â‘  å®‰è£…ï¼š`pnpm i -D -w eslint`

â‘¡ åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼š`npx eslint --init`

```shell
$ npx eslint --init
âœ” How would you like to use ESLint? Â· [problems]
âœ” What type of modules does your project use? Â· [esm]
âœ” Which framework does your project use? Â· [none]
âœ” Does your project use TypeScript? Â· No / [Yes]
âœ” Where does your code run? Â· [browser]
âœ” What format do you want your config file to be in? Â· [JSON]
The config that you've selected requires the following dependencies:

@typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest
âœ” Would you like to install them now? Â· No / [Yes]
âœ” Which package manager do you want to use? Â· [pnpm]
Installing @typescript-eslint/eslint-plugin@latest, @typescript-eslint/parser@latest
â€‰ERR_PNPM_ADDING_TO_ROOTâ€‰ Running this command will add the dependency to the workspace root, which might not be what you want - if you really meant it, make it explicit by running this command again with the -w flag (or --workspace-root). If you don't want to see this warning anymore, you may set the ignore-workspace-root-check setting to true.
```

å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ monorepoï¼Œæ‰€ä»¥è‡ªåŠ¨å®‰è£…tsç›¸å…³æ’ä»¶æ—¶æˆ‘ä»¬éœ€è¦è¾“å…¥ `-w`ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š

```shell
$ pnpm i -D -w @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest
```

â‘¢ ä¿®æ”¹ `.eslintrc.json` é…ç½®å¦‚ä¸‹ï¼š

```json
{
  "env": {
    "browser": true,
    "es2021": true,
    "node": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier",
    "plugin:prettier/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
  },
  "plugins": ["@typescript-eslint", "prettier"],
  "rules": {
    "prettier/prettier": "error",
    "no-case-declarations": "off",
    "no-constant-condition": "off",
    "@typescript-eslint/ban-ts-comment": "off"
  }
}
```

> **æç¤º**ï¼šæ›´å¤šè§„åˆ™ï¼Œå‚è€ƒ [è¿™é‡Œ >>](https://eslint.cn/docs/rules/)

### ä»£ç é£æ ¼ prettier

â‘  å®‰è£…ï¼š`pnpm i -D -w prettier`

â‘¡ æ–°å»º `.prettierrc.json` é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š

```json
{
 "printWidth": 80,
 "tabWidth": 2,
 "useTabs": true,
 "singleQuote": true,
 "semi": true,
 "trailingComma": "none",
 "bracketSpacing": true
}
```

â‘¢ å°† `prettier` é›†æˆåˆ° `eslint` ä¸­ï¼Œå…¶ä¸­ï¼š

- `eslint-config-prettier`ï¼šè¦†ç›– `ESLint` æœ¬èº«çš„è§„åˆ™é…ç½®
- `eslint-plugin-prettier`ï¼šç”¨ `Prettier` æ¥æ¥ç®¡ä¿®å¤ä»£ç å³ `eslint --fix`

```shell
$ pnpm i -D -w eslint-config-prettier eslint-plugin-prettier
```

â‘£ ä¸º `lint` å¢åŠ å¯¹åº”çš„æ‰§è¡Œè„šæœ¬ï¼š

```json
"lint": "eslint --ext .js,.ts,.jsx,.tsx --fix --quiet ./packages"
```

- `--ext`ï¼šæŒ‡å®šå¤„ç†çš„æ–‡ä»¶ç±»å‹
- `--fix`ï¼šä¿®å¤é—®é¢˜
- `--quiet`ï¼šä¸è¾“å‡ºåé¦ˆ

åŒæ—¶ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£… `prettier` ä¸ `eslint` çš„ VSCode æ’ä»¶ï¼Œå¹¶åœ¨ `setting` ä¸­è®¾ç½®ä¸ºä¿å­˜åè‡ªåŠ¨æ‰§è¡Œã€‚

*è®¾ç½®ä¸­æœç´¢ â€œEditor:Default formatterâ€ï¼Œå°†å€¼è®¾ç½®ä¸º â€œPrettier - Code formatterâ€*ï¼Œ

*åŒæ—¶æœç´¢ â€œEditor:Format On Saveâ€ï¼Œå‹¾é€‰â€œåœ¨ä¿å­˜æ—¶æ ¼å¼åŒ–æ–‡ä»¶â€*ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª `packages/test.js` æ–‡ä»¶ï¼Œå¹¶è¾“å…¥å¦‚ä¸‹ä»£ç ï¼š

``` js
const a = 10
console.log(a)
```

ç‚¹å‡»ä¿å­˜ï¼Œå¯ä»¥çœ‹åˆ°ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ åˆ†å¥½ â€œ`;`â€ã€‚

### commit è§„èŒƒæ£€æŸ¥ï¼ˆhuskyï¼‰

â‘  åˆå§‹åŒ–gitä»“åº“ï¼š

```shell
$ git init 
```

â‘¡ æ ¹ç›®å½•æ–°å»º `.gitignore` å¿½ç•¥æ–‡ä»¶ï¼š

```
/node_modules
/dist
```

> æç¤ºï¼šæ ¹æ®éœ€è¦å¿½ç•¥å¯¹åº”çš„æ–‡ä»¶

â‘¢ å®‰è£… [husky](https://www.npmjs.com/package/husky)ï¼Œç”¨äºæ‹¦æˆª `commit` å‘½ä»¤

```shell
$ pnpm i -D -w husky 
```

â‘£ åˆå§‹åŒ–`husky`ï¼š

```shell
$ npx husky install
```

â‘¤ é…ç½® commit æ—¶å¯¹ä»£ç é£æ ¼å’Œè§„èŒƒè¿›è¡Œæ£€æŸ¥

åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå°†åˆšæ‰å®ç°çš„æ ¼å¼åŒ–å‘½ä»¤ `pnpm lint` åŠ å…¥åˆ° husky çš„ `pre-commit` é’©å­é‡Œï¼š

```shell
$ npx husky add .husky/pre-commit "pnpm lint"
```

å½“æˆ‘ä»¬æ‰§è¡Œå®Œä¸Šè¿°çš„è„šæœ¬ä¹‹åï¼Œå¯ä»¥åœ¨ `.husky` ç›®å½•ä¸‹çœ‹åˆ°å¤šäº†ä¸€ä¸ª `pre-commit` çš„shellæ–‡ä»¶ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ `commit` å‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œ `pnpm lint` å»è¿›è¡Œä»£ç é£æ ¼å’Œæ ¼å¼åŒ–çš„æ£€æŸ¥ã€‚

> TODOï¼špnpm lint ä¼šå¯¹ä»£ç å…¨é‡æ£€æŸ¥ï¼Œå½“é¡¹ç›®å¤æ‚åæ‰§è¡Œé€Ÿåº¦å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œå±Šæ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ [lint-staged](https://github.com/okonet/lint-staged)ï¼Œå®ç°åªå¯¹æš‚å­˜åŒºä»£ç è¿›è¡Œæ£€æŸ¥

â‘¥ é…ç½® commit æ—¶å¯¹æäº¤ä¿¡æ¯æ˜¯å¦è§„èŒƒè¿›è¡Œæ£€æŸ¥

é€šè¿‡ [commitlint](https://github.com/conventional-changelog/commitlint) å¯¹gitæäº¤ä¿¡æ¯è¿›è¡Œæ£€æŸ¥ï¼Œé¦–å…ˆå®‰è£…å¿…è¦çš„åº“ï¼š

```shell
$ pnpm i -D -w commitlint @commitlint/cli @commitlint/config-conventional 
```

æ–°å»ºé…ç½®æ–‡ä»¶ `.commitlintrc.js`ï¼š

```js
module.exports = {
  extends: ["@commitlint/config-conventional"]
}; 
```

é›†æˆåˆ° `husky` ä¸­ï¼š

```shell
$ npx husky add .husky/commit-msg "npx --no-install commitlint -e $HUSKY_GIT_PARAMS"
```

ğŸ“Œ å»¶ä¼¸ï¼š**`conventional`  è§„èŒƒé›†æ„ä¹‰**

æ ¼å¼ï¼š

```
<type>: <subject> â†’ æäº¤çš„ç±»å‹: æ‘˜è¦ä¿¡æ¯
```

å¸¸ç”¨çš„ `type` å€¼åŒ…æ‹¬å¦‚ä¸‹:

- featï¼šæ·»åŠ æ–°åŠŸèƒ½
- fixï¼šä¿®å¤ Bug
- choreï¼šä¸€äº›ä¸å½±å“åŠŸèƒ½çš„æ›´æ”¹
- docsï¼šä¸“æŒ‡æ–‡æ¡£çš„ä¿®æ”¹
- perfï¼šæ€§èƒ½æ–¹é¢çš„ä¼˜åŒ–
- refactorï¼šä»£ç é‡æ„
- testï¼šæ·»åŠ ä¸€äº›æµ‹è¯•ä»£ç ç­‰ç­‰

> æäº¤æ—¶çš„ä»£ç æ ¼å¼ï¼š*`git commit -m "feat: xxx"`* 
>
> æ³¨æ„ï¼š`feat: ` åé¢è·Ÿä¸€ä¸ªç©ºæ ¼ã€‚

### é…ç½® `tsconfig.json`

```json
{
	"compileOnSave": true,
	"compilerOptions": {
		"target": "ESNext",
		"useDefineForClassFields": true,
		"module": "ESNext",
		"lib": ["ESNext", "DOM"],
		"moduleResolution": "Node",
		"strict": true,
		"sourceMap": true,
		"resolveJsonModule": true,
		"isolatedModules": true,
		"esModuleInterop": true,
		"noEmit": true,
		"noUnusedLocals": true,
		"noUnusedParameters": true,
		"noImplicitReturns": false,
		"skipLibCheck": true,
		"baseUrl": "./packages"
	}
}
```

## 3. é…ç½®æ‰“åŒ…å·¥å…·Â·rollup

æ¯”è¾ƒä¸åŒæ‰“åŒ…å·¥å…·çš„åŒºåˆ« [å‚è€ƒèµ„æ–™ï¼šOverview | Tooling.Report](https://bundlers.tooling.report/)æˆ‘ä»¬è¦å¼€å‘çš„é¡¹ç›®çš„ç‰¹ç‚¹ï¼š

- æ˜¯åº“ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡é¡¹ç›®
- å¸Œæœ›å·¥å…·å°½å¯èƒ½ç®€æ´ã€æ‰“åŒ…äº§ç‰©å¯è¯»æ€§é«˜
- åŸç”Ÿæ”¯æŒ`ESM`

æ‰€ä»¥é€‰æ‹© `rollup`ï¼Œå®‰è£…ï¼š

```shell
$ pnpm i -D -w rollup
```

æ¥ç€æ–°å»º rollup é…ç½®ç›®å½•ï¼š

```shell
$ mkdir -p scripts/rollup
```

æ‰€æœ‰rollupç›¸å…³çš„é…ç½®éƒ½ä¼šæ”¾åœ¨rollupç›®å½•ä¸­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆæäº¤ä¸€ä¸‹ä»£ç ï¼š

```shell
$ git add . && git commit -m 'feat: å·¥ç¨‹åŒ–é…ç½®åˆå§‹åŒ–'
```

## 4. æ–°å»ºåº“ï¼ˆlg-toolsï¼‰

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ packages ç›®å½•ä¸­æ–°å»º `lg-tools` åº“ã€‚

```shell
$ mkdir -p packages/lg-tools && cd packages/lg-tools
$ pnpm init 
$ touch index.ts
```



# ä¸‰ã€å¸¸è§é—®é¢˜

è§£å†³é—®é¢˜çš„åŸºæœ¬é—®é¢˜ï¼šå„å¸å…¶èŒ

1. pnpm åªè´Ÿè´£ç”Ÿæˆä¾èµ–ç›®å½• `node_modules`
2. è„šæ‰‹æ¶è´Ÿè´£åœ¨å·¥ä½œç›®å½•å†…æ„å»ºå¼€å‘ç¯å¢ƒã€æ‰“åŒ…é¡¹ç›®
3. lock æ–‡ä»¶è´Ÿè´£è®°å½•ä¾èµ–ç‰ˆæœ¬å·
4. `packagejson` è´Ÿè´£è®°å½•ä¾èµ–å’Œè„šæœ¬



â‘  éœ€è¦æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹é…ç½®å•ç‹¬çš„å…¥å£æ–‡ä»¶å—â“

ç­”ï¼šæ˜¯çš„ï¼Œéœ€è¦ã€‚æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹éƒ½æ˜¯ç‹¬ç«‹çš„é¡¹ç›®ã€‚

â‘¡ æ€ä¹ˆå®‰è£…ä¾èµ–â“

ç­”ï¼šæˆ‘å»ºè®®åœ¨æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ä¸‹é¢æ‰§è¡Œ `pnpm i `

â‘¢ æ€ä¹ˆå¼•ç”¨ä¾èµ–â“

ç­”ï¼šè¯¥æ€ä¹ˆå¼•ç”¨å°±æ€ä¹ˆå¼•ç”¨

â‘£ æ€ä¹ˆæ‰“åŒ…ï¼Ÿæ€ä¹ˆå¯åŠ¨å¼€å‘ç¯å¢ƒâ“

ç­”ï¼šå¯¹æ¯ä¸ªé¡¹ç›®è€Œè¨€ï¼Œè·Ÿä»¥å‰ä¸€æ ·ã€‚å¯¹æ•´ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥è‡ªå·±å†™è„šæœ¬ã€‚

â‘¤ å•ä¸ªé¡¹ç›®éœ€è¦å‘å¸ƒåˆ° npm ä¹ˆâ“

ç­”ï¼šä¸éœ€è¦ã€‚å¯¹åŒä¸€ä¸ª monorepo ä¸‹çš„é¡¹ç›®ï¼Œå®ƒä»¬å°±ç›¸å½“äºå·²ç»å‘å¸ƒäº†ã€‚

â‘¥ æ€ä¹ˆå¤„ç†ç«¯å£ â“

ç­”ï¼šä»¥å‰æ€ä¹ˆå¤„ç†ï¼Œç°åœ¨è¿˜æ˜¯ã€‚workspace å¹¶ä¸ä¼šå¸®ä½ å¤„ç†ç«¯å£ã€‚

# å››ã€å®æˆ˜



### `bable.config.js`

```
export default {
  presets: [
    [
      '@babel/preset-env',
      {
        useBuiltIns: 'usage',
        corejs: 3,
        modules: false,
      },
    ],
    '@babel/preset-typescript',
  ],
};
```

> **æç¤ºï¼š** **`modules: false`** å¯ä»¥é˜»æ­¢Babelåœ¨Rollupæœ‰æœºä¼šåšå¤„ç†ä¹‹å‰ï¼Œå°†æˆ‘ä»¬çš„æ¨¡å—è½¬æˆ CommonJS ï¼Œå¯¼è‡´ Rollup çš„å¤„ç†å¤±è´¥ã€‚

> æç¤ºï¼šæ ¹ç›®å½•æ–°å»º `/scripts/roullup` ç›®å½•ï¼Œç”¨äºå­˜å‚¨å’Œrollupç›¸å…³çš„é…ç½®ã€‚

# äº”ã€è°ƒè¯•æ–¹å¼

### 1. [pnmp link](https://pnpm.io/zh/cli/link)

![](./IMGS/law7jksx0wjf.png)

è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼šå¯ä»¥æ¨¡æ‹Ÿå®é™…é¡¹ç›®å¼•ç”¨ **åº“** çš„æƒ…å†µ

ç¼ºç‚¹ï¼šå¯¹äºå¼€å‘ **åº“** æ¥è¯´ï¼Œç•¥æ˜¾ç¹çã€‚å¯¹äºå¼€å‘è¿‡ç¨‹ï¼Œæ›´æœŸæœ›çš„æ˜¯çƒ­æ›´æ–°æ•ˆæœã€‚

### 2. Vite

â‘  åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º Vite é¡¹ç›®

```shell
$ pnpm create vite 
âœ” Project name: â€¦ examples
âœ” Select a framework: â€º React
âœ” Select a variant: â€º TypeScript
```

# å…­ã€Changesets

â‘  å®‰è£… @changesets/cli

```shell
$ pnpm i -D -w @changesets/cli
```

â‘¡ æ–°å»º .changeset/config.json æ–‡ä»¶

```shell
$ pnpm changeset init
```

â‘¢ åˆ›å»ºå˜æ›´é›†

ä½¿ç”¨ `changeset` å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå˜æ›´é›†ã€‚å˜æ›´é›†æ˜¯ä¸€ç»„å…³äºè¦è¿›è¡Œçš„æ›´æ”¹çš„æè¿°ï¼Œä¾‹å¦‚æ–°åŠŸèƒ½ã€ä¿®å¤ã€API æ›´æ”¹ç­‰ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
$ pnpm changeset
```

è¿™å°†å¼•å¯¼æ‚¨åˆ›å»ºä¸€ä¸ªæ–°çš„å˜æ›´é›†ï¼Œå¹¶è¯¢é—®æ‚¨å…³äºæ›´æ”¹çš„ä¿¡æ¯ã€‚

â‘£ å‘å¸ƒå˜æ›´é›†

ä¸€æ—¦æ‚¨åœ¨å˜æ›´é›†ä¸­è®°å½•äº†ä¸€ç»„æ›´æ”¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆå‘å¸ƒç‰ˆæœ¬ï¼š

```shell
$ pnpm changeset version
```

è¿™å°†æ ¹æ®å˜æ›´é›†çš„å†…å®¹è‡ªåŠ¨ç”Ÿæˆé€‚å½“çš„ç‰ˆæœ¬å·ï¼Œå¹¶æ›´æ–°æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬å·å’Œä¾èµ–å…³ç³»ã€‚

> æç¤ºï¼šé»˜è®¤æ˜¯ majorï¼Œå¦‚æœä¸é€‰æ‹©é¡¹ï¼Œç›´æ¥å›è½¦ï¼Œåˆ™ä¸º minorï¼ŒåŒæ ·å¦‚æœä¸é€‰æ‹©é¡¹ï¼Œç›´æ¥å›è½¦åˆ™ä¸ºpatchã€‚

â‘¤ å‘å¸ƒåˆ°npm

æœ€åï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å°†å˜æ›´åº”ç”¨åˆ° npm åŒ…å¹¶å‘å¸ƒå®ƒä»¬ï¼š

```shell
$ pnpm changeset publish --access public
```

è¿™å°†æ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬ç”Ÿæˆ Changelogã€æ›´æ–°ç‰ˆæœ¬å·ã€å‘å¸ƒåˆ° npm ç­‰ã€‚

# é•œåƒ

```markdown
# å®˜æ–¹:
npm config set registry https://registry.npmjs.org/
# æ·˜å®: 
npm config set registry https://registry.npmmirror.com
```












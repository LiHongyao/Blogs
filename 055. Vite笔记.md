# ä¸€ã€å‰è¨€

Vite æ˜¯ä¸€ç§æ–°å‹å‰ç«¯æ„å»ºå·¥å…·ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å‰ç«¯å¼€å‘ä½“éªŒã€‚11 æœˆ 16 æ—¥ï¼ŒVite 5.0 æ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ Vite é“è·¯ä¸Šçš„åˆä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ï¼

> æç¤ºï¼šå…³äºViteçš„æ›´å¤šä»‹ç»ï¼Œè¯·ç§»æ­¥è‡³ [å®˜ç½‘ >>](https://vitejs.dev/)

# äºŒã€æ­å»ºé¡¹ç›®

**`node`**ï¼šv20.9.0

**`npm`**ï¼šv10.1.0

**`vite`**ï¼šv5.0.0

```shell
$ pnpm create vite <PROJECT-Name> --template vue-ts
```

> æç¤ºï¼šå…³äºå¦‚ä½•åŸºäº Vite åˆ›å»ºé¡¹ç›®ï¼Œå¯ä»¥å‚è€ƒ [è¿™é‡Œ >>](https://vitejs.dev/guide/#scaffolding-your-first-vite-project)ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ `react`ï¼Œè¯·å°† `vue-ts` æ›¿æ¢æˆ `react-ts`ã€‚

# ä¸‰ã€vite.config.js

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä¸€äº›Viteç›¸å…³çš„é…ç½®ï¼ŒåŸºæœ¬é…ç½®å¦‚ä¸‹ï¼š

```ts
import { defineConfig, loadEnv } from "vite";
import vue from "@vitejs/plugin-vue";

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), "");
  return {
    plugins: [vue()],
  };
});
```

## 1. å–åˆ«å

```shell
$ pnpm add @types/node -D
```
> **`vite.config.js`**

```js
import { defineConfig, loadEnv } from "vite";
import { resolve } from "path";

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), "");
  return {
    resolve: {
      alias: {
        "@": resolve(__dirname, "src"),
        comps: resolve(__dirname, "src/components"),
      },
    },
  };
});
```

> **`ts.config.json`**

```json
{
  "compilerOptions": {
   "baseUrl": ".",
   "paths": {
     "@/*": ["src/*"],
     "comps/*": ["src/components/*"]
   }
 },
```

> æç¤ºï¼šæ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é…ç½®ï¼Œé€šå¸¸æ¥è¯´ï¼Œé…ç½® `@/` æŒ‡å‘ `src/*` ç›®å½•å³å¯ã€‚
>
> @See https://vitejs.dev/config/shared-options.html#resolve-alias

## 2. å¼€å‘æœåŠ¡å™¨é€‰é¡¹ & ä»£ç†

```js
server: {
  host: "0.0.0.0",
  port: 8888,
  strictPort: true,
  open: true,
  cors: true,
  proxy: {},
}
```

> @See https://vitejs.dev/config/server-options.html

## 3. ç¯å¢ƒå˜é‡

> @See https://vitejs.dev/guide/env-and-mode.html

- `import.meta.env.PROD`ï¼šæ ¡éªŒå½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒ
- `import.meta.env.DEV`ï¼šæ ¡éªŒå½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ

**â‘ . åœ¨æ ¹ç›®å½•æ–°å»º  `.env.dev`ã€`.env.production`ã€`.env.qa`**

```ini
NODE_ENV=development

# -- å½“å‰ç¯å¢ƒï¼ˆå¼€å‘ç¯å¢ƒï¼‰
VITE_ENV=dev;
# -- æœåŠ¡å™¨åœ°å€
VITE_API_HOST=å¼€å‘ç¯å¢ƒæœåŠ¡å™¨åœ°å€;
# -- è¾“å‡ºç›®å½•
VITE_OUT_DIR="H5-qa"
```

> æç¤ºï¼š
>
> 1ï¼‰ç¯å¢ƒå˜é‡åå¿…é¡»ä»¥ `VITE_` å¼€å¤´ï¼›
>
> 2ï¼‰é…ç½®æ–‡ä»¶çš„å†…å®¹è¯·æ ¹æ®é¡¹ç›®éœ€è¦è®¾ç½®ï¼›

**â‘¡. ä¿®æ”¹ `package.json` æŒ‡ä»¤**

> **@Vue **

```json
"dev": "vite --mode dev",
"build:qa": "vue-tsc && vite build --mode qa",
"build:prod": "vue-tsc && vite build --mode prod",
```

> **@React**

```
"dev": "vite --mode dev",
"build:qa": "tsc && vite build --mode qa",
"build:prod": "tsc && vite build --mode prod",
```

**â‘¢. é…ç½®ç¯å¢ƒå˜é‡æ™ºèƒ½æç¤º**

> **`vite-env.d.ts`**

```ts
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_ENV: string;
  readonly VITE_API_HOST: string;
  readonly VITE_OUT_DIR: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

**â‘£. ä½¿ç”¨ç¯å¢ƒå˜é‡**

```tsx
import.meta.env.VITE_API_HOST
```

## 4. æ„å»ºç›¸å…³

```ts
build: {
  target: 'modules',
  sourcemap: false,
  outDir: env.VITE_OUT_DIR,
  // -- chunk å¤§å°è­¦å‘Šçš„é™åˆ¶ï¼ˆä»¥ kbs ä¸ºå•ä½ï¼‰
  chunkSizeWarningLimit: 2000,
  // -- å¯ç”¨/ç¦ç”¨ gzip å‹ç¼©å¤§å°æŠ¥å‘Š
  reportCompressedSize: false,
}
```

> @See https://vitejs.dev/config/build-options.html

## 5. æµè§ˆå™¨å…¼å®¹

```shell
$ pnpm add @vitejs/plugin-legacy -D
```

```ts
import { defineConfig } from "vite";
import legacy from "@vitejs/plugin-legacy";
export default defineConfig(({ mode }) => {
  return {
    plugins: [
      legacy({
        targets: ["defaults", "not IE 11"],
      }),
    ],
  };
});

```

> @ See https://github.com/vitejs/vite/tree/main/packages/plugin-legacy

# å››ã€é¡¹ç›®é…ç½®

## 1. æ ·å¼

### less & sass

```shell
$ pnpm add -D less 
$ pnpm add -D sass 
```

> æç¤ºï¼šç›´æ¥å®‰è£… `less` æˆ– `sass` å³å¯ä½¿ç”¨ï¼Œæ— éœ€ä»»ä½•é…ç½®ã€‚

### tailwindcss

> å®˜ç½‘ï¼šhttps://www.tailwindcss.cn/

1ï¼‰å®‰è£…ï¼š

```shell
$ pnpm add -D tailwindcss
$ npx tailwindcss init
```

2ï¼‰åœ¨å…¨å±€æ ·å¼æ–‡ä»¶å¼•å…¥ tailwindcss æ¨¡å—

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

## 2. ç§»åŠ¨ç«¯é€‚é…

```shell
$ pnpm add -D postcss-pxtorem autoprefixer 
```

**`postcss.config.js`**

```js
export default {
  plugins: {
    autoprefixer: {
      overrideBrowserslist: [
        "Android 4.1",
        "iOS 7.1",
        "Chrome > 31",
        "ff > 31",
        "ie >= 8",
      ],
    },
    "postcss-pxtorem": {
      // -- Vant å®˜æ–¹æ ¹å­—ä½“å¤§å°æ˜¯ 37.5
      rootValue: 37.5,
      propList: ["*"],
      // -- è¿‡æ»¤æ‰.norem-å¼€å¤´çš„classï¼Œä¸è¿›è¡Œremè½¬æ¢
      selectorBlackList: [".norem"],
    },
  },
};
```

**`@/utils/rem.ts`**

```ts
//Â rem ç­‰æ¯”é€‚é…é…ç½®æ–‡ä»¶
//Â åŸºå‡†å¤§å°ï¼Œæ³¨æ„æ­¤å€¼è¦ä¸Â postcss.config.jsÂ æ–‡ä»¶ä¸­çš„Â rootValueä¿æŒä¸€è‡´
const baseSize = 37.5;
//Â è®¾ç½®Â remÂ å‡½æ•°
function setRem() {
  //Â å½“å‰é¡µé¢å®½åº¦ç›¸å¯¹äº375å®½çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œå¯æ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹,ä¸€èˆ¬è®¾è®¡ç¨¿éƒ½æ˜¯å®½750(å›¾æ–¹ä¾¿å¯ä»¥æ‹¿åˆ°è®¾è®¡å›¾åæ”¹è¿‡æ¥)ã€‚
  const scale = document.documentElement.clientWidth / 375; //Â è®¾ç½®é¡µé¢æ ¹èŠ‚ç‚¹å­—ä½“å¤§å°ï¼ˆâ€œMath.min(scale,Â 2)â€Â æŒ‡æœ€é«˜æ”¾å¤§æ¯”ä¾‹ä¸º2ï¼Œå¯æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼‰
  document.documentElement.style.fontSize = baseSize * Math.min(scale, 2) + "px";
}
//Â åˆå§‹åŒ–
setRem();
//Â æ”¹å˜çª—å£å¤§å°æ—¶é‡æ–°è®¾ç½®Â rem
window.onresize = function () {
  setRem();
};
```

åœ¨ `mian.ts(x)`  å¼•å…¥ï¼š

```ts
import "@/utils/rem";
```

> å¦‚æœæ§åˆ¶å°æŠ›å‡ºï¼šã€æ— æ³•åœ¨ `--isolatedModules` ä¸‹ç¼–è¯‘ `rem.ts`ï¼Œå› ä¸ºå®ƒè¢«è§†ä¸ºå…¨å±€è„šæœ¬æ–‡ä»¶ã€‚è¯·æ·»åŠ å¯¼å…¥ã€å¯¼å‡ºæˆ–ç©ºçš„  `export {}` è¯­å¥æ¥ä½¿å®ƒæˆä¸ºæ¨¡å—ã€‘æ­¤æ—¶ä½ åº”è¯¥åœ¨ `tsconfig.json` æ–‡ä»¶ä¸­å°† `isolatedModules` å­—æ®µè®¾ç½®ä¸º `false`ã€‚

## 3. UIæ¡†æ¶ Â· Vant

æ¨èä½¿ç”¨ [Vant 4 >>](https://vant-contrib.gitee.io/vant/#/zh-CN/quickstart)

```shell
$ pnpm add vant
```

é…ç½®æŒ‰éœ€å¼•å…¥ï¼šå‚è€ƒ [è¿™é‡Œ >>](https://vant-contrib.gitee.io/vant/#/zh-CN/quickstart#fang-fa-er.-an-xu-yin-ru-zu-jian-yang-shi)

**â‘ . å®‰è£…ä¾èµ–**

```shell
$ pnpm add @vant/auto-import-resolver unplugin-vue-components -D
```

**â‘¡ . é…ç½®æ’ä»¶**

> **`vite.config.ts`**

```ts
import { defineConfig } from "vite";
import { VantResolver } from "@vant/auto-import-resolver";
import Components from "unplugin-vue-components/vite";

export default defineConfig(({ mode }) => {
  return {
    plugins: [
    	...
      Components({
        resolvers: [VantResolver()],
      }),
    ],
  };
});
```

## 4. mockjs

**â‘ . å®‰è£…ä¾èµ–ï¼š**

```shell
$ pnpm add -D mockjs vite-plugin-mock@2.9.6
```

> æç¤ºï¼š`vite-plugin-mock` æŒ‡å®š `2.9.6` ç‰ˆæœ¬ï¼Œ`3.x` ç‰ˆæœ¬ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

**â‘¡. å¼•å…¥æ’ä»¶**

> **`vite.config.ts`**

```js
import { defineConfig } from "vite";
import { viteMockServe } from "vite-plugin-mock";

export default defineConfig(({ mode }) => {
  return {
    ...
    plugins: [viteMockServe()],
  };
});

```

**â‘¢. æ–°å»º <u>mock/test.ts</u> æ–‡ä»¶**

```js
// @ts-ignore
import { mock } from "mockjs";

export default [
  {
    url: "/api/user/info",
    method: "GET",
    response: (req: any) => {
      return mock({
        code: 200,
        data: {
          id: "@guid",
          name: "@cname",
          avatar: "@Image('30x30','@color')",
        },
        msg: "success",
      });
    },
  },
];
```

> æç¤ºï¼šåœ¨å¼•å…¥ `mockjs` æ—¶ï¼Œæˆ‘æ·»åŠ äº† `@ts-ignore`ï¼Œå› ä¸ºåœ¨ `mockjs^1.1.0` ä¸­ï¼Œå¯¼å‡ºçš„æ˜¯ `Mock`ï¼Œ`M` æ˜¯å¤§å†™å­—æ¯ï¼Œå®é™…åœ¨è°ƒç”¨çš„æ—¶å€™æ˜¯å°å†™ã€‚

**â‘£. æ¨¡æ‹Ÿè¯·æ±‚**

```
fetch("api/user/info")
  .then((resp) => resp.json())
  .then((info) => {
    console.log(info);
  });
```

## 5. axios

**â‘ . å®‰è£…ç›¸å…³ä¾èµ–ï¼š**

```shell
$ pnpm add axios @likg/tools
```

**â‘¡. æ–°å»ºç›®å½•**

```shell
$ mkdir -p src/api/apiConfig src/api/apiServer
$ touch src/api/apiConfig/index.ts src/api/apiConfig/axios-type.d.ts src/api/apiServer/index.ts src/api/apiServer/typings.d.ts src/api/apiServer/apiExamples.ts
```

ç”Ÿæˆç›®å½•å¦‚ä¸‹ï¼š

```
.
â”œâ”€â”€ api
    â”œâ”€â”€ apiConfig
    â”‚   â”œâ”€â”€ axios-type.d.ts
    â”‚   â””â”€â”€ index.ts
    â””â”€â”€ apiServer 
        â”œâ”€â”€ apiExamples.ts
        â”œâ”€â”€ index.ts
        â””â”€â”€ typings.d.ts
```

> **`apiConfig/axios-type.d.ts`**

```ts
import 'axios';

declare module 'axios' {
  export interface AxiosResult<T = any> {
    code: number;
    data: T;
    msg: string | { detail: string };
  }
}
```

> **`apiConfig/index.ts`**

```ts
import Tools from "@likg/tools";
import axios, {
  AxiosError,
  AxiosInstance,
  AxiosRequestConfig,
  AxiosResponse,
  AxiosResult,
} from "axios";
import { showToast, closeToast } from "vant";

/********************
 ** åˆ›å»ºaxioså®ä¾‹
 ********************/
const axiosInstance: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_HOST,
  timeout: 60000,
  withCredentials: false,
  headers: {
    "Access-Control-Allow-Origin": "*",
    "Content-Type": "application/json",
  },
});

/********************
 ** è¯·æ±‚æ‹¦æˆªå™¨
 ********************/
axiosInstance.interceptors.request.use(
  (config: AxiosRequestConfig): any => {
    // -- GETè¯·æ±‚æ‹¼æ¥éšæœºå€¼
    if (/GET/i.test(config.method || "")) {
      const t = Math.random().toString(36).slice(2, 9);
      config.params = { ...config.params, t };
    }

    // -- æ‹¼æ¥token
    const token = localStorage.getItem("AUTHORIZATION_TOKEN");

    // -- ç¡®è®¤å¹³å°
    // -- å¦‚æœåŒæ—¶å¼€å‘æ”¯ä»˜å®/å¾®ä¿¡å…¬ä¼—å·/H5åˆ™éœ€è¦ä¼ å…¥æ¥æº
    // -- æ³¨æ„ï¼šå…·ä½“å€¼è¯·ä¸åç«¯é…åˆå•†è®®å¯¹åº”å¹³å°çš„sourceå€¼
    const platforms: Record<string, string> = {
      alipay: "MP_ALIPAY",
      weixin: "MP_WEIXIN",
    };
    const source = platforms[Tools.getEnv()] || "H5";

    // -- é…ç½®è¯·æ±‚å¤´
    config.headers = {
      Authorization: token ? `Bearer ${token}` : "",
      source,
      ...config.headers,
    };
    // -- è¿”å›é…ç½®
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

/********************
 ** å“åº”æ‹¦æˆªå™¨
 ********************/
axiosInstance.interceptors.response.use(
  async (response: AxiosResponse) => {
    closeToast();
    // -- å¤„ç†æµæ•°æ®
    if (response.request.responseType === "blob") {
      return { code: 200, data: response.data, msg: "success" };
    }
    // -- åˆ¤æ–­codeï¼Œç»Ÿä¸€å¤„ç†å¼‚å¸¸
    const { code, msg } = response.data as unknown as AxiosResult;
    if (code === 200) {
      // 1. æˆåŠŸ
      return response.data;
    } else if (code === 402) {
      // 2. Token è¿‡æœŸ
      // history.replace('/login');
      return Promise.reject();
    } else {
      const errMsg = msg
        ? typeof msg === "string"
          ? msg
          : msg.detail
        : "æœåŠ¡å™¨å¼‚å¸¸";
      showToast(errMsg);
      return Promise.reject(errMsg);
    }
  },
  (error: AxiosError) => {
    console.log("[request error] > ", error);

    if (error && error.response) {
      switch (error.response.status) {
        case 400:
          error.message = "è¯·æ±‚é”™è¯¯(400)";
          break;
        case 401:
          error.message = "æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•(401)";
          break;
        case 403:
          error.message = "æ‹’ç»è®¿é—®(403)";
          break;
        case 404:
          error.message = "è¯·æ±‚å‡ºé”™(404)";
          break;
        case 405:
          error.message = "è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ(405)";
          break;
        case 408:
          error.message = "è¯·æ±‚è¶…æ—¶(408)";
          break;
        case 500:
          error.message = "æœåŠ¡å™¨å¼‚å¸¸(500)";
          break;
        case 501:
          error.message = "æœåŠ¡æœªå®ç°(501)";
          break;
        case 502:
          error.message = "ç½‘ç»œé”™è¯¯(502)";
          break;
        case 503:
          error.message = "ç½‘ç»œè¶…æ—¶(504)(503)";
          break;
        case 504:
          error.message = "ç½‘ç»œè¶…æ—¶(504)";
          break;
        case 505:
          error.message = "HTTPç‰ˆæœ¬ä¸å—æ”¯æŒ(505)";
          break;
        default:
          error.message = `è¿æ¥å‡ºé”™(${error.response.status})!`;
      }
    } else {
      error.message = "æœåŠ¡é“¾æ¥å¤±è´¥";
    }
    showToast(error.message);
    return Promise.reject(error);
  }
);

const request = <R = any>(
  options: AxiosRequestConfig
): Promise<AxiosResult<R>> => {
  return axiosInstance(options);
};

export default request;
```

> **`apiServer/typings.d.ts`**

```ts
declare namespace API {
  interface List<T> {
    pages: number;
    count: number;
    data: T[];
  }

  interface InfoResp {
    id: string;
    name: string;
    avatar: string;
  }
}
```

æç¤ºï¼šè¿™ä¸ªæ–‡ä»¶ä¸»è¦å®šä¹‰ä¸€äº›æ¥å£è¯·æ±‚æˆ–å“åº”çš„æ•°æ®ç±»å‹ã€‚

> **`apiServer/apiExamples.ts`**

```ts
import request from "@/api/apiConfig";

export async function info(id: string) {
  return request<API.InfoResp>({
    url: "/api/user/info",
    method: "GET",
    data: { id },
  });
}
```

æç¤ºï¼šè¿™ä¸ªæ–‡ä»¶ä¸»è¦å®šä¹‰å®é™…ä¸šåŠ¡éœ€æ±‚ä¸­çš„æ¥å£ï¼Œä½ åº”è¯¥æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯åˆ›å»ºä¸åŒçš„æ–‡ä»¶ï¼Œæ–‡ä»¶åä¹‰ `apiXXX` å¼€å¤´ã€‚

> **`apiServer/index.ts`**

```ts
import * as apiExamples from "./apiExamples";
export { apiExamples };
```

æç¤ºï¼šè¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯ç»Ÿä¸€å¯¼å‡ºæ¥å£è¯·æ±‚ã€‚

è°ƒç”¨ï¼š

```vue
<script setup lang="ts">
import { apiExamples } from "@/api/apiServer";
const onFetch = async () => {
  try {
    const resp = await apiExamples.info("123");
    console.log(resp.data);
  } catch (error) {
    console.log(error);
  }
};
</script>

<template>
  <div>
    <van-button @click="onFetch">æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</van-button>
  </div>
</template>
```

## 6. å…¨å±€ç±»å‹å£°æ˜

æœ‰æ—¶ï¼Œå½“æˆ‘ä»¬å¼•å…¥ä¸‰æ–¹SDKæ—¶ï¼Œéœ€è¦åœ¨windowä¸Šè®¿é—®ï¼Œå¯ä»¥å®šä¹‰å…¨å±€ç±»å‹å£°æ˜ï¼š

> **`@/typings/index.d.ts`**

```ts
export {};

// -- å…¨å±€ç»„ä»¶å±æ€§å®šä¹‰
import { FiltersProps } from "@/filters";
declare module "@vue/runtime-core" {
  interface ComponentCustomProperties {
    $filters: FiltersProps;
  }
}

declare global {
  // ğŸ‘‰ å®šä¹‰å…¨å±€å±æ€§
  interface Window {
    /** ç™¾åº¦ç»Ÿè®¡ */
    _hmt: any;
    /** å¾®ä¿¡S*/
    wx: any;
    /** ç™¾åº¦åœ°å›¾ */
    AMap: any;
    /** è…¾è®¯åœ°å›¾ */
    qq: any;
    /** æ”¯ä»˜å® */
    AlipayJSBridge: any;
    /** iOSå›è°ƒåœ°å€ */
    CONFIG_URL_FOR_IOS: string;
  }
}

```

## 7. vconsole

```shell
$ pnpm add -D vconsole
```

> **`main.ts`**

```ts
if (import.meta.env.VITE_ENV !== "prod") {
  new vconsole();
}
```

## 8. åŠ¨æ€åŠ è½½é™æ€èµ„æº

åœ¨ä½¿ç”¨ webpack åŠ¨æ€å¼•å…¥é™æ€èµ„æºå¯ä»¥ä½¿ç”¨ `require` å½¢å¼ï¼Œä½†æ˜¯åœ¨viteä¸­ä¸å¯å–ï¼Œä¼šæŠ›å‡º <u>*require is not defined*</u> çš„é”™è¯¯ã€‚

ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ [import.meta.url](https://cn.vitejs.dev/guide/assets.html#new-url-url-import-meta-url) çš„å½¢å¼å¼•å…¥ï¼Œå®ƒæ˜¯ä¸€ä¸ª ESM çš„åŸç”ŸåŠŸèƒ½ï¼Œä¼šæš´éœ²å½“å‰æ¨¡å—çš„ URLã€‚å°†å®ƒä¸åŸç”Ÿçš„ [URL æ„é€ å™¨](https://developer.mozilla.org/en-US/docs/Web/API/URL) ç»„åˆä½¿ç”¨ï¼Œåœ¨ä¸€ä¸ª JavaScript æ¨¡å—ä¸­ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„æˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€ä¸ªè¢«å®Œæ•´è§£æçš„é™æ€èµ„æº URLï¼Œå…¶è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š

```js
new URL(url, import.meta.url)
```

ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
const imgs = [
  { imgUrl: new URL('./assets/logo_1.png', import.meta.url), text: "æ ‡é¢˜1" },
  { imgUrl: new URL('./assets/logo_2.png', import.meta.url), text: "æ ‡é¢˜2" },
];
```

```react
// => react
{imgs.map((item) => (
  <img src={item.imgUrl.toString()} key={item.title} />
))}
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¼šæŠ›å‡º â€œ*URL is not defined xxx*â€  çš„é”™è¯¯ï¼Œè¿™ä¸ªæ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼š[rollup-plugin-import-meta-url-to-module](https://www.npmjs.com/package/rollup-plugin-import-meta-url-to-module)ã€‚

ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š

```shell
$ yarn add rollup-plugin-import-meta-url-to-module
```

ç„¶åå† â€œ*vit.config.js*â€ ä¸­é…ç½®pluginsï¼š

```js
import urlToModule from 'rollup-plugin-import-meta-url-to-module';

export default {
  plugins: [
    urlToModule()
  ]
};
```

# äº”ã€å·®å¼‚åŒ–é…ç½®

## 1. Vue

### - è·¯ç”±é…ç½®

å®‰è£…ä¾èµ–ï¼š

```shell
$ pnpm add vue-router
```

æ–°å»ºæ–‡ä»¶ï¼š

```shell
$ mkdir -p src/router && touch src/router/index.ts src/router/routes.ts
```

> **`routes.ts`**

```ts
import { RouteRecordRaw } from "vue-router";

import Layouts from "@/layouts/index.vue";

const routes: RouteRecordRaw[] = [
  {
    path: "/",
    name: "layouts",
    redirect: "/index-page",
    component: Layouts,
    children: [
      {
        path: "/index-page",
        name: "index",
        component: () => import("@/pages/Tabs/IndexPage.vue"),
        meta: { title: "é¦–é¡µ" },
      },
      {
        path: "/special-sale",
        name: "SpecialSale",
        component: () => import("@/pages/Tabs/SpecialSale.vue"),
        meta: { title: "ç‰¹å–" },
      },
      {
        path: "/friends",
        name: "Friends",
        component: () => import("@/pages/Tabs/Friends.vue"),
        meta: { title: "å¥½å‹" },
      },
      {
        path: "/mine",
        name: "Mine",
        component: () => import("@/pages/Tabs/Mine.vue"),
        meta: { title: "æˆ‘çš„" },
      },
    ],
  },
  {
    path: "/download",
    name: "Download",
    component: () => import("@/pages/Download/index.vue"),
    meta: {
      title: "ä¸‹è½½",
    },
  },
  {
    path: "/not-found",
    name: "NotFound",
    component: () => import("@/pages/NotFound/index.vue"),
  },
  {
    path: "/:pathMatch(.*)",
    redirect: "/not-found",
  },
];

export default routes;

```

> **`index.ts`**

```ts
import { createRouter, createWebHistory } from "vue-router";
import routes from "./routes";

const router = createRouter({
  // -- éƒ¨ç½²äºŒçº§ç›®å½•ï¼šcreateWebHistory(base?: string)
  history: createWebHistory(import.meta.env.VITE_BASE),
  // -- è·¯ç”±
  routes,
  // -- æ»šåŠ¨è¡Œä¸º
  scrollBehavior: () => ({
    el: "#app",
    top: 0,
    behavior: "smooth",
  }),
});

// å¯¼èˆªå®ˆå«
router.beforeEach(async (to, _) => {});

router.afterEach((to) => {
  // â†’ è®¾ç½®æ ‡é¢˜
  if (to.path !== "/favicon.icon") {
    document.title = to.meta.title ? (to.meta.title as string) : "";
  }
  // â†’ æ»šåŠ¨
  window.scrollTo(0, 0);
});

export default router;

```

> æç¤ºï¼šè¿™é‡Œåªæ˜¯ç®€å•æ¼”ç¤ºå¦‚ä½•é…ç½®è·¯ç”±ï¼Œå®é™…ä¸Šä½ åº”è¯¥æ ¹æ®ä½ çš„ä¸šåŠ¡éœ€æ±‚æ¥é…ç½®ã€‚å…³äº vue-router çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ [è¿™é‡Œ >>](https://router.vuejs.org/)

åœ¨main.tsæŒ‚è½½è·¯ç”±

```ts
import App from "@/App.vue";
import router from "@/router";

// Appé…ç½®/æŒ‚è½½ç›¸å…³
// 1. åˆ›å»ºApp
const app = createApp(App);
// 2. æ³¨å…¥
app.use(router);
// 3. æŒ‚è½½
app.mount("#app");
```

### - çŠ¶æ€ç®¡ç†

```shell
$ pnpm add pinia
```

> æç¤ºï¼šå…³äº Pinia çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ [è¿™é‡Œ >>](https://pinia.vuejs.org/zh/)

**`@/stores/index.ts`**

```ts
import { defineStore } from 'pinia';

interface StoreProps {
  count: number;
}

interface ActionProps {
  increment: () => void;
  decrement: () => void;
}

export const useStore = defineStore<string, StoreProps, any, ActionProps>(
  'appStore',
  {
    state: () => ({ count: 0 }),
    actions: {
      async increment() {},
      async decrement() {},
    },
  }
);
```

æŒ‚è½½ï¼šåœ¨main.tsæŒ‚è½½æ•°æ®ä¸­å¿ƒ

```ts
import { createApp } from "vue";
import { createPinia } from "pinia";
import { useStore } from "@/stores";
import App from "@/App.vue";

// ğŸ‘‰ app
// 1. åˆ›å»ºapp
const app = createApp(App);
// 2. æ³¨å…¥ä¾èµ–
app.use(createPinia());

// 4. æŒ‚åœ¨app
app.mount("#app");

// ğŸ‘‰ æŒä¹…åŒ–pinia
const store = useStore();
// é¡µé¢è¿›å…¥ï¼šåˆå¹¶çŠ¶æ€
const localState = localStorage.getItem("PINIA_PERSISTENCE");
if (localState) {
  console.log("[æ¸©é¦¨æç¤º]ï¼šåˆå¹¶Store...");
  store.$state = JSON.parse(localState);
}
// é¡µé¢åˆ·æ–°ï¼šå­˜å‚¨çŠ¶æ€
window.addEventListener("beforeunload", () => {
  console.log("[æ¸©é¦¨æç¤º]ï¼šç¼“å­˜Store...");
  localStorage.setItem("PINIA_PERSISTENCE", JSON.stringify(store.$state));
});

```

### - Vant

å®‰è£…ä¾èµ–ï¼š

```shell
$ pnpm add vant
```

> æç¤ºï¼šå…³äºVantçš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ [è¿™é‡Œ >>](https://vant-contrib.gitee.io/vant/#/zh-CN/quickstart)

### - äºŒçº§ç›®å½•éƒ¨ç½²

**æ–¹æ¡ˆ1ï¼š**

æ‰“åŒ…æ—¶è®¾ç½® `-base` é€‰é¡¹ï¼š

```js
"build": "vue-tsc --noEmit && vite build --mode production --base=/äºŒçº§ç›®å½•å/",
```

ç„¶åå† `router/index.ts` ä¸­é…ç½®å¦‚ä¸‹ï¼š

```js
const router = createRouter({
  // éƒ¨ç½²äºŒçº§ç›®å½•ï¼šcreateWebHistory(base?: string)
  history: createWebHistory("/äºŒçº§ç›®å½•å/"),
  routes,
});
```

**æ–¹æ¡ˆ2ï¼š**

åœ¨ `vite.config.js` é…ç½®é¡¹ä¸­æ·»åŠ  `base` é…ç½®ï¼Œå¦‚ï¼š

```js
base:"/YOUR_PROJECT_NAME/"
```

ç„¶åå† `router/index.ts` ä¸­é…ç½®å¦‚ä¸‹ï¼š

```js
const router = createRouter({
  // éƒ¨ç½²äºŒçº§ç›®å½•ï¼šcreateWebHistory(base?: string)
  history: createWebHistory("/äºŒçº§ç›®å½•å/"),
  routes,
});
```

## 2. React

### - è·¯ç”±é…ç½®

**â‘ . ç›®å½•ç»“æ„**

```ini
.
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ Fallback # æ‡’åŠ è½½loadingæç¤º 
â”‚   â”œâ”€â”€ NotEnv   # éå¾®ä¿¡/æ”¯ä»˜å®ç¯å¢ƒæç¤º
â”‚	  â””â”€â”€ TabBar   # æ ‡ç­¾æ 
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ index.less
â”œâ”€â”€ layouts
â”‚	  â””â”€â”€ index.tsx
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ Auth
â”‚   â”œâ”€â”€ IndexPage
â”‚   â”œâ”€â”€ Integral
â”‚   â”œâ”€â”€ Mine
â”‚   â”œâ”€â”€ NotFound
â”‚	  â””â”€â”€ PrivilegeBrand
â”œâ”€â”€ router
â”‚   â”œâ”€â”€ index.tsx
â”‚	  â””â”€â”€ routes.ts
â””â”€â”€ main.tsx
```

> æç¤ºï¼šè¿™é‡Œåªä¾‹ä¸¾éƒ¨åˆ†ç›®å½•ï¼Œä»…ä¾›å‚è€ƒã€‚

**â‘¡. å®‰è£…ä¾èµ–**

```shell
$ yarn add react-router-dom
```

> æç¤ºï¼šç›®å‰æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ `^6.0.2`ï¼Œå…³äº v6 ç‰ˆæœ¬çš„è·¯ç”±ä½¿ç”¨è¯· [å‚è€ƒè¿™é‡Œ >>](https://reactrouter.com/)

**â‘¢. æ–‡ä»¶ä»£ç **

> `src/layout/index.tsx`

```tsx
import TabBar from '@/components/@lgs-react/TabBar';
import React from 'react';
import { Outlet } from 'react-router-dom';

const Layout: React.FC = () => {
  return (
    <>
      {/* è§†å›¾å®¹å™¨ï¼Œç±»ä¼¼äºvueä¸­çš„ router-view */}
      <Outlet />
      {/* æ ‡ç­¾æ  */}
      <TabBar />
    </>
  );
};

export default Layout;
```

> `src/App.tsx`

```tsx
import React, { Suspense } from 'react';
import { BrowserRouter as Router, Route, Routes } from 'react-router-dom';

import Fallback from '@/components/@lgs-react/Fallback';
import Layout from '@/layout';
import IndexPage from '@/pages/IndexPage';
import Integral from '@/pages/Integral';
import Mine from '@/pages/Mine';
import PrivilegeBrand from '@/pages/PrivilegeBrand';
import Auth from '@/pages/Auth';
import NotFound from './pages/NotFound';
import NotEnv from './components/@lgs-react/NotEnv';

import Tools from 'lg-tools';

const Details = React.lazy(() => import('@/pages/Details'));
const Download = React.lazy(() => import('@/pages/Download'));
const Test = React.lazy(() => import('@/pages/Test'));

/**
 * ç¯å¢ƒåˆ¤æ–­
 * å¦‚æœ VITE_APP_SOURCE === 'mp'ï¼Œå³è¡¨ç¤ºå…¬ä¼—å·/ç”Ÿæ´»å·
 * é‚£ä¹ˆåœ¨æµè§ˆå™¨ç¯å¢ƒå°†æç¤º â€œè¯·åœ¨å¾®ä¿¡æˆ–æ”¯ä»˜å®å®¢æˆ·ç«¯æ‰“å¼€é“¾æ¥â€
 * @param param0
 * @returns
 */
export const GuardEnv: React.FC = ({ children }) => {
  return import.meta.env.VITE_APP_SOURCE === 'mp' &&
    ['weixin', 'alipay'].indexOf(Tools.getEnv()) === -1 ? (
    <NotEnv />
  ) : (
    <>{children}</>
  );
};

/**
 * appRouter
 * @returns
 */
export const AppRouter: React.FC = ({ children }) => {
  return (
    <Suspense fallback={Fallback}>
      <Router basename={import.meta.env.VITE_APP_BASE}>{children}</Router>
    </Suspense>
  );
};

/**
 * appRoutes - æ¸²æŸ“è·¯ç”±
 * @returns
 */
export const AppRoutes: React.FC = () => {
  return (
    <Routes>
      <Route path='/' element={<Layout />}>
        <Route index element={<IndexPage />} />
        <Route path='privilege-brand' element={<PrivilegeBrand />} />
        <Route path='integral' element={<Integral />} />
        <Route path='mine' element={<Mine />} />
      </Route>
      <Route path='/details' element={<Details />} />
      <Route path='/download' element={<Download />} />
      <Route path='/test' element={<Test />} />
      <Route path='/auth/:type' element={<Auth />} />
      <Route path='*' element={<NotFound />} />
    </Routes>
  );
};
```

> `src/main.tsx`

```tsx
import React from 'react';
import ReactDOM from 'react-dom';
import ErrorBoundary from '@/components/@lgs-react/ErrorBoundary';

import '@/utils/rem';
import '@/index.css';
import { AppRouter, AppRoutes, GuardEnv } from './App';
import Schemes from 'lg-schemes';

// 1. å¼€å‘ç¯å¢ƒ & æµ‹è¯•ç¯å¢ƒ å¯ç”¨vconsole --- Tipsï¼šç›®å‰å¯ç”¨vconsoleæ‰“åŒ…ä¼šå‡ºç°å¼‚å¸¸
import vconsole from 'vconsole';
if (import.meta.env.VITE_APP_ENV !== 'pro') {
  new vconsole();
}

// 2. æ¸²æŸ“è§†å›¾
ReactDOM.render(
  <React.StrictMode>
    <ErrorBoundary>
      <GuardEnv>
        <AppRouter>
          <AppRoutes />
        </AppRouter>
      </GuardEnv>
    </ErrorBoundary>
  </React.StrictMode>,
  document.getElementById('root')
);
```

### - [Antd-mobile](https://mobile.ant.design/zh)

ç›®å‰ä½¿ç”¨çš„  <u>Antd-mobile v5ï¼ˆç™½æ¨ï¼‰</u> ç‰ˆæœ¬ã€‚

**â‘  å®‰è£…ä¾èµ–**

```shell
$ yarn add antd-mobile@next
```

> åœ¨ beta é˜¶æ®µæˆ‘ä»¬æœ‰å¯èƒ½ä¼šåœ¨åç»­çš„æ–°ç‰ˆæœ¬ä¸­å‘å¸ƒ break changeï¼Œæ‰€ä»¥å¼ºçƒˆå»ºè®®ä½¿ç”¨ lockfile é”å®šç‰ˆæœ¬æˆ–æ‰‹åŠ¨é”å®šç‰ˆæœ¬

**â‘¡ å¼•å…¥**

ç›´æ¥å¼•å…¥ç»„ä»¶å³å¯ï¼Œantd-mobile ä¼šè‡ªåŠ¨ä¸ºä½ åŠ è½½ css æ ·å¼æ–‡ä»¶ï¼š

```tsx
import { Button } from 'antd-mobile'
```

### - äºŒçº§ç›®å½•éƒ¨ç½²

**â‘ . åœ¨ `package.json` æ–‡ä»¶ä¸­é…ç½®æŒ‡ä»¤æ—¶æ—¶è®¾ç½® `--base=/äºŒçº§ç›®å½•å/`**ã€‚

**â‘¡. åœ¨å„ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸­æ ¹æ®éœ€è¦è®¾ç½® `VITE_APP_BASE` å­—æ®µå€¼**ã€‚

**â‘¡. åœ¨é…ç½®è·¯ç”±æ—¶è®¾ç½® `basename` å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š**

```tsx
/**
 * src/router/index.tsx
 * appRouter
 * @returns
 */
export const AppRouter: React.FC = ({ children }) => {
  return (
    <Suspense fallback={Fallback}>
      <Router basename={import.meta.env.VITE_APP_BASE}>{children}</Router>
    </Suspense>
  );
};
```

# å…­ã€æ¨¡æ¿åœ°å€

é—²æš‡ä¹‹ä½™ï¼Œç»“åˆ `Vite` å°è£…äº†ä¸¤ä¸ªæ¨¡æ¿ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼š

- [Vite2 + Vue3 + TypeScript + Vant4 >>](https://github.com/LiHongyao/vite-vue-template)

- [Vite2 + React +_TypeScript + Ant Design Mobile 5.x >>](https://github.com/LiHongyao/vite-react-template)

> æç¤ºï¼šæœ¬æ–‡ä¸­çš„ä»£ç ç‰‡æ®µå‡æ‘˜è‡ªä¸Šè¿°æ¨¡æ¿æ–‡ä»¶ã€‚

# æ¦‚è¿°

**i18n**ï¼ˆå…¶æ¥æºæ˜¯è‹±æ–‡å•è¯ internationalizationçš„é¦–æœ«å­—ç¬¦iå’Œnï¼Œ18ä¸ºä¸­é—´çš„å­—ç¬¦æ•°ï¼‰æ˜¯ â€œ**å›½é™…åŒ–**â€çš„ç®€ç§°ã€‚

å¯¹äºä¸€äº›è·¨å›½é¡¹ç›®æ¥è¯´ï¼Œå›½é™…åŒ–æ˜¯å°¤ä¸ºé‡è¦çš„ï¼Œé‚£ä»€ä¹ˆæ˜¯å›½é™…åŒ–å‘¢â“å›½é™…åŒ–çš„æ„æ€å°±æ˜¯å°†æˆ‘ä»¬å†™çš„é¡¹ç›®ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒå›½å®¶çš„è¯­è¨€ï¼Œè¿›è¡Œç¿»è¯‘ï¼Œè¿›è¡Œåˆ‡æ¢ï¼Œæ–¹ä¾¿ä¸åŒå›½å®¶çš„å®¢æˆ·ä½¿ç”¨ã€‚

æœ¬æ–‡ç¤ºä¾‹åŸºäº[**`vue-i18n`**](https://kazupon.github.io/vue-i18n/zh/) å®ç°ï¼Œã€Œ**vue-i18n**ã€é¡¾åæ€ä¹‰å°±æ˜¯ Vue.js çš„å›½é™…åŒ–æ’ä»¶ï¼Œ å®ƒå¯ä»¥è½»æ¾åœ°å°†ä¸€äº›æœ¬åœ°åŒ–åŠŸèƒ½é›†æˆåˆ°ä½ çš„ Vue.js åº”ç”¨ç¨‹åºä¸­ã€‚

åŸºæœ¬æ€è·¯ï¼š

1.  å®šä¹‰è¯­è¨€åŒ…ï¼šéœ€è¦å‡ ç§è¯­è¨€å±•ç¤ºï¼Œå°±å®šä¹‰å‡ ä¸ªè¯­è¨€åŒ…
2. åˆ›å»ºå¯¹è±¡ï¼Œå¯¹è¯­è¨€åŒ…è¿›è¡Œæ•´åˆï¼Œå¯¹è±¡çš„ key ä¸ºè¯­è¨€åŒ…çš„å¼•ç”¨ï¼Œå€¼ä¸ºè¯­è¨€åŒ…å¯¹è±¡
3. åˆ›å»º **[vue-i18n](https://vue-i18n.intlify.dev/)** ç±»çš„å¯¹è±¡ï¼ŒåŒæ—¶ä¸ºå…¶ messages å±æ€§ä¸ºç¬¬â‘¡æ­¥åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸ºå…¶ locale å±æ€§èµ‹å€¼ä¸ºç¬¬â‘¡æ­¥ä¸­è¯­è¨€å¯¹è±¡å¯¹åº”çš„ key
4. åœ¨åˆ›å»º Vue å®ä¾‹å¯¹è±¡æ—¶ï¼ŒæŒ‚è½½ vue-i18n ç±»çš„å¯¹è±¡

# å¼€å§‹

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç»ˆå®ç°çš„ç¤ºä¾‹æ•ˆæœï¼š

![ç¤ºä¾‹æ•ˆæœ](./IMGs/i18n.gif)

ç¤ºä¾‹ä»£ç ç›¸å…³ç‰ˆæœ¬ï¼š

- vueï¼š3.x
- vue-i18nï¼š9.x
- ç¤ºä¾‹ä½¿ç”¨ Composition API.

## åˆ›å»ºé¡¹ç›®

```shell
$ npm create vite@latest i18n-learns -- --template vue-ts
$ cd i18n-learns && npm install vue-i18n
```

## é…ç½®i18n

åœ¨ src ç›®å½•ä¸­åˆ›å»º languages ç›®å½•ç®¡ç†è¯­è¨€åŒ…ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components
	      â””â”€â”€ /PickerLanguage â†’ é€‰æ‹©è¯­è¨€ç»„ä»¶
	  	  		â””â”€â”€ index.vue 
	  â”œâ”€â”€ /languages â†’ i18nç›¸å…³é…ç½®
		    â”œâ”€â”€ en-US.ts 
		    â”œâ”€â”€ es.ts
		    â”œâ”€â”€ pl.ts    
		    â”œâ”€â”€ pt.ts
		    â”œâ”€â”€ zh-CN.ts
		    â”œâ”€â”€ i18n.ts
		    â””â”€â”€ index.ts
	  â”œâ”€â”€	main.ts
â”œâ”€â”€ ....
```

å…¶ä¸­ï¼Œ

- `PickerLanguage`ï¼šå°è£…çš„åˆ‡æ¢è¯­è¨€çš„ç»„ä»¶

- `en-US` / `es` / `pl` / `pt` / `zh-CN`ï¼šè¯­è¨€åŒ…æ–‡ä»¶ï¼Œç¤ºä¾‹ç½—åˆ—äº†5ç§è¯­è¨€ï¼Œå½“ç„¶ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚æ¥ã€‚
- `i18n`ï¼šæ„å»º `i18n` å®ä¾‹
- `index`ï¼šåˆæˆè¯­è¨€åŒ…

å„æ–‡ä»¶ä»£ç ï¼š

**`zh-CN.ts`**

```typescript
// ğŸ‘‰ ç®€ä½“ä¸­æ–‡ 
export default {
  message: {
    hello: 'ä½ å¥½ï¼Œä¸–ç•Œï¼',
  },
};
```

**`en-US.ts`**

```typescript
// ğŸ‘‰ è‹±è¯­
export default {
  message: {
    hello: 'Hello, World!',
  },
};
```

**`es.ts`**

```typescript
// ğŸ‘‰ è¥¿ç­ç‰™è¯­ 
export default {
  message: {
    hello: 'Â¡Hola Mundo!',
  },
};
```

**`pl.ts`**

```typescript
// ğŸ‘‰ æ³¢å…°è¯­ 
export default {
  message: {
    hello: 'Witaj Å›wiecie!',
  },
};
```

**`pt.ts`**

```typescript
// ğŸ‘‰ è‘¡è„ç‰™è¯­ 
export default {
  message: {
    hello: 'OlÃ¡ Mundo!',
  },
};
```

**`index.ts`**

```typescript
import en from './en-US';
import zh from './zh-CN';
import pl from './pl';
import pt from './pt';
import es from './es';

export default { en, zh, pl, pt, es };
```

**`i18n.ts`**

```typescript

import { createI18n } from 'vue-i18n';
import languages from './index';

/**
 * è·å–æœ¬åœ°è¯­è¨€
 * -- é¦–å…ˆåˆ¤æ–­æœ¬åœ°æ˜¯å¦è®°å½•ç”¨æˆ·ä¸Šæ¬¡åˆ‡æ¢çš„è¯­è¨€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è·å–æµè§ˆå™¨é¦–é€‰è¯­è¨€
 * -- å¦åˆ™ä½¿ç”¨é»˜è®¤è¯­è¨€ â€˜en-USâ€™
 */
export const getLocaleLanguage = (
  options: {
    /** é»˜è®¤è¯­è¨€ï¼šen-US */
    defaultLang?: string;
    /** æ˜¯å¦éœ€è¦å®Œæ•´æ ¼å¼ï¼šè¯­è¨€-å›½å®¶ â†’ zh-CN */
    isIntegrated?: boolean;
  } = {}
): string => {
  // -- è§£æ„å‚æ•°
  const { defaultLang = 'en-US', isIntegrated = false } = options;
  // -- è¯»å–æœ¬åœ°å­˜å‚¨çš„æ•°æ®ï¼ˆæœ¬åœ°å­˜å‚¨æ—¶å¿…é¡»å­˜å‚¨å®Œæ•´æ ¼å¼ã€Œè¯­è¨€-å›½å®¶ã€ï¼‰
  const lanForStorage = localStorage.getItem('i18n-Lang');
  // -- è¯»å–æµè§ˆå™¨é¦–é€‰è¯­è¨€
  const lanForNavigator = navigator.language;
  // -- ä¸´æ—¶è¯­è¨€
  let lanForTemp = lanForStorage || lanForNavigator;
  // -- æ ¡éªŒi18næ˜¯å¦é…ç½®è¯¥è¯­è¨€
  // -- ç”±äºæœ¬åœ°å­˜å‚¨å’Œé»˜è®¤è·å–çš„æ˜¯å®Œæ•´çš„ã€Œè¯­è¨€-å›½å®¶ã€ä»£ç ï¼Œå¦‚â€œzh-CNâ€
  // -- è€Œi18né…ç½®æ—¶ä½¿ç”¨çš„æ˜¯ã€Œè¯­è¨€ã€ä»£ç ï¼Œå¦‚â€œzhâ€
  // -- æ‰€ä»¥éœ€æˆªå–å‰é¢ä¸¤ä¸ªå­—ç¬¦ï¼ˆå³è¯­è¨€ä»£ç ï¼‰æ¥æ ¡éªŒ
  const isSupported = Object.keys(languages).includes(lanForTemp.slice(0, 2));
  // -- æ¡ä»¶è¿”å›æ‰€éœ€ä»£ç 
  if (isSupported) {
    return isIntegrated ? lanForTemp : lanForTemp.slice(0, 2);
  }
  return isIntegrated ? defaultLang : defaultLang.slice(0, 2);
};

// -- æ³¨å†Œi18nå®ä¾‹å¹¶å¼•å…¥è¯­è¨€æ–‡ä»¶
const i18n = createI18n({
  legacy: false,
  locale: getLocaleLanguage(),
  messages: languages,
});

export default i18n;
```

## åœ¨åº”ç”¨ç¨‹åºä¸­é›†æˆ i18n

```tsx
import { createApp } from 'vue';
import App from '@/App.vue';
import i18n from '@/languages/i18n';

const app = createApp(App);
app.use(i18n);

app.mount('#app');
```

## åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ i18n

**ğŸ‘‰ ç»„ä»¶å°è£…**

å°è£… **PickerLanguage** ä¾¿äºåˆ‡æ¢è¯­è¨€ã€‚

> **æç¤ºï¼š** *ä½ ä¸å¿…å…³å¿ƒç»„ä»¶çš„å…·ä½“å®ç°ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼Œå½“ç„¶ï¼Œä¸ºäº†æµ‹è¯•ï¼Œä½ ä¹Ÿå¯ä»¥éšä¾¿åˆ›å»ºå‡ ä¸ªæŒ‰é’®å®ç°ç±»ä¼¼çš„éœ€æ±‚ã€‚*

ä»£ç å¦‚ä¸‹ï¼š

```vue
<script setup lang="ts">
import { reactive, onMounted } from 'vue';

export interface LangProps {
  label: string /** è¯­è¨€æè¿°ï¼Œå¦‚â€œç®€ä½“ä¸­æ–‡â€ */;
  value: string /** è¯­è¨€ä»£ç ï¼Œå¦‚â€œzh-CNâ€ */;
  icon: string /** å›½æ——å›¾æ ‡ */;
}

interface IProps {
  langs: Array<LangProps> /** å›½é™…åŒ–è¯­è¨€åˆ—è¡¨ï¼Œç”¨äºåœ¨èœå•æ å±•ç¤º */;
  defaultValue?: string /** é»˜è®¤é€‰ä¸­çš„è¯­è¨€ä»£ç ï¼Œæ”¯æŒã€Œè¯­è¨€ã€/ã€Œè¯­è¨€-å›½å®¶ã€ä¸¤ç§å½¢å¼ï¼Œä¸ä¼ åˆ™å–langs[0] */;
  alignment?: 'left' | 'right' /** èœå•æ å‡ºç›¸å¯¹äºå®¹å™¨çš„å¯¹é½æ–¹å‘ */;
}

interface IState {
  checked: LangProps | null /** è®°å½•å½“å‰é€‰ä¸­çš„è¯­è¨€å¯¹è±¡ */;
  maskIsOpen: boolean /** èœå•æ æ˜¾ç¤ºçŠ¶æ€ */;
}

// -- props
const props = withDefaults(defineProps<IProps>(), {
  alignment: 'left',
});
const emits = defineEmits<{
  (e: 'change', lang: LangProps): void;
}>();

// -- state
const state = reactive<IState>({
  checked: null,
  maskIsOpen: false,
});

// -- life circles
onMounted(() => {
  /** åˆ¤æ–­defaultValueæ˜¯å¦ä¼ é€’ï¼Œæ²¡æœ‰ä¼ é€’åˆ™å–langsç¬¬ä¸€é¡¹ */
  let defaultLang = props.defaultValue
    ? props.langs.find((lang) => {
        return new RegExp(props.defaultValue as string).test(lang.value);
      })
    : undefined;
  state.checked = defaultLang ?? props.langs[0];
});

// -- events
const onLangItemTap = (lang: LangProps) => {
  emits('change', lang);
  state.checked = lang;
  state.maskIsOpen = false;
};
</script>

<template>
  <div class="lg-langs">
    <div class="current" @click="state.maskIsOpen = !state.maskIsOpen">
      <template v-if="state.checked">
        <img :src="state.checked.icon" />
        <span>{{ state.checked.label }}</span>
      </template>
      <b v-else>Languages__</b>
    </div>
    <div :class="['mask', { open: state.maskIsOpen }, props.alignment]">
      <div class="langs-list">
        <template v-for="(item, index) in props.langs" :key="index">
          <div
            :class="['item', { checked: item.value === state.checked?.value }]"
            @click="onLangItemTap(item)"
          >
            <div class="wrap">
              <img :src="item.icon" />
              <span>{{ item.label }}</span>
            </div>
          </div>
        </template>
      </div>
      <div class="close" @click="state.maskIsOpen = false" />
    </div>
  </div>
</template>

<style lang="less" scoped>
.lg-langs {
  width: auto;
  font-size: 15px;
  color: #333;
  position: relative;
  img {
    width: 30px;
    height: 20px;
    margin-right: 6px;
  }
  .current {
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    &:hover {
      color: #40a9ff;
    }
  }

  .mask {
    transition: all 0.3s linear;
    position: absolute;
    top: calc(100% + 6px);
    transform-origin: center top;
    transform: scaleY(0);
    background-color: #f9f9f9;
    z-index: 1000;
    &.left {
      left: 0;
    }
    &.right {
      right: 0;
    }
    .langs-list {
      max-height: 300px;
      overflow-y: scroll;
    }
    .item {
      width: 140px;
      height: 36px;
      padding: 0 16px;
      cursor: pointer;
      position: relative;
      &.checked {
        color: #40a9ff;
      }
      .wrap {
        width: inherit;
        height: inherit;
        display: flex;
        align-items: center;
        position: relative;
        z-index: 1;
      }
      &::before {
        content: '';
        z-index: 0;
        width: 0;
        height: inherit;
        background-color: #eeeeee;
        transition: all 0.25s linear;
        position: absolute;
        top: 0;
        left: 0;
      }
      &:not(.checked):hover::before {
        width: 100%;
      }
    }
    &.open {
      transform: scaleY(1);
    }
    .close {
      height: 36px;
      position: relative;
      border-top: 1px solid #eeeeee;
      cursor: pointer;

      &::before,
      &::after {
        content: '';
        display: block;
        width: 3px;
        height: 16px;
        background-color: #444444;
        transition: opacity 0.25s linear;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
        opacity: 0.75;
      }
      &::before {
        transform: rotateZ(45deg);
      }
      &::after {
        transform: rotateZ(-45deg);
      }
      &:hover::before,
      &:hover::after {
        opacity: 1;
      }
    }
  }
}
</style>
```

**ğŸ‘‰ ä½¿ç”¨i18n**

**`xxx/languages.ts`**

```typescript
import { LangProps } from '@/components/PickerLanguage/index.vue';
export const langs: Array<LangProps> = [
  {
    label: 'ç®€ä½“ä¸­æ–‡',
    value: 'zh-CN',
    icon: 'https://static.case-base.net/lang/svg/cn.svg',
  },
  {
    label: 'English',
    value: 'en-US',
    icon: 'https://static.case-base.net/lang/svg/us.svg',
  },
  {
    label: 'EspaÃ±ol',
    value: 'es-ES',
    icon: 'https://static.case-base.net/lang/svg/es.svg',
  },
  {
    label: 'Polski',
    value: 'pl-PL',
    icon: 'https://static.case-base.net/lang/svg/pl.svg',
  },
  {
    label: 'PortuguÃªs',
    value: 'pt-PT',
    icon: 'https://static.case-base.net/lang/svg/pt.svg',
  },
];
```

**`xxx.vue`**

```vue
<script setup lang="ts">
import { useI18n } from 'vue-i18n';
import PickerLanguage, { LangProps } from '@/components/PickerLanguage/index.vue';
import { getLocaleLanguage } from '@/languages/i18n';
import { langs } from './langs';
  
// --  i18n
const { t, locale } = useI18n();

// -- events
const onLangeChange = (lang: LangProps) => {
  // -- è®°å½•ç”¨æˆ·åˆ‡æ¢çš„è¯­è¨€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åŠ è½½æ—¶å¯ä»¥è‡ªåŠ¨å‘½ä¸­
  localStorage.setItem('i18n-Lang', lang.value);
  // -- æ³¨æ„ï¼š
  // -- 1. ç»„ä»¶/æœ¬åœ°å­˜å‚¨æ ¼å¼ â†’ ã€Œè¯­è¨€-å›½å®¶ã€ï¼Œå¦‚â€zh-CNâ€œ
  // -- 2. i18n æ‰€éœ€æ ¼å¼ä¸º â†’ ã€Œè¯­è¨€ã€ï¼Œå¦‚ â€zhâ€œ
  // -- 3. æ‰€ä»¥è¿™é‡Œåœ¨è®¾ç½® local.value æ—¶éœ€æˆªå–è¯­è¨€ä»£ç æ¥èµ‹å€¼
  locale.value = lang.value.slice(0, 2);
  console.log(lang);
};
</script>
<template>
  <div class="page">
    <!-- é€‰æ‹©è¯­è¨€ -->
    <PickerLanguage
      :langs="langs"
      alignment="right"
      :default-value="getLocaleLanguage()"
      @change="onLangeChange"
    />
    <h3 class="message">{{ t('message.hello') }}</h3>
  </div>
</template>

<style lang="less">
.page {
  padding-top: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.message {
  margin-top: 16px;
}

.lg-langs {
  position: fixed !important;
  top: 20px;
  right: 100px;
}
</style>
```



